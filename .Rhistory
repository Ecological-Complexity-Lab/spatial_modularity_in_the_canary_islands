layers = layer_metadata, #layers are always the same. we're not deleting layers.
intra_output_extended = T)
man_mod <- run_infomap_multilayer(man, relax = F, silent = T, trials = 100, seed = 497294, multilayer_relax_rate = r, multilayer_relax_limit_up = 1, multilayer_relax_limit_down = 0, temporal_network = F)
##-- Plot modules in each island with size proportion
#arrange data to include  modules sizes
size <- count(man_mod$modules, module)  #create a data frame of all modules and how many nodes are in each (size of module)
module_data <- merge(man_mod$modules , size, by=c("module","module")) #merge size of module with all the other info about the modules
colnames(module_data)[7] <- "size_of_module" #rename column
#Calculate number of nodes in each module per island
N_species_mod<-module_data %>%
group_by(layer_id, module) %>%
summarize(module_size=n_distinct(node_id))
#Create dataframe with total number of nodes per module across islands
Module_size <- module_data %>% count(module) #num of nodes in module.
#merge dataframes and calculate proportion of species in each module
Prop_sp_module <- left_join(N_species_mod,Module_size)
Prop_sp_module_2<-Prop_sp_module %>%
mutate(Prop_sp = module_size / n)
#change order accoridng to distances
Prop_sp_module_island<- Prop_sp_module_2 %>%
mutate(layer_name= case_when(layer_id == '1' ~ 'WesternSahara',
layer_id == '2' ~ 'Fuerteventura',
layer_id == '3' ~ 'GranCanaria',
layer_id == '4' ~ 'TenerifeSouth',
layer_id == '5' ~ 'TenerifeTeno',
layer_id == '6' ~ 'Gomera',
layer_id == '7' ~ 'Hierro'))
Interedges_weight_low<- ggplot(Prop_sp_module_island, aes(x = module, y = layer_name, fill=Prop_sp )) +
geom_tile(color='white') +
theme_classic() +
scale_fill_viridis_c(limits = c(0, 1)) +
scale_x_continuous(breaks=seq(1,83,4)) +
scale_y_discrete(limits = c("Hierro","Gomera","TenerifeTeno","TenerifeSouth","GranCanaria","Fuerteventura","WesternSahara"))+
labs(x='Module ID', y="Islands")
Interedges_weight_low<- ggplot(Prop_sp_module_island, aes(x = module, y = layer_name, fill=Prop_sp )) +
geom_tile(color='white') +
theme_classic() +
scale_fill_viridis_c(limits = c(0, 1)) +
scale_x_continuous(breaks=seq(1,83,4)) +
scale_y_discrete(limits = c("Hierro","Gomera","TenerifeTeno","TenerifeSouth","GranCanaria","Fuerteventura","WesternSahara"))+
labs(x='Module ID', y="Islands")
Interedges_weight_low
## Distribution of modules across islands
module_data $layer_id<- as.character(module_data $layer_id)
module_data_id  <- module_data  %>%
mutate(layer_name= case_when(layer_id == '1' ~ 'WesternSahara',
layer_id == '2' ~ 'Fuerteventura',
layer_id == '3' ~ 'GranCanaria',
layer_id == '4' ~ 'TenerifeSouth',
layer_id == '5' ~ 'TenerifeTeno',
layer_id == '6' ~ 'Gomera',
layer_id == '7' ~ 'Hierro'))
module_data_id2<-module_data_id %>% select(layer_name, module, size_of_module) %>% unique()
module_data_id2$count <- c(1)
module_data_id3<- module_data_id2%>% unique()  %>% group_by(module) %>%
mutate(tot_island = sum (count)) %>% arrange(desc(tot_island))
# Convert module to an ordered factor and change the order according to number of islands
module_data_id3$module<- as.factor(module_data_id3$module)
module_data_id3$module <- fct_inorder(module_data_id3$module)
Dist_Inter_low<-module_data_id3 %>%
ggplot(aes(x=module, y= count ,fill= factor(layer_name)))+ geom_bar(stat= "identity")+ theme_classic()+ labs(y="Number of locations", x="Modules")+
guides(fill=guide_legend(title="Location"))+ theme(axis.text.x = element_blank(),
axis.text.y=element_text(size=15), axis.title = element_text(size=17),
legend.text=element_text(size=12.5),legend.title =element_text(size=14))
Dist_Inter_low
Dist_Inter_high
Dist_Inter_high<-module_data_id3 %>%
ggplot(aes(x=module, y= count ,fill= factor(layer_name)))+ geom_bar(stat= "identity")+ theme_classic()+ labs(y="Number of locations", x="Modules")+
guides(fill=guide_legend(title="Location"))+ theme(axis.text.x = element_blank(),
axis.text.y=element_text(size=15), axis.title = element_text(size=17),
legend.text=element_text(size=12.5),legend.title =element_text(size=14))
##- High interedges value
inter_extended$weight <- 0.9
man<-create_multilayer_object(intra = intra_nonextended,
inter = inter_extended,
nodes = physical_nodes, #nodes are always the same. we're not deleting nodes.
layers = layer_metadata, #layers are always the same. we're not deleting layers.
intra_output_extended = T)
man_mod <- run_infomap_multilayer(man, relax = F, silent = T, trials = 100, seed = 497294, multilayer_relax_rate = r, multilayer_relax_limit_up = 1, multilayer_relax_limit_down = 0, temporal_network = F)
##-- Plot modules in each island with size proportion
#arrange data to include  modules sizes
size <- count(man_mod$modules, module)  #create a data frame of all modules and how many nodes are in each (size of module)
module_data <- merge(man_mod$modules , size, by=c("module","module")) #merge size of module with all the other info about the modules
colnames(module_data)[7] <- "size_of_module" #rename column
#Calculate number of nodes in each module per island
N_species_mod<-module_data %>%
group_by(layer_id, module) %>%
summarize(module_size=n_distinct(node_id))
#Create dataframe with total number of nodes per module across islands
Module_size <- module_data %>% count(module) #num of nodes in module.
#merge dataframes and calculate proportion of species in each module
Prop_sp_module <- left_join(N_species_mod,Module_size)
Prop_sp_module_2<-Prop_sp_module %>%
mutate(Prop_sp = module_size / n)
#change order accoridng to distances
Prop_sp_module_island<- Prop_sp_module_2 %>%
mutate(layer_name= case_when(layer_id == '1' ~ 'WesternSahara',
layer_id == '2' ~ 'Fuerteventura',
layer_id == '3' ~ 'GranCanaria',
layer_id == '4' ~ 'TenerifeSouth',
layer_id == '5' ~ 'TenerifeTeno',
layer_id == '6' ~ 'Gomera',
layer_id == '7' ~ 'Hierro'))
Interedges_weight_high<- ggplot(Prop_sp_module_island, aes(x = module, y = layer_name, fill=Prop_sp )) +
geom_tile(color='white') +
theme_classic() +
scale_fill_viridis_c(limits = c(0, 1)) +
scale_x_continuous(breaks=seq(1,83,4)) +
scale_y_discrete(limits = c("Hierro","Gomera","TenerifeTeno","TenerifeSouth","GranCanaria","Fuerteventura","WesternSahara"))+
labs(x='Module ID', y="Islands")
Interedges_weight_high
## Distribution of modules across islands
module_data $layer_id<- as.character(module_data $layer_id)
module_data_id  <- module_data  %>%
mutate(layer_name= case_when(layer_id == '1' ~ 'WesternSahara',
layer_id == '2' ~ 'Fuerteventura',
layer_id == '3' ~ 'GranCanaria',
layer_id == '4' ~ 'TenerifeSouth',
layer_id == '5' ~ 'TenerifeTeno',
layer_id == '6' ~ 'Gomera',
layer_id == '7' ~ 'Hierro'))
module_data_id2<-module_data_id %>% select(layer_name, module, size_of_module) %>% unique()
module_data_id2$count <- c(1)
module_data_id3<- module_data_id2%>% unique()  %>% group_by(module) %>%
mutate(tot_island = sum (count)) %>% arrange(desc(tot_island))
# Convert module to an ordered factor and change the order according to number of islands
module_data_id3$module<- as.factor(module_data_id3$module)
module_data_id3$module <- fct_inorder(module_data_id3$module)
Dist_Inter_high<-module_data_id3 %>%
ggplot(aes(x=module, y= count ,fill= factor(layer_name)))+ geom_bar(stat= "identity")+ theme_classic()+ labs(y="Number of locations", x="Modules")+
guides(fill=guide_legend(title="Location"))+ theme(axis.text.x = element_blank(),
axis.text.y=element_text(size=15), axis.title = element_text(size=17),
legend.text=element_text(size=12.5),legend.title =element_text(size=14))
Dist_Inter_high
knitr::opts_chunk$set(echo = FALSE, results = "asis", message=FALSE, warning=FALSE, cache=TRUE, eval = TRUE, dev = c('png'), out.width = '100%', out.height='40%')
jaccard_similarity_empirical_and_fixed_km <- read.csv("sensitivity_nullmodel4.csv")
jaccard_similarity_empirical_and_fixed_km %>%
ggplot(aes(x= ave_dist_in_km , y= ave, group= trial, color= trial))+
ggtitle("Sensitivity")+ scale_color_discrete(name = "Interedges weight")+
geom_point()+ theme_classic()+ geom_smooth(method= "lm", se=F)+
theme(axis.title=element_text(size=22))+theme(axis.text.x=element_text(size=15))+
theme(axis.text.y=element_text(size=15))+ theme(legend.title = element_text(size = 13), legend.text = element_text(size = 13))+
labs(x="Distance in Km", y="Jaccard Similarity")+
theme(panel.grid = element_blank(),
panel.border = element_rect(color = "black",fill = NA,size = 1),
panel.spacing = unit(0.5, "cm", data = NULL),
axis.text = element_text(size=14, color='black'),
axis.title = element_text(size=14, color='black'),
axis.line = element_blank())
jaccard_similarity_empirical_and_relax_km <- read.csv("relax_nullmodel4.csv")
jaccard_similarity_empirical_and_relax_km %>%
ggplot(aes(x= ave_dist_in_km , y= ave, group= trial, color= trial))+
ggtitle("Relax rate")+ scale_color_discrete(name = "Relax rate")+
geom_point()+ theme_classic()+ geom_smooth(method= "lm", se=F)+
theme(axis.title=element_text(size=22))+theme(axis.text.x=element_text(size=15))+
theme(axis.text.y=element_text(size=15))+ theme(legend.title = element_text(size = 13), legend.text = element_text(size = 13))+
labs(x="Distance in Km", y="Jaccard Similarity")+
theme(panel.grid = element_blank(),
panel.border = element_rect(color = "black",fill = NA,size = 1),
panel.spacing = unit(0.5, "cm", data = NULL),
axis.text = element_text(size=14, color='black'),
axis.title = element_text(size=14, color='black'),
axis.line = element_blank())
write.csv(size, "R/Extra_analysis_results/module_data_id3_higher.csv", row.names = FALSE)
module_data_id3<- read.csv("module_data_id3_higher.csv")
module_data_id3 %>% ggplot(aes(x=module, y= count ,fill= factor(layer_name)))+ geom_bar(stat= "identity")+ theme_classic()+ labs(y="Number of locations", x="Modules")+
guides(fill=guide_legend(title="Location"))+ theme(axis.text.x = element_blank(),
axis.text.y=element_text(size=15), axis.title=element_text(size=17),
legend.text=element_text(size=12.5),legend.title =element_text(size=14))
#write.csv(size, "R/Extra_analysis_results/module_data_id3_higher.csv", row.names = FALSE)
Dist_Inter<-module_data_id3 %>%
ggplot(aes(x=module, y= count ,fill= factor(layer_name)))+ geom_bar(stat= "identity")+ theme_classic()+ labs(y="Number of locations", x="Modules")+
guides(fill=guide_legend(title="Location"))+ theme(axis.text.x = element_blank(),
axis.text.y=element_text(size=15), axis.title = element_text(size=17),
legend.text=element_text(size=12.5),legend.title =element_text(size=14))
Dist_Inter
physical_nodes <- read.csv("./csvs/Islands/physical_nodes_islands.csv")
layer_metadata <- read.csv("./csvs/Islands/layer_metadata_islands.csv")
inter_extended <- read.csv("./csvs/Islands/dryad_only_interlayer_edges_islands_as_layers.csv")
intra_nonextended <- read.csv("./csvs/Islands/dryad_only_intralayer_edges_islands_as_layers.csv")
inter_extended <- inter_extended [,-1]
intra_nonextended <- intra_nonextended [,-1]
#Interedges weight
inter_extended$weight <- 0.9
man<-create_multilayer_object(intra = intra_nonextended,
inter = inter_extended,
nodes = physical_nodes, #nodes are always the same. we're not deleting nodes.
layers = layer_metadata, #layers are always the same. we're not deleting layers.
intra_output_extended = T)
man_mod <- run_infomap_multilayer(man, relax = F, silent = T, trials = 100, seed = 497294, multilayer_relax_rate = r, multilayer_relax_limit_up = 1, multilayer_relax_limit_down = 0, temporal_network = F)
##-- Plot modules in each island with size proportion
#arrange data to include  modules sizes
size <- count(man_mod$modules, module)  #create a data frame of all modules and how many nodes are in each (size of module)
module_data <- merge(man_mod$modules , size, by=c("module","module")) #merge size of module with all the other info about the modules
colnames(module_data)[7] <- "size_of_module" #rename column
#Calculate number of nodes in each module per island
N_species_mod<-module_data %>%
group_by(layer_id, module) %>%
summarize(module_size=n_distinct(node_id))
#Create dataframe with total number of nodes per module across islands
Module_size <- module_data %>% count(module) #num of nodes in module.
#merge dataframes and calculate proportion of species in each module
Prop_sp_module <- left_join(N_species_mod,Module_size)
Prop_sp_module_2<-Prop_sp_module %>%
mutate(Prop_sp = module_size / n)
#change order accoridng to distances
Prop_sp_module_island<- Prop_sp_module_2 %>%
mutate(layer_name= case_when(layer_id == '1' ~ 'WesternSahara',
layer_id == '2' ~ 'Fuerteventura',
layer_id == '3' ~ 'GranCanaria',
layer_id == '4' ~ 'TenerifeSouth',
layer_id == '5' ~ 'TenerifeTeno',
layer_id == '6' ~ 'Gomera',
layer_id == '7' ~ 'Hierro'))
Interedges_weight<- ggplot(Prop_sp_module_island, aes(x = module, y = layer_name, fill=Prop_sp )) +
geom_tile(color='white') +
theme_classic() +
scale_fill_viridis_c(limits = c(0, 1)) +
scale_x_continuous(breaks=seq(1,83,4)) +
scale_y_discrete(limits = c("Hierro","Gomera","TenerifeTeno","TenerifeSouth","GranCanaria","Fuerteventura","WesternSahara"))+
labs(x='Module ID', y="Islands")
Interedges_weight
## Distribution of modules across islands
module_data $layer_id<- as.character(module_data $layer_id)
module_data_id  <- module_data  %>%
mutate(layer_name= case_when(layer_id == '1' ~ 'WesternSahara',
layer_id == '2' ~ 'Fuerteventura',
layer_id == '3' ~ 'GranCanaria',
layer_id == '4' ~ 'TenerifeSouth',
layer_id == '5' ~ 'TenerifeTeno',
layer_id == '6' ~ 'Gomera',
layer_id == '7' ~ 'Hierro'))
module_data_id2<-module_data_id %>% select(layer_name, module, size_of_module) %>% unique()
module_data_id2$count <- c(1)
module_data_id3<- module_data_id2%>% unique()  %>% group_by(module) %>%
mutate(tot_island = sum (count)) %>% arrange(desc(tot_island))
# Convert module to an ordered factor and change the order according to number of islands
module_data_id3$module<- as.factor(module_data_id3$module)
module_data_id3$module <- fct_inorder(module_data_id3$module)
write.csv(size, "R/Extra_analysis_results/module_data_id3_higher.csv", row.names = FALSE)
module_data_id3<- read.csv("module_data_id3_higher.csv")
module_data_id3 %>% ggplot(aes(x=module, y= count ,fill= factor(layer_name)))+ geom_bar(stat= "identity")+ theme_classic()+ labs(y="Number of locations", x="Modules")+
guides(fill=guide_legend(title="Location"))+ theme(axis.text.x = element_blank(),
axis.text.y=element_text(size=15), axis.title=element_text(size=17),
legend.text=element_text(size=12.5),legend.title =element_text(size=14))
#write.csv(size, "R/Extra_analysis_results/module_data_id3_higher.csv", row.names = FALSE)
Dist_Inter<-module_data_id3 %>%
ggplot(aes(x=module, y= count ,fill= factor(layer_name)))+ geom_bar(stat= "identity")+ theme_classic()+ labs(y="Number of locations", x="Modules")+
guides(fill=guide_legend(title="Location"))+ theme(axis.text.x = element_blank(),
axis.text.y=element_text(size=15), axis.title = element_text(size=17),
legend.text=element_text(size=12.5),legend.title =element_text(size=14))
module_data_id3<- read.csv("module_data_id3_higher.csv")
View(module_data_id3)
write.csv(size, "R/Extra_analysis_results/module_data_id3_higher.csv", row.names = FALSE)
module_data_id3<- read.csv("module_data_id3_higher.csv")
module_data_id3 %>% ggplot(aes(x=module, y= count ,fill= factor(layer_name)))+ geom_bar(stat= "identity")+ theme_classic()+ labs(y="Number of locations", x="Modules")+
guides(fill=guide_legend(title="Location"))+ theme(axis.text.x = element_blank(),
axis.text.y=element_text(size=15), axis.title=element_text(size=17),
legend.text=element_text(size=12.5),legend.title =element_text(size=14))
View(module_data_id3)
## Distribution of modules across islands
module_data $layer_id<- as.character(module_data $layer_id)
module_data_id  <- module_data  %>%
mutate(layer_name= case_when(layer_id == '1' ~ 'WesternSahara',
layer_id == '2' ~ 'Fuerteventura',
layer_id == '3' ~ 'GranCanaria',
layer_id == '4' ~ 'TenerifeSouth',
layer_id == '5' ~ 'TenerifeTeno',
layer_id == '6' ~ 'Gomera',
layer_id == '7' ~ 'Hierro'))
module_data_id2<-module_data_id %>% select(layer_name, module, size_of_module) %>% unique()
module_data_id2$count <- c(1)
module_data_id3<- module_data_id2%>% unique()  %>% group_by(module) %>%
mutate(tot_island = sum (count)) %>% arrange(desc(tot_island))
View(module_data_id3)
# Convert module to an ordered factor and change the order according to number of islands
module_data_id3$module<- as.factor(module_data_id3$module)
module_data_id3$module <- fct_inorder(module_data_id3$module)
View(module_data_id3)
write.csv(size, "R/Extra_analysis_results/module_data_id3_higher.csv", row.names = FALSE)
module_data_id3<- read.csv("module_data_id3_higher.csv")
module_data_id3 %>% ggplot(aes(x=module, y= count ,fill= factor(layer_name)))+ geom_bar(stat= "identity")+ theme_classic()+ labs(y="Number of locations", x="Modules")+
guides(fill=guide_legend(title="Location"))+ theme(axis.text.x = element_blank(),
axis.text.y=element_text(size=15), axis.title=element_text(size=17),
legend.text=element_text(size=12.5),legend.title =element_text(size=14))
write.csv(module_data_id3, "R/Extra_analysis_results/module_data_id3_higher.csv", row.names = FALSE)
module_data_id3<- read.csv("module_data_id3_higher.csv")
module_data_id3 %>% ggplot(aes(x=module, y= count ,fill= factor(layer_name)))+ geom_bar(stat= "identity")+ theme_classic()+ labs(y="Number of locations", x="Modules")+
guides(fill=guide_legend(title="Location"))+ theme(axis.text.x = element_blank(),
axis.text.y=element_text(size=15), axis.title=element_text(size=17),
legend.text=element_text(size=12.5),legend.title =element_text(size=14))
module_data_id2<-module_data_id %>% select(layer_name, module, size_of_module) %>% unique()
module_data_id2$count <- c(1)
module_data_id3<- module_data_id2%>% unique()  %>% group_by(module) %>%
mutate(tot_island = sum (count)) %>% arrange(desc(tot_island))
# Convert module to an ordered factor and change the order according to number of islands
module_data_id3$module<- as.factor(module_data_id3$module)
module_data_id3$module <- fct_inorder(module_data_id3$module)
write.csv(module_data_id3, "R/Extra_analysis_results/module_data_id3_higher.csv", row.names = FALSE)
module_data_id3<- read.csv("module_data_id3_higher.csv")
module_data_id3 %>% ggplot(aes(x=module, y= count ,fill= factor(layer_name)))+ geom_bar(stat= "identity")+ theme_classic()+ labs(y="Number of locations", x="Modules")+
guides(fill=guide_legend(title="Location"))+ theme(axis.text.x = element_blank(),
axis.text.y=element_text(size=15), axis.title=element_text(size=17),
legend.text=element_text(size=12.5),legend.title =element_text(size=14))
## Distribution of modules across islands
module_data $layer_id<- as.character(module_data $layer_id)
module_data_id  <- module_data  %>%
mutate(layer_name= case_when(layer_id == '1' ~ 'WesternSahara',
layer_id == '2' ~ 'Fuerteventura',
layer_id == '3' ~ 'GranCanaria',
layer_id == '4' ~ 'TenerifeSouth',
layer_id == '5' ~ 'TenerifeTeno',
layer_id == '6' ~ 'Gomera',
layer_id == '7' ~ 'Hierro'))
module_data_id2<-module_data_id %>% select(layer_name, module, size_of_module) %>% unique()
module_data_id2$count <- c(1)
module_data_id3<- module_data_id2%>% unique()  %>% group_by(module) %>%
mutate(tot_island = sum (count)) %>% arrange(desc(tot_island))
# Convert module to an ordered factor and change the order according to number of islands
module_data_id3$module<- as.factor(module_data_id3$module)
module_data_id3$module <- fct_inorder(module_data_id3$module)
View(module_data_id3)
write.csv(module_data_id3, "R/Extra_analysis_results/module_data_id3_higher.csv", row.names = FALSE)
Dist_Inter<-module_data_id3 %>%
ggplot(aes(x=module, y= count ,fill= factor(layer_name)))+ geom_bar(stat= "identity")+ theme_classic()+ labs(y="Number of locations", x="Modules")+
guides(fill=guide_legend(title="Location"))+ theme(axis.text.x = element_blank(),
axis.text.y=element_text(size=15), axis.title = element_text(size=17),
legend.text=element_text(size=12.5),legend.title =element_text(size=14))
Dist_Inter
module_data_id3<- read.csv("module_data_id3_higher.csv")
module_data_id3 %>% ggplot(aes(x=module, y= count ,fill= factor(layer_name)))+ geom_bar(stat= "identity")+ theme_classic()+ labs(y="Number of locations", x="Modules")+
guides(fill=guide_legend(title="Location"))+ theme(axis.text.x = element_blank(),
axis.text.y=element_text(size=15), axis.title=element_text(size=17),
legend.text=element_text(size=12.5),legend.title =element_text(size=14))
Dist_Inter<-module_data_id3 %>%
ggplot(aes(x=module, y= count ,fill= factor(layer_name)))+ geom_bar(stat= "identity")+ theme_classic()+ labs(y="Number of locations", x="Modules")+
guides(fill=guide_legend(title="Location"))+ theme(axis.text.x = element_blank(),
axis.text.y=element_text(size=15), axis.title = element_text(size=17),
legend.text=element_text(size=12.5),legend.title =element_text(size=14))
Dist_Inter_high<-module_data_id3 %>%
ggplot(aes(x=module, y= count ,fill= factor(layer_name)))+ geom_bar(stat= "identity")+ theme_classic()+ labs(y="Number of locations", x="Modules")+
guides(fill=guide_legend(title="Location"))+ theme(axis.text.x = element_blank(),
axis.text.y=element_text(size=15), axis.title = element_text(size=17),
legend.text=element_text(size=12.5),legend.title =element_text(size=14))
## Distribution of modules across islands
module_data $layer_id<- as.character(module_data $layer_id)
module_data_id  <- module_data  %>%
mutate(layer_name= case_when(layer_id == '1' ~ 'WesternSahara',
layer_id == '2' ~ 'Fuerteventura',
layer_id == '3' ~ 'GranCanaria',
layer_id == '4' ~ 'TenerifeSouth',
layer_id == '5' ~ 'TenerifeTeno',
layer_id == '6' ~ 'Gomera',
layer_id == '7' ~ 'Hierro'))
module_data_id2<-module_data_id %>% select(layer_name, module, size_of_module) %>% unique()
module_data_id2$count <- c(1)
module_data_id3<- module_data_id2%>% unique()  %>% group_by(module) %>%
mutate(tot_island = sum (count)) %>% arrange(desc(tot_island))
# Convert module to an ordered factor and change the order according to number of islands
module_data_id3$module<- as.factor(module_data_id3$module)
module_data_id3$module <- fct_inorder(module_data_id3$module)
#write.csv(module_data_id3, "R/Extra_analysis_results/module_data_id3_higher.csv", row.names = FALSE)
Dist_Inter<-module_data_id3 %>%
ggplot(aes(x=module, y= count ,fill= factor(layer_name)))+ geom_bar(stat= "identity")+ theme_classic()+ labs(y="Number of locations", x="Modules")+
guides(fill=guide_legend(title="Location"))+ theme(axis.text.x = element_blank(),
axis.text.y=element_text(size=15), axis.title = element_text(size=17),
legend.text=element_text(size=12.5),legend.title =element_text(size=14))
Dist_Inter
write.csv(module_data_id3, "R/Extra_analysis_results/module_data_id3_higher.csv", row.names = FALSE)
module_data_id3<- read.csv("module_data_id3_higher.csv")
module_data_id3$module<- as.factor(module_data_id3$module)
module_data_id3$module <- fct_inorder(module_data_id3$module)
Dist_Inter_high<-module_data_id3 %>%
ggplot(aes(x=module, y= count ,fill= factor(layer_name)))+ geom_bar(stat= "identity")+ theme_classic()+ labs(y="Number of locations", x="Modules")+
guides(fill=guide_legend(title="Location"))+ theme(axis.text.x = element_blank(),
axis.text.y=element_text(size=15), axis.title = element_text(size=17),
legend.text=element_text(size=12.5),legend.title =element_text(size=14))
Dist_Inter_high
##-- Plot modules in each island with size proportion
#arrange data to include  modules sizes
size <- count(man_mod$modules, module)  #create a data frame of all modules and how many nodes are in each (size of module)
module_data <- merge(man_mod$modules , size, by=c("module","module")) #merge size of module with all the other info about the modules
colnames(module_data)[7] <- "size_of_module" #rename column
#Calculate number of nodes in each module per island
N_species_mod<-module_data %>%
group_by(layer_id, module) %>%
summarize(module_size=n_distinct(node_id))
#Create dataframe with total number of nodes per module across islands
Module_size <- module_data %>% count(module) #num of nodes in module.
#merge dataframes and calculate proportion of species in each module
Prop_sp_module <- left_join(N_species_mod,Module_size)
Prop_sp_module_2<-Prop_sp_module %>%
mutate(Prop_sp = module_size / n)
#change order accoridng to distances
Prop_sp_module_island<- Prop_sp_module_2 %>%
mutate(layer_name= case_when(layer_id == '1' ~ 'WesternSahara',
layer_id == '2' ~ 'Fuerteventura',
layer_id == '3' ~ 'GranCanaria',
layer_id == '4' ~ 'TenerifeSouth',
layer_id == '5' ~ 'TenerifeTeno',
layer_id == '6' ~ 'Gomera',
layer_id == '7' ~ 'Hierro'))
write.csv(Prop_sp_module_island, "R/Extra_analysis_results/Prop_sp_module_island.csv", row.names = FALSE)
Interedges_weight<- ggplot(Prop_sp_module_island, aes(x = module, y = layer_name, fill=Prop_sp )) +
geom_tile(color='white') +
theme_classic() +
scale_fill_viridis_c(limits = c(0, 1)) +
scale_x_continuous(breaks=seq(1,83,4)) +
scale_y_discrete(limits = c("Hierro","Gomera","TenerifeTeno","TenerifeSouth","GranCanaria","Fuerteventura","WesternSahara"))+
labs(x='Module ID', y="Islands")
write.csv(Prop_sp_module_island, "R/Extra_analysis_results/Prop_sp_module_island_higher.csv", row.names = FALSE)
Prop_sp_module_island<- read.csv("Prop_sp_module_island_higher.csv")
Interedges_weight<- ggplot(Prop_sp_module_island, aes(x = module, y = layer_name, fill=Prop_sp )) +
geom_tile(color='white') +
theme_classic() +
scale_fill_viridis_c(limits = c(0, 1)) +
scale_x_continuous(breaks=seq(1,83,4)) +
scale_y_discrete(limits = c("Hierro","Gomera","TenerifeTeno","TenerifeSouth","GranCanaria","Fuerteventura","WesternSahara"))+
labs(x='Module ID', y="Islands")
Interedges_weight
##- Low interedges value
inter_extended$weight <- 0.1
man<-create_multilayer_object(intra = intra_nonextended,
inter = inter_extended,
nodes = physical_nodes, #nodes are always the same. we're not deleting nodes.
layers = layer_metadata, #layers are always the same. we're not deleting layers.
intra_output_extended = T)
man_mod <- run_infomap_multilayer(man, relax = F, silent = T, trials = 100, seed = 497294, multilayer_relax_rate = r, multilayer_relax_limit_up = 1, multilayer_relax_limit_down = 0, temporal_network = F)
##-- Plot modules in each island with size proportion
#arrange data to include  modules sizes
size <- count(man_mod$modules, module)  #create a data frame of all modules and how many nodes are in each (size of module)
module_data <- merge(man_mod$modules , size, by=c("module","module")) #merge size of module with all the other info about the modules
colnames(module_data)[7] <- "size_of_module" #rename column
#Calculate number of nodes in each module per island
N_species_mod<-module_data %>%
group_by(layer_id, module) %>%
summarize(module_size=n_distinct(node_id))
#Create dataframe with total number of nodes per module across islands
Module_size <- module_data %>% count(module) #num of nodes in module.
## Distribution of modules across islands
module_data $layer_id<- as.character(module_data $layer_id)
module_data_id  <- module_data  %>%
mutate(layer_name= case_when(layer_id == '1' ~ 'WesternSahara',
layer_id == '2' ~ 'Fuerteventura',
layer_id == '3' ~ 'GranCanaria',
layer_id == '4' ~ 'TenerifeSouth',
layer_id == '5' ~ 'TenerifeTeno',
layer_id == '6' ~ 'Gomera',
layer_id == '7' ~ 'Hierro'))
module_data_id2<-module_data_id %>% select(layer_name, module, size_of_module) %>% unique()
module_data_id2$count <- c(1)
module_data_id3<- module_data_id2%>% unique()  %>% group_by(module) %>%
mutate(tot_island = sum (count)) %>% arrange(desc(tot_island))
# Convert module to an ordered factor and change the order according to number of islands
module_data_id3$module<- as.factor(module_data_id3$module)
module_data_id3$module <- fct_inorder(module_data_id3$module)
write.csv(module_data_id3, "R/Extra_analysis_results/module_data_id3_lower.csv", row.names = FALSE)
Dist_Inter_low<-module_data_id3 %>%
ggplot(aes(x=module, y= count ,fill= factor(layer_name)))+ geom_bar(stat= "identity")+ theme_classic()+ labs(y="Number of locations", x="Modules")+
guides(fill=guide_legend(title="Location"))+ theme(axis.text.x = element_blank(),
axis.text.y=element_text(size=15), axis.title = element_text(size=17),
legend.text=element_text(size=12.5),legend.title =element_text(size=14))
module_data_id3<- read.csv("module_data_id3_lower.csv")
module_data_id3$module<- as.factor(module_data_id3$module)
module_data_id3$module <- fct_inorder(module_data_id3$module)
Dist_Inter_lower<-module_data_id3 %>%
ggplot(aes(x=module, y= count ,fill= factor(layer_name)))+ geom_bar(stat= "identity")+ theme_classic()+ labs(y="Number of locations", x="Modules")+
guides(fill=guide_legend(title="Location"))+ theme(axis.text.x = element_blank(),
axis.text.y=element_text(size=15), axis.title = element_text(size=17),
legend.text=element_text(size=12.5),legend.title =element_text(size=14))
Dist_Inter_lower
##-- Plot modules in each island with size proportion
#arrange data to include  modules sizes
size <- count(man_mod$modules, module)  #create a data frame of all modules and how many nodes are in each (size of module)
module_data <- merge(man_mod$modules , size, by=c("module","module")) #merge size of module with all the other info about the modules
colnames(module_data)[7] <- "size_of_module" #rename column
#Calculate number of nodes in each module per island
N_species_mod<-module_data %>%
group_by(layer_id, module) %>%
summarize(module_size=n_distinct(node_id))
#Create dataframe with total number of nodes per module across islands
Module_size <- module_data %>% count(module) #num of nodes in module.
#merge dataframes and calculate proportion of species in each module
Prop_sp_module <- left_join(N_species_mod,Module_size)
Prop_sp_module_2<-Prop_sp_module %>%
mutate(Prop_sp = module_size / n)
#change order accoridng to distances
Prop_sp_module_island<- Prop_sp_module_2 %>%
mutate(layer_name= case_when(layer_id == '1' ~ 'WesternSahara',
layer_id == '2' ~ 'Fuerteventura',
layer_id == '3' ~ 'GranCanaria',
layer_id == '4' ~ 'TenerifeSouth',
layer_id == '5' ~ 'TenerifeTeno',
layer_id == '6' ~ 'Gomera',
layer_id == '7' ~ 'Hierro'))
write.csv(Prop_sp_module_island, "R/Extra_analysis_results/Prop_sp_module_island_lower.csv", row.names = FALSE)
Interedges_weight_low<- ggplot(Prop_sp_module_island, aes(x = module, y = layer_name, fill=Prop_sp )) +
geom_tile(color='white') +
theme_classic() +
scale_fill_viridis_c(limits = c(0, 1)) +
scale_x_continuous(breaks=seq(1,83,4)) +
scale_y_discrete(limits = c("Hierro","Gomera","TenerifeTeno","TenerifeSouth","GranCanaria","Fuerteventura","WesternSahara"))+
labs(x='Module ID', y="Islands")
Interedges_weight_low
Prop_sp_module_island<- read.csv("Prop_sp_module_island_lower.csv")
Interedges_weight<- ggplot(Prop_sp_module_island, aes(x = module, y = layer_name, fill=Prop_sp )) +
geom_tile(color='white') +
theme_classic() +
scale_fill_viridis_c(limits = c(0, 1)) +
scale_x_continuous(breaks=seq(1,83,4)) +
scale_y_discrete(limits = c("Hierro","Gomera","TenerifeTeno","TenerifeSouth","GranCanaria","Fuerteventura","WesternSahara"))+
labs(x='Module ID', y="Islands")
