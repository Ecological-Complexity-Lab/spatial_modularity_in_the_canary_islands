theme(axis.text.y=element_text(size=15))+ theme(legend.title = element_text(size = 13),legend.text = element_text(size = 13))+
labs(x="Distance in Km", y="Jaccard Similarity")+
theme(panel.grid = element_blank(),
panel.border = element_rect(color = "black",fill = NA,size = 1),
panel.spacing = unit(0.5, "cm", data = NULL),
axis.text = element_text(size=14, color='black'),
axis.title = element_text(size=14, color='black'),
axis.line = element_blank()) + stat_cor(aes(label = after_stat(rr.label)), label.x = 400, label.y = c(0.36, 0.34, 0.32, 0.30))
#---- graphs for distance decay in species-----------------------------------------------------
turnover_shuf_and_empirical <- rbind(empirical_turnover_for_shuf, ave_turnover_for_shuf_pols, ave_turnover_for_shuf_plants, ave_turnover_for_shuf_both)
turnover_shuf_and_empirical <- turnover_shuf_and_empirical %>% mutate(distance_in_km = distance_in_meters/1000)
turnover_shuf_and_empirical %>%
ggplot(aes(x= distance_in_km, y= ave, group= type, color= type))+
geom_point()+ geom_errorbar(aes(ymin= ave-sd, ymax= ave+sd))+ theme_classic()+ geom_smooth(method= "lm", se=F)+
theme(axis.title=element_text(size=22))+theme(axis.text.x=element_text(size=15))+
theme(axis.text.y=element_text(size=15))+ theme(legend.title = element_text(size = 13),legend.text = element_text(size = 13))+
labs(x="Distance in Km", y="Jaccard Similarity")+
theme(panel.grid = element_blank(),
panel.border = element_rect(color = "black",fill = NA,size = 1),
panel.spacing = unit(0.5, "cm", data = NULL),
axis.text = element_text(size=14, color='black'),
axis.title = element_text(size=14, color='black'),
axis.line = element_blank()) + stat_cor(aes(label = after_stat(rr.label)), label.x = 400, label.y = c(0.36, 0.34, 0.32, 0.30))
knitr::opts_chunk$set(echo = FALSE, results = "asis", message=FALSE, warning=FALSE, cache=TRUE, eval = TRUE, dev = c('png'), out.width = '100%', out.height='40%')
iteration_correlation_pols <- read.csv("./csvs/iteration_correlation_pols.csv")
iteration_correlation_pols <- read.csv("iteration_correlation_pols.csv")
iteration_correlation_pols <- read.csv("iteration_correlation_pols.csv")
iteration_correlation_pols <- read.csv("iteration_correlation_pols.csv")
iteration_correlation_pols <- read.csv("iteration_correlation_pols.csv")
iteration_correlation_interactions<- read.csv("iteration_correlation_interactions.csv")
correlation_empirical_interactions <- read.csv("correlation_empirical_pols.csv")
interactions_for_beta_diversity <- iteration_correlation_interactions
interactions_for_beta_diversity$type <- "shuffling_interactions"
species_for_beta_diversity <- iteration_correlation_pols
species_for_beta_diversity$type <- "shuffling_species"
correlation_beta_diversity <- rbind(interactions_for_beta_diversity, species_for_beta_diversity)
correlation_beta_diversity %>% ggplot(aes(x = rsquared, color = type, fill = type))+ #overlay shuffling of interactions and species
geom_density(alpha = 0.4)+ scale_color_manual(values = c("#0033cc", "#BE75FA"))+
scale_fill_manual(values = c("#0033cc", "#BE75FA"))+
theme_classic()+ labs(x = "R squared")+
geom_vline(xintercept = correlation_empirical_interactions$rsquared, linetype = "dashed", color = "#F47069")
knitr::opts_chunk$set(echo = FALSE, results = "asis", message=FALSE, warning=FALSE, cache=TRUE, eval = TRUE, dev = c('png'), out.width = '100%', out.height='40%')
library(infomapecology)
library(igraph)
library(bipartite)
library(tidyverse)
library(magrittr)
library(betalink)
library(readxl)
library(ggalluvial)
library(scatterpie)
library(reshape2)
library(ggforce)
library(ggmap)
library(ggraph)
library(ggpubr)
rm(list=ls())
classic_layers_turnover_with_distances <- read.csv("classic_layers_turnover_with_distances.csv")
classic_layers_turnover_with_distances <- classic_layers_turnover_with_distances%>% mutate(distance_in_km=distance_in_meters/1000)
classic_layers_turnover_with_distances %>%
ggplot(aes(x=distance_in_km, y=turnover))+ geom_point(color = "indianred2")+ theme_classic()+
stat_smooth(method= "lm", se=F, color = "indianred2")+
theme(axis.title=element_text(size=22))+theme(axis.text.x=element_text(size=15))+
theme(axis.text.y=element_text(size=15))+
labs(x="Distance in Km", y="Jaccard Similarity")+
stat_cor(aes(label = after_stat(rr.label)), label.x = 400, label.y = c(0.36, 0.34, 0.32, 0.30))+
theme(panel.grid = element_blank(),
panel.border = element_rect(color = "black",fill = NA,size = 1),
panel.spacing = unit(0.5, "cm", data = NULL),
axis.text = element_text(size=14, color='black'),
axis.title = element_text(size=14, color='black'),
axis.line = element_blank())
classic_layers_turnover_with_distances_shuf_pols <- read.csv("classic_layers_turnover_with_distances_shuf_pols.csv")
classic_layers_turnover_with_distances_shuf_plants <- read.csv("classic_layers_turnover_with_distances_shuf_plants.csv")
classic_layers_turnover_with_distances_shuf_both <- read.csv("classic_layers_turnover_with_distances_shuf_both.csv")
#create an average for shuf with sd
#pols
ave_turnover_for_shuf_pols <- classic_layers_turnover_with_distances_shuf_pols %>%
group_by(layer_from, layer_to, distance_in_meters) %>%
summarise(ave=mean(turnover), sd=sd(turnover)) %>% mutate(type="null_pollinators") #create mean and sd for each point
#plants
ave_turnover_for_shuf_plants <- classic_layers_turnover_with_distances_shuf_plants %>%
group_by(layer_from, layer_to, distance_in_meters) %>%
summarise(ave=mean(turnover), sd=sd(turnover)) %>% mutate(type="null_plants") #create mean and sd for each point
#both
ave_turnover_for_shuf_both <- classic_layers_turnover_with_distances_shuf_both %>%
group_by(layer_from, layer_to, distance_in_meters) %>%
summarise(ave=mean(turnover), sd=sd(turnover)) %>% mutate(type="null_both") #create mean and sd for each point
#empirical
classic_layers_turnover_with_distances <- read.csv("classic_layers_turnover_with_distances.csv")
empirical_turnover_for_shuf <- classic_layers_turnover_with_distances %>%
group_by(layer_from, layer_to, distance_in_meters) %>%
summarise(ave=mean(turnover), sd=sd(turnover)) %>% mutate(type="empirical")
#---- graphs for distance decay in species-----------------------------------------------------
turnover_shuf_and_empirical <- rbind(empirical_turnover_for_shuf, ave_turnover_for_shuf_pols, ave_turnover_for_shuf_plants, ave_turnover_for_shuf_both)
turnover_shuf_and_empirical <- turnover_shuf_and_empirical %>% mutate(distance_in_km = distance_in_meters/1000)
turnover_shuf_and_empirical %>%
ggplot(aes(x= distance_in_km, y= ave, group= type, color= type))+
geom_point()+ geom_errorbar(aes(ymin= ave-sd, ymax= ave+sd))+ theme_classic()+ geom_smooth(method= "lm", se=F)+
theme(axis.title=element_text(size=22))+theme(axis.text.x=element_text(size=15))+
theme(axis.text.y=element_text(size=15))+ theme(legend.title = element_text(size = 13),legend.text = element_text(size = 13))+
labs(x="Distance in Km", y="Jaccard Similarity")+
theme(panel.grid = element_blank(),
panel.border = element_rect(color = "black",fill = NA,size = 1),
panel.spacing = unit(0.5, "cm", data = NULL),
axis.text = element_text(size=14, color='black'),
axis.title = element_text(size=14, color='black'),
axis.line = element_blank()) + stat_cor(aes(label = after_stat(rr.label)), label.x = 400, label.y = c(0.36, 0.34, 0.32, 0.30))
layers_turnover_with_distnace_empirical <- read.csv("layers_turnover_with_distnace_empirical.csv")
#---- graphs for distance decay in modules empirical---
layers_turnover_with_distnace_empirical %>%
ggplot(aes(x=distance_in_km, y=turnover))+
geom_point(color = "indianred2")+ scale_x_continuous()+theme_classic()+
stat_smooth(method= "lm", se = F, color = "indianred2")+
theme(axis.title=element_text(size=22))+theme(axis.text.x=element_text(size=15))+
theme(axis.text.y=element_text(size=15))+
labs(x="Distance in Km", y="Jaccard Similarity")+stat_cor(aes(label = after_stat(rr.label)), label.x = 400, label.y = c(0.36, 0.34, 0.32, 0.30))+
theme(panel.grid = element_blank(),
panel.border = element_rect(color = "black",fill = NA,size = 1),
panel.spacing = unit(0.5, "cm", data = NULL),
axis.text = element_text(size=14, color='black'),
axis.title = element_text(size=14, color='black'),
axis.line = element_blank())
jaccard_similarity_layer_empirical_and_null_no_self_loop_km <- read.csv("jaccard_similarity_layer_empirical_and_null_no_self_loop_km.csv")
#---- graphs for distance decay in modules empirical and null model 1---
jaccard_similarity_layer_empirical_and_null_no_self_loop_km %>%
ggplot(aes(x= ave_dist, y= ave, group= type, color= type))+
geom_point()+ geom_errorbar(aes(ymin= ave-sd, ymax= ave+sd))+ theme_classic()+ geom_smooth(method= "lm", se=F)+
theme(axis.title=element_text(size=22))+theme(axis.text.x=element_text(size=15))+
theme(axis.text.y=element_text(size=15))+ theme(legend.title = element_text(size = 13), legend.text = element_text(size = 13))+
labs(x="Distance in Km", y="Jaccard Similarity")+
stat_cor(aes(label = after_stat(rr.label)), label.x = 400, label.y = c(0.60, 0.56, 0.52, 0.48))+
theme(panel.grid = element_blank(),
panel.border = element_rect(color = "black",fill = NA,size = 1),
panel.spacing = unit(0.5, "cm", data = NULL),
axis.text = element_text(size=14, color='black'),
axis.title = element_text(size=14, color='black'),
axis.line = element_blank())
correlation_empirical_pols <- read.csv("correlation_empirical_pols.csv")
rqsuares_M1_all <- read.csv("rqsuares_M1_all.csv")
group_color <- c(shuf_pollinators = "#BE75FA",
shuf_plants = "#15B7BC",
shuf_both = "#72A323")
rqsuares_M1_all %>%
ggplot(aes(x = rsquared, fill = type))+
geom_density(alpha = 0.4)+
theme_classic()+ labs(x = "R squared")+
geom_vline(xintercept = correlation_empirical_pols$rsquared, linetype = "dashed", color = "#F47069")+
theme(axis.title=element_text(size=22))+
theme(panel.grid = element_blank(),
panel.border = element_rect(color = "black",fill = NA,size = 1),
panel.spacing = unit(0.5, "cm", data = NULL),
axis.text = element_text(size=14, color='black'),
axis.title = element_text(size=14, color='black'),
axis.line = element_blank())+
scale_fill_manual(values = group_color)
#Shuffled
all_edge_list_sites_combine_no_module_shuf_classic <- read.csv("all_edge_list_sites_combine_no_module_shuf_classic.csv")
ave_module_sites_turnover_shuf_classic <- all_edge_list_sites_combine_no_module_shuf_classic %>%
group_by(layer_from, layer_to) %>%
summarise(ave=mean(turnover), sd=sd(turnover), ave_dist=mean(ave_distance)) %>% mutate(type="null_model_within") #create mean and sd for each point
#add the empirical empirical
sites_turnover_with_distnace_empirical <- read.csv("sites_turnover_with_distnace_empirical.csv")
empirical_turnover_for_module_site_shuf <- sites_turnover_with_distnace_empirical %>% group_by(layer_from, layer_to) %>%
summarise(ave=mean(turnover), sd=sd(turnover), ave_dist=mean(distance_in_km)) %>% mutate(ave_dist= ave_dist*1000,
type="empirical") #make sure sd is 0 cause its the empirical and not null
empirical_turnover_for_module_site_shuf_no_self_loop_classic <- empirical_turnover_for_module_site_shuf %>%
subset(layer_from != layer_to) #distance decay graph for empirical
empirical_turnover_for_module_site_shuf_no_self_loop_km_classic <- empirical_turnover_for_module_site_shuf_no_self_loop_classic %>%
mutate(ave_dist_in_m = ave_dist*1000) #From km to m
##---- combine empirical and shuffle
jaccard_similarity_empirical_and_null_model <- rbind(empirical_turnover_for_module_site_shuf, ave_module_sites_turnover_shuf_classic)
jaccard_similarity_empirical_and_null_no_self_loop_classic <- jaccard_similarity_empirical_and_null_model %>% subset(layer_from != layer_to)
jaccard_similarity_empirical_and_null_no_self_loop_km_classic <- jaccard_similarity_empirical_and_null_no_self_loop_classic %>%
mutate(ave_dist_in_km = ave_dist/1000) #all data set from m to km
just_empirical_within <- jaccard_similarity_empirical_and_null_no_self_loop_km_classic %>% filter(type == "empirical")
jaccard_similarity_empirical_and_null_no_self_loop_km_classic %>% ggplot(aes(x= ave_dist_in_km, y= ave, group= type, color= type))+
geom_point()+ geom_errorbar(aes(ymin= ave-sd, ymax= ave+sd))+ theme_classic()+ geom_smooth(method= "lm", se=F)+
theme(axis.title=element_text(size=22))+theme(axis.text.x=element_text(size=15))+
theme(axis.text.y=element_text(size=15))+ theme(legend.title = element_text(size = 13), legend.text = element_text(size = 13))+
labs(x="Distance in Km", y="Jaccard Similarity")+ stat_cor(aes(label = ..p.label..), label.x = 400)+
stat_cor(aes(label = ..rr.label..), label.x = 400, label.y = c(0.57, 0.54))+ scale_color_manual(values = c("#F47069", "#c4067c"))
correlation_empirical_classic <- read.csv("correlation_empirical_pols.csv")
iteration_correlation_classic <- read.csv("iteration_correlation_classic.csv")
#Distribution of rsquared and add empirical
iteration_correlation_classic %>% ggplot(aes(x = rsquared))+
geom_density(fill = "#c4067c", color = "#c4067c", alpha = 0.4)+
theme_classic()+ labs(x = "R squared")+
geom_vline(xintercept = correlation_empirical_classic$rsquared, linetype = "dashed", color = "#F47069")
jaccard_similarity_empirical_and_null_interactions_no_self_loop_km <- read.csv("jaccard_similarity_empirical_and_null_interactions_no_self_loop_km.csv")
jaccard_similarity_empirical_and_null_interactions_no_self_loop_km %>% ggplot(aes(x= ave_dist_in_km, y= ave, group= type, color= type))+
geom_point()+ geom_errorbar(aes(ymin= ave-sd, ymax= ave+sd))+ theme_classic()+ geom_smooth(method= "lm", se=F)+
theme(axis.title=element_text(size=22))+theme(axis.text.x=element_text(size=15))+
theme(axis.text.y=element_text(size=15))+ theme(legend.title = element_text(size = 13), legend.text = element_text(size = 13))+
labs(x="Distance in Km", y="Jaccard Similarity")+ stat_cor(aes(label = ..p.label..), label.x = 400)+
stat_cor(aes(label = ..rr.label..), label.x = 400, label.y = c(0.63, 0.60, 0.57, 0.54))+
scale_color_manual(values = c("#F47069", "#0033cc"))
correlation_empirical_interactions <- read.csv("correlation_empirical_pols.csv")
iteration_correlation_interactions  <- read.csv("iteration_correlation_interactions.csv")
#Distribution of rsquared and add empirical
iteration_correlation_interactions %>% ggplot(aes(x = rsquared))+
geom_density(fill = "#0033cc", color = "#0033cc", alpha = 0.4)+
theme_classic()+ labs(x = "R squared")+
geom_vline(xintercept = correlation_empirical_interactions$rsquared, linetype = "dashed", color = "#F47069")
iteration_correlation_pols <- read.csv("iteration_correlation_pols.csv")
iteration_correlation_interactions<- read.csv("iteration_correlation_interactions.csv")
correlation_empirical_interactions <- read.csv("correlation_empirical_pols.csv")
interactions_for_beta_diversity <- iteration_correlation_interactions
interactions_for_beta_diversity$type <- "shuffling_interactions"
species_for_beta_diversity <- iteration_correlation_pols
species_for_beta_diversity$type <- "shuffling_species"
correlation_beta_diversity <- rbind(interactions_for_beta_diversity, species_for_beta_diversity)
correlation_beta_diversity %>% ggplot(aes(x = rsquared, color = type, fill = type))+ #overlay shuffling of interactions and species
geom_density(alpha = 0.4)+ scale_color_manual(values = c("#0033cc", "#BE75FA"))+
scale_fill_manual(values = c("#0033cc", "#BE75FA"))+
theme_classic()+ labs(x = "R squared")+
geom_vline(xintercept = correlation_empirical_interactions$rsquared, linetype = "dashed", color = "#F47069")
jaccard_similarity_empirical_and_fixed_no_self_loop_km<- read.csv("jaccard_similarity_empirical_and_fixed_no_self_loop_km.csv")
jaccard_similarity_empirical_and_fixed_no_self_loop_km %>% ggplot(aes(x= ave_dist_in_km, y= ave, group= type, color= type))+
geom_point()+ geom_errorbar(aes(ymin= ave-sd, ymax= ave+sd))+ theme_classic()+ geom_smooth(method= "lm", se=F)+
theme(axis.title=element_text(size=22))+theme(axis.text.x=element_text(size=15))+
theme(axis.text.y=element_text(size=15))+ theme(legend.title = element_text(size = 13), legend.text = element_text(size = 13))+
labs(x="Distance in Km", y="Jaccard Similarity")+ scale_color_manual(values = c("#F47069", "#c4ad06"))+
theme(panel.grid = element_blank(),
panel.border = element_rect(color = "black",fill = NA,size = 1),
panel.spacing = unit(0.5, "cm", data = NULL),
axis.text = element_text(size=14, color='black'),
axis.title = element_text(size=14, color='black'),
axis.line = element_blank())+ stat_cor(aes(label = ..p.label..), label.x = 400)+stat_cor(aes(label = ..rr.label..), label.x = 400, label.y = c(0.65, 0.62))
classic_layers_turnover_with_distances_island <- read.csv("classic_layers_turnover_with_distances_islands_as_layers.csv")
classic_layers_turnover_with_distances <- classic_layers_turnover_with_distances_island %>%
mutate(distance_in_km=mean_distance/1000) #turn to km
classic_layers_turnover_with_distances %>%
ggplot(aes(x=distance_in_km, y=turnover))+ geom_point(color = "indianred2")+ theme_classic()+
stat_smooth(method= "lm", se=F, color = "indianred2")+
theme(axis.title=element_text(size=22))+theme(axis.text.x=element_text(size=15))+
theme(axis.text.y=element_text(size=15))+
labs(x="Distance in Km", y="Jaccard Similarity")+
stat_cor(aes(label = after_stat(rr.label)), label.x = 400, label.y = c(0.36, 0.34, 0.32, 0.30))+
theme(panel.grid = element_blank(),
panel.border = element_rect(color = "black",fill = NA,size = 1),
panel.spacing = unit(0.5, "cm", data = NULL),
axis.text = element_text(size=14, color='black'),
axis.title = element_text(size=14, color='black'),
axis.line = element_blank())
turnover_shuf_and_empirical <- read.csv("turnover_shuf_and_empirical_islands_as_layers.csv")
turnover_shuf_and_empirical %>% ggplot(aes(x= distance_in_km, y= ave, group= type, color= type))+
geom_point()+ geom_errorbar(aes(ymin= ave-sd, ymax= ave+sd))+ theme_classic()+ geom_smooth(method= "lm", se=F)+
labs(x="Distance in Km", y="Jaccard Similarity")+
theme(panel.grid = element_blank(),
panel.border = element_rect(color = "black",fill = NA,size = 1),
panel.spacing = unit(0.5, "cm", data = NULL),
axis.text = element_text(size=14, color='black'),
axis.title = element_text(size=14, color='black'),
axis.line = element_blank()) + stat_cor(aes(label = ..p.label..), label.x = 400)+
stat_cor(aes(label = ..rr.label..), label.x = 400, label.y = c(0.36, 0.34, 0.32, 0.30))
islands_turnover_with_distnace_empirical <- read.csv("islands_turnover_with_distnace_empirical.csv")
islands_turnover_with_distnace_empirical %>%
ggplot(aes(x=distance_in_km, y=turnover))+
geom_point(color = "indianred2")+
scale_x_continuous()+ stat_smooth(method= "lm", se=F, color = "indianred2")+
theme(axis.title=element_text(size=22))+theme(axis.text.x=element_text(size=15))+
theme(axis.text.y=element_text(size=15))+
labs(x="Distance in Km", y="Jaccard Similarity")+ theme_bw()+
stat_cor(aes(label = after_stat(rr.label)), label.x = 400, label.y = c(0.36, 0.34, 0.32, 0.30))+
theme(panel.grid = element_blank(),
panel.border = element_rect(color = "black",fill = NA,size = 1),
panel.spacing = unit(0.5, "cm", data = NULL),
axis.text = element_text(size=14, color='black'),
axis.title = element_text(size=14, color='black'),
axis.line = element_blank())
jaccard_similarity_layer_empirical_and_null_km <- read.csv("jaccard_similarity_layer_empirical_and_null_km_islands.csv")
jaccard_similarity_layer_empirical_and_null_km %>%
ggplot(aes(x= mean_dist_in_km, y= ave, group= type, color= type))+
geom_point()+ geom_errorbar(aes(ymin= ave-sd, ymax= ave+sd))+ theme_classic()+ geom_smooth(method= "lm", se=F)+
theme(axis.title=element_text(size=22))+theme(axis.text.x=element_text(size=15))+
theme(axis.text.y=element_text(size=15))+ theme(legend.title = element_text(size = 13), legend.text = element_text(size = 13))+
labs(x="Distance in Km", y="Jaccard Similarity")+
stat_cor(aes(label = after_stat(rr.label)), label.x = 400, label.y = c(0.60, 0.56, 0.52, 0.48))+
theme(panel.grid = element_blank(),
panel.border = element_rect(color = "black",fill = NA,size = 1),
panel.spacing = unit(0.5, "cm", data = NULL),
axis.text = element_text(size=14, color='black'),
axis.title = element_text(size=14, color='black'),
axis.line = element_blank()) # stat_cor(aes(label = ..p.label..), label.x = 400)+
correlation_empirical_pols <- read.csv("correlation_empirical_pols_islands.csv")
rqsuares_M1_all <- read.csv("rqsuares_M1_all_islands.csv")
group_color <- c(shuf_pollinators = "#BE75FA",
shuf_plants = "#15B7BC",
shuf_both = "#72A323")
rqsuares_M1_all %>%
ggplot(aes(x = rsquared, fill = type))+
geom_density(alpha = 0.4)+
theme_classic()+ labs(x = "R squared")+
geom_vline(xintercept = correlation_empirical_pols$rsquared, linetype = "dashed", color = "#F47069")+
theme(axis.title=element_text(size=22))+
theme(panel.grid = element_blank(),
panel.border = element_rect(color = "black",fill = NA,size = 1),
panel.spacing = unit(0.5, "cm", data = NULL),
axis.text = element_text(size=14, color='black'),
axis.title = element_text(size=14, color='black'),
axis.line = element_blank())+
scale_fill_manual(values = group_color)
jaccard_similarity_layer_empirical_and_null_km  <- read.csv("jaccard_similarity_layer_empirical_and_null_km_islands.csv")
jaccard_similarity_layer_empirical_and_null_km %>%
ggplot(aes(x= mean_dist_in_km, y= ave, group= type, color= type))+
geom_point()+ geom_errorbar(aes(ymin= ave-sd, ymax= ave+sd))+ theme_classic()+ geom_smooth(method= "lm", se=F)+
theme(axis.title=element_text(size=22))+theme(axis.text.x=element_text(size=15))+
theme(axis.text.y=element_text(size=15))+ theme(legend.title = element_text(size = 13), legend.text = element_text(size = 13))+
labs(x="Distance in Km", y="Jaccard Similarity")+
stat_cor(aes(label = after_stat(rr.label)), label.x = 400, label.y = c(0.60, 0.56, 0.52, 0.48))+
theme(panel.grid = element_blank(),
panel.border = element_rect(color = "black",fill = NA,size = 1),
panel.spacing = unit(0.5, "cm", data = NULL),
axis.text = element_text(size=14, color='black'),
axis.title = element_text(size=14, color='black'),
axis.line = element_blank()) + stat_cor(aes(label = ..p.label..), label.x = 400)
#distribution of rsquared and add empirical
correlation_empirical_interactions <- read.csv("correlation_empirical_interactions_islands.csv")
iteration_correlation_interactions <- read.csv("iteration_correlation_interactions_islands.csv")
iteration_correlation_interactions %>% ggplot(aes(x = rsquared))+
geom_density(fill = "#0033cc", color = "#0033cc", alpha = 0.4)+
theme_classic()+ labs(x = "R squared")+
geom_vline(xintercept = correlation_empirical_interactions$rsquared, linetype = "dashed", color = "#F47069")
##compare both parts of beta diversity (shuffling pollinator species )
iteration_correlation_pols <- read.csv("iteration_correlation_pols_islands.csv")
iteration_correlation_interactions <- read.csv("iteration_correlation_interactions_islands.csv")
correlation_empirical_interactions <- read.csv("correlation_empirical_interactions_islands.csv")
interactions_for_beta_diversity <- iteration_correlation_interactions
interactions_for_beta_diversity$type <- "shuffling_interactions"
species_for_beta_diversity <- iteration_correlation_pols
species_for_beta_diversity$type <- "shuffling_species"
correlation_beta_diversity <- rbind(interactions_for_beta_diversity, species_for_beta_diversity)
correlation_beta_diversity %>% ggplot(aes(x = rsquared, color = type, fill = type))+ #overlay shuffling of interactions and species
geom_density(alpha = 0.4)+ scale_color_manual(values = c("#0033cc", "#BE75FA"))+
scale_fill_manual(values = c("#0033cc", "#BE75FA"))+
theme_classic()+ labs(x = "R squared")+
geom_vline(xintercept = correlation_empirical_interactions$rsquared, linetype = "dashed", color = "#F47069")
jaccard_similarity_empirical_and_fixed_no_self_loop_km<- read.csv("jaccard_similarity_empirical_and_fixed_no_self_loop_km_islands.csv")
jaccard_similarity_empirical_and_fixed_no_self_loop_km %>% ggplot(aes(x= ave_dist_in_km, y= ave, group= type, color= type))+
geom_point()+ geom_errorbar(aes(ymin= ave-sd, ymax= ave+sd))+ theme_classic()+ geom_smooth(method= "lm", se=F)+
theme(axis.title=element_text(size=22))+theme(axis.text.x=element_text(size=15))+
theme(axis.text.y=element_text(size=15))+ theme(legend.title = element_text(size = 13), legend.text = element_text(size = 13))+
labs(x="Distance in Km", y="Jaccard Similarity")+ scale_color_manual(values = c("#F47069", "#c4ad06"))+
theme(panel.grid = element_blank(),
panel.border = element_rect(color = "black",fill = NA,size = 1),
panel.spacing = unit(0.5, "cm", data = NULL),
axis.text = element_text(size=14, color='black'),
axis.title = element_text(size=14, color='black'),
axis.line = element_blank()) + stat_cor(aes(label = ..p.label..), label.x = 400)+
stat_cor(aes(label = ..rr.label..), label.x = 400, label.y = c(0.65, 0.62))
##---load_libraries-------------------------------------------------------------------------------------------------
options(rgl.useNULL = TRUE)
library(infomapecology)
library(igraph)
library(bipartite)
library(tidyverse)
library(magrittr)
library(betalink)
library(readxl)
library(ggalluvial)
library(scatterpie)
library(reshape2)
library(ggforce)
library(ggmap)
library(ggraph)
library(ggpubr)
library(reshape2)
library(extRC)
##----get_data--------------------------------------------------------------------------------------------------------
setwd("/Users/agustin/Desktop/Papers/Canary_Island_Project/spatial_modularity_in_the_canary_islands")
source("/Users/agustin/Desktop/Papers/Canary_Island_Project/spatial_modularity_in_the_canary_islands/R/functions.R")
dryad_intralayer <- read.csv("./csvs/intralayer_file.csv")
dryad_interlayer <- read.csv("./csvs/interlayer_file.csv") #already has inverted within
dryad_intralayer <- read.csv("./csvs/intralayer_file.csv")
dryad_interlayer <- read.csv("./csvs/interlayer_file.csv") #already has inverted within
##---- layers as islands -------------------------------------------------------------------------------
dryad_intralayer_islands <- dryad_intralayer
old_names <- c("WesternSahara1", "WesternSahara2",
"Fuerteventura1", "Fuerteventura2",
"GranCanaria1", "GranCanaria2",
"TenerifeSouth1", "TenerifeSouth2",
"TenerifeTeno1", "TenerifeTeno2",
"Gomera1", "Gomera2",
"Hierro1", "Hierro2")
new_names <- c("WesternSahara", "WesternSahara",
"Fuerteventura", "Fuerteventura",
"GranCanaria", "GranCanaria",
"TenerifeSouth", "TenerifeSouth",
"TenerifeTeno", "TenerifeTeno",
"Gomera", "Gomera",
"Hierro", "Hierro")
dryad_intralayer_islands$layer_from[dryad_intralayer_islands$layer_from %in% old_names] <-
new_names[match(dryad_intralayer_islands$layer_from, old_names)] #change to reflect layer = island
dryad_intralayer_islands$layer_to[dryad_intralayer_islands$layer_to %in% old_names] <-
new_names[match(dryad_intralayer_islands$layer_to, old_names)] #change to reflect layer = island
#if node_from, node_to, layer_from, layer_to are all the same need to sum the weight
dryad_intralayer_islands_grouped <- dryad_intralayer_islands %>%
group_by(layer_from, node_from, layer_to, node_to) %>%
summarise(sum_weight = sum(weight)) #turn sums of sites to sum of island
## ----dryad intralayer interlayer both ways-------------------------------------------------------------------------------------
intralayer_inverted <- tibble(values= dryad_intralayer_islands$layer_to, dryad_intralayer_islands$node_to, dryad_intralayer_islands$layer_from,
dryad_intralayer_islands$node_from, dryad_intralayer_islands$weight) #create an inverted copy for directed intralayers
colnames(intralayer_inverted) <- c("layer_from", "node_from", "layer_to", "node_to", "weight")
## ---- normalize intralayer weights--------------------------------------------------------------------------
#plants in from
tot_plant <- dryad_intralayer_islands %>%
group_by(layer_from,node_from) %>%
dplyr::summarise(tot=sum(weight))
intralayer_weighted <- dryad_intralayer_islands %>% left_join(tot_plant) %>% mutate(rel_weight=weight/tot) %>%
select(-weight,-tot) %>% dplyr::rename(weight=rel_weight)
#pols in from
tot_pol <- intralayer_inverted %>%
group_by(layer_from,node_from) %>%
dplyr::summarise(tot=sum(weight))
intralayer_weighted_inverted <- intralayer_inverted %>% left_join(tot_pol) %>% mutate(rel_weight=weight/tot) %>%
select(-weight,-tot) %>% dplyr::rename(weight=rel_weight)
#Create intraedgelist
edgelist_intralayers_both <- bind_rows(intralayer_weighted, intralayer_weighted_inverted) #combine inverted and non inverted versions of intra
##---- create interedges according to jaccard similarity between partners --------------------------------------------------------
# keep only species that occur in 2 or more layers
co_occurrence<- edgelist_intralayers_both%>%
group_by(node_from) %>%
mutate(num_layers_from=n_distinct(layer_from)) %>%
filter(num_layers_from>="2")
View(co_occurrence)
# a for loop that calculates all the interlayer edges based on jaccard index
interlayers_with_weights_islands <- NULL
prueba<- unique(co_occurrence$node_from)
prueba
# a for loop that calculates all the interlayer edges based on jaccard index
interlayers_with_weights_islands <- NULL
prueba<- unique(co_occurrence$node_from)
prueba
for (i in unique(co_occurrence$node_from)) {
print(i)
partners_sp <-
co_occurrence %>%
filter(node_from== i) %>%
group_by(node_to) %>%
select(c(node_to,layer_from)) %>%
distinct() %>%
mutate(present=1) %>%
spread(node_to, present, fill = 0) %>%
column_to_rownames("layer_from")
beta_layers_sp <- 1-as.matrix(vegdist(partners_sp, "jaccard"))
beta_layers_sp_m <- melt(as.matrix(extRC::tril(beta_layers_sp)))
inter_fid <- beta_layers_sp_m  %>%
tibble() %>%
filter(value!=0) %>%
subset(Var1 != Var2) %>%
mutate(node_from=i, node_to =i) %>%
select(c(node_from,layer_from=Var1, layer_to=Var2,node_to, weight=value))
interlayers_with_weights_islands <- rbind(interlayers_with_weights_islands,inter_fid)
}
## ----multilayer_extended_final--------------------------------------------------------------------------------------
dryad_edgelist_complete <- bind_rows(edgelist_intralayers_both, interlayers_with_weights_islands) #combine weighted version of intra with inter
View(dryad_edgelist_complete)
check<- dryad_edgelist_complete %>% filter(layer_from!=layer_to)
View(check)
#Plot links distribution (directed)
inter_extended<- dryad_edgelist_complete_ids %>% filter(layer_from!=layer_to)
## ----multilayer_extended_final--------------------------------------------------------------------------------------
dryad_edgelist_complete <- bind_rows(edgelist_intralayers_both, interlayers_with_weights_islands) #combine weighted version of intra with inter
## ----node_metadata--------------------------------------------------------------------------------------------------
pollinators <- sort(unique(intralayer_weighted$node_to)) #adding up only pol who haven't been added yet
plants <- sort(unique(intralayer_weighted$node_from)) #adding up only plants who haven't been added yet
intersect(pollinators, plants) #making sure I don't have plants in pol or other way around
A <- length(pollinators) # Number of pollinators
P <- length(plants) # Number of plants
S <- A+P
island_names <- c("WesternSahara", #islands as layers
"Fuerteventura",
"GranCanaria",
"TenerifeSouth",
"TenerifeTeno",
"Gomera",
"Hierro")
# Create a table with node metadata
physical_nodes <- tibble(node_id=1:S, #1 till the last species
type=c(rep('plant',P),rep('pollinator',A)), #replicate the words P and A times
species=c(plants,pollinators)) #add species from plants and pollinators in accordance
layer_metadata <- tibble(layer_id=c(1:7), layer_name=island_names)  #give num to each layer
# Replace the node names with node_ids
dryad_edgelist_complete_ids <-
dryad_edgelist_complete %>%
left_join(physical_nodes, by=c('node_from' = 'species')) %>%  # Join for pollinators
left_join(physical_nodes, by=c('node_to' = 'species')) %>%  # Join for plants
dplyr::select(-node_from, -node_to) %>% #choose said columns
dplyr::select(layer_from, node_from=node_id.x, layer_to, node_to=node_id.y, weight) %>%
left_join(layer_metadata, by=c('layer_from' = 'layer_name')) %>%  # Join for plants
left_join(layer_metadata, by=c('layer_to' = 'layer_name')) %>%  # Join for plants
dplyr::select(-layer_from, -layer_to) %>%
dplyr::select(layer_from=layer_id.x, node_from, layer_to=layer_id.y, node_to, weight)
#Plot links distribution (directed)
inter_extended<- dryad_edgelist_complete_ids %>% filter(layer_from!=layer_to)
View(inter_extended)
#new df with inter and intra in same df with grouping to create distribution
intra_inter_data_for_distibution <- data.frame(values= c(intralayer_weighted$weight,
intralayer_weighted_inverted$weight,
inter_extended$weight),
group= c(rep("intra plants", nrow(intralayer_weighted)),
rep("intra pollinators", nrow(intralayer_weighted_inverted)),
rep("inter", nrow(inter_extended))))
intra_inter_data_for_distibution %>%
ggplot(aes(x=values, fill=group))+ geom_histogram(position= "identity", alpha= 0.6, color= "black")+ theme_bw()+
theme(panel.grid = element_blank(),
panel.border = element_rect(color = "black",fill = NA,size = 1),
panel.spacing = unit(0.5, "cm", data = NULL),
axis.text = element_text(size=14, color='black'),
axis.title = element_text(size=14, color='black'),
axis.line = element_blank())
