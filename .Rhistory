}
edge_list_by_islands_ave_shuf <- edge_list_by_islands_shuf %>% group_by(layer_from, layer_to) %>%
summarise(ave_distance= mean(distance_in_meters)) %>% unique()
islands_turnover_with_distnace <- edge_list_by_islands_ave_shuf %>%
merge(module_island_turnover_shuf, by= c("layer_from", "layer_to")) #merge both versions
}
return(islands_turnover_with_distnace)
}
##---- distance decay in modules layers
module_distance_decay_layer_func_del <- function(multilayer_1000,
layers_turnover_with_distnace){
for (trial in 1:1000){
print(trial)
modules_for_similarity_shuf <- multilayer_1000 %>% filter(trial_num == trial) #%>% #take only 1 trial
#pivot modules
module_pivoted_shuf <- pivot_by_module(modules_for_similarity_shuf) #pivot will be done on 1 trial each time
#create edge list with distances
#similarity between state nodes for modules found in 2 or more layers
modules_edge_list_shuf <- NULL
for (k in (1:nrow(module_pivoted_shuf))){ #run the function for each row in the data frame
modules_edge_list_shuf <- edge_list_per_module(module_pivoted_shuf[k,], modules_edge_list_shuf)
current_module <- rownames(module_pivoted_shuf)[k]
if (is.null(modules_edge_list_shuf)) next
modules_edge_list_shuf <- modules_edge_list_shuf %>% mutate(module = replace_na(module, current_module)) #add module number
}
#view(modules_edge_list)
edge_list_with_distances_shuf <- right_join(modules_edge_list_shuf, distances_with_ids, by= c("layer_from", "layer_to")) #combine the edge list with the distances between each two layers
edge_list_with_distances_shuf <- na.omit(edge_list_with_distances_shuf) #remove NA and delete layer name
#version with # of modules in layers
edge_list_by_layers_modules_shuf <- edge_list_with_distances_shuf %>% group_by(layer_from, layer_to, module) %>%
summarise(ave_distance= mean(distance_in_meters)) #maybe do it differently? should i make all distances within the same island 0?
edge_list_by_layers_modules_shuf$count <- c(1)
edge_list_by_layers_modules_shuf <- edge_list_by_layers_modules_shuf %>% mutate(number_of_modules= sum(count)) %>%
select(layer_from, layer_to, module, number_of_modules)
#version with correct average between layers
edge_list_by_layers_ave_shuf <- edge_list_with_distances_shuf %>% group_by(layer_from, layer_to) %>%
summarise(ave_distance= mean(distance_in_meters)) %>% unique()
#combine
edge_list_layer_combine_shuf <- edge_list_by_layers_ave_shuf %>%
merge(edge_list_by_layers_modules_shuf, by= c("layer_from", "layer_to")) #merge both versions
edge_list_layer_combine_no_module_shuf <- edge_list_layer_combine_shuf %>% select(-module) %>% unique() #have version where modules aren't present
#total number of modules in each layer
for (i in 1:14){
for (j in 1:14){
modules_in_layer_from_shuf <- filter(edge_list_by_layers_modules_shuf, layer_from == i) %>% select(module) %>% unique() %>% unlist()
modules_in_layer_to_shuf <- filter(edge_list_by_layers_modules_shuf, layer_from == j) %>% select(module) %>% unique() %>% unlist()
#take all nodes in layer_from and all nodes in layer_to to check turnover
int_both <- intersect(modules_in_layer_from_shuf, modules_in_layer_to_shuf) #how many nodes are found in both layers
uni_both <- union(modules_in_layer_from_shuf, modules_in_layer_to_shuf)
turnover <- length(int_both)/length(uni_both)
module_layer_turnover_shuf_del <- rbind(module_layer_turnover_shuf_del, tibble(layer_from= i, layer_to= j, turnover= turnover, trial = trial))
}
}
edge_list_by_layers_ave_shuf <- edge_list_with_distances_shuf %>% group_by(layer_from, layer_to) %>%
summarise(ave_distance= mean(distance_in_meters)) %>% unique()
layers_turnover_with_distnace <- edge_list_by_layers_ave_shuf %>%
merge(module_layer_turnover_shuf_del, by= c("layer_from", "layer_to")) #merge both versions
}
return(layers_turnover_with_distnace)
}
output_multilayer_islands <- multi_lvl_infomap(dryad_multilayer_islands,
infomap_executable = "Infomap",
flow_model = 'directed',
relax = F,
silent = T,
trials = 100,
seed = 497294,
temporal_network = F)
modules_dryad_multilayer_multi_level_islands <- output_multilayer_islands$modules #has module, sub_module and sub_sub_module but only for sub_module 3 and 17
view(modules_dryad_multilayer_multi_level_islands)
modules_dryad_multilayer_multi_level_islands <- modules_dryad_multilayer_multi_level_islands %>% drop_na(flow)
modules_dryad_multilayer_multi_level_islands
view(modules_dryad_multilayer_multi_level_islands)
view(modules_dryad_multilayer_multi_level_islands)
write.csv(modules_dryad_multilayer_multi_level_islands, "csvs/modules_dryad_multilayer_multi_level_islands.csv", row.names = FALSE)
view(modules_dryad_multilayer_multi_level_islands)
hierarchical_to_dendogram <- modules_dryad_multilayer_multi_level_islands
hierarchical_to_dendogram$state_node <- paste(hierarchical_to_dendogram$node_id, "_", hierarchical_to_dendogram$layer_id) #create a column for state nodes
network2module_islands <- data.frame(network = "network",
module = range(1,41)) #create 1st split in network to 2 modules
network2module_islands
network2module_islands <- data.frame(network = "network",
module = seq(1,41,1)) #create 1st split in network to 2 modules
network2module_islands
edges_network2module_level_islands <- network2module_islands %>% select(network, module) %>%
unique %>% rename(from = network, to = module) #create edge list from module to sub module
edges_network2module_level_islands$to <- paste(edges_network2module_level_islands$to, "_", "m") #add m to describe module
edges_network2module_level_islands
hierarchical_to_dendogram
edges_module2sub_module <- hierarchical_to_dendogram %>% select(module, sub_module) %>%
unique %>% rename(from = module, to = sub_module) #create edge list from module to sub module
edges_module2sub_module$from <- paste(edges_module2sub_module$from, "_", "m") #add m to describe module
edges_module2sub_module$to <- paste(edges_module2sub_module$to, "_", "sm") #add sm to describe sub module
view(modules_dryad_multilayer_multi_level_islands)
#----top level
edges_module2sub_module <- hierarchical_to_dendogram %>% select(module, sub_module) %>%
unique %>% rename(from = module, to = sub_module) #create edge list from module to sub module
edges_module2sub_module$from <- paste(edges_module2sub_module$from, "_", "m") #add m to describe module
edges_module2sub_module$to <- paste(edges_module2sub_module$to, "_", "sm") #add sm to describe sub module
module_3 <- edges_module2sub_module %>% filter(from == "3 _ m")
module_3$to <- paste("3." , module_3$to) #distinguish between sub modules with the same id under different modules
module_16 <- edges_module2sub_module %>% filter(from == "16 _ m")
module_2$to <- paste("16." , module_16$to) #distinguish between sub modules with the same id under different modules
edges_module2sub_module <- rbind(module_3, module_16) #create new version where sub modules have indication to which module they belong to
edges_module2sub_module <- hierarchical_to_dendogram %>% select(module, sub_module) %>%
unique %>% rename(from = module, to = sub_module) #create edge list from module to sub module
edges_module2sub_module$from <- paste(edges_module2sub_module$from, "_", "m") #add m to describe module
edges_module2sub_module$to <- paste(edges_module2sub_module$to, "_", "sm") #add sm to describe sub module
module_3 <- edges_module2sub_module %>% filter(from == "3 _ m")
module_3$to <- paste("3." , module_3$to) #distinguish between sub modules with the same id under different modules
module_16 <- edges_module2sub_module %>% filter(from == "16 _ m")
module_16$to <- paste("16." , module_16$to) #distinguish between sub modules with the same id under different modules
edges_module2sub_module <- rbind(module_3, module_16) #create new version where sub modules have indication to which module they belong to
module_16
edges_sub2state_level_islands <- hierarchical_to_dendogram %>% select(sub_module, state_node) %>%
unique %>% rename(from = sub_module, to = state_node) #create edge list from sub module to state node
edges_sub2state_level_islands
edges_sub2state_level_islands <- drop_na(edges_sub2state_level_islands) #delete all occasions where there's no sub sub module
edges_sub2state_level_islands
edges_sub2state_level_islands$from <- paste(edges_sub2state_level_islands$from, "_", "sm") #add sm to describe sub module
edges_sub2state_level_islands
view(edges_sub2state_level_islands)
view(edges_sub2state_level_islands)
edges_sub2state_level_islands <- hierarchical_to_dendogram %>% select(module, sub_module, state_node) %>%
unique %>% rename(module = module, from = sub_module, to = state_node) #create edge list from sub module to state node
edges_sub2state_level_islands <- drop_na(edges_sub2state_level_islands) #delete all occasions where there's no sub sub module
edges_sub2state_level_islands$from <- paste(edges_sub2state_level_islands$from, "_", "sm") #add sm to describe sub module
view(edges_sub2state_level_islands)
edges_module2sub_module
edges_sub_module2state_level <- hierarchical_to_dendogram %>% select(module, sub_module, state_node) %>%
unique %>% rename(from = sub_module, to = state_node) #create edge list from sub module to state node
edges_sub_module2state_level <- hierarchical_to_dendogram %>% select(module, sub_module, state_node) %>%
unique %>% rename(from = sub_module, to = state_node) #create edge list from sub module to state node
edges_sub_module2state_level$from <- paste(edges_sub_module2state_level$from, "_", "sm") #add sm to describe sub module
module_3_state <- edges_sub_module2state_level %>% filter(module == 3)
module_3_state$from <- paste("3." , module_3_state$from) #distinguish between sub modules with the same id under different modules
module_16_state <- edges_sub_module2state_level %>% filter(module == 16)
module_16_state$from <- paste("16." , module_16_state$from) #distinguish between sub modules with the same id under different modules
edges_sub_module2state_level <- rbind(module_3_state, module_16_state) %>% select(from, to) #create new version where sub modules have indication to which module they belong to
edges_sub_module2state_level
#---- bottom level option 2 (m to state)
edges_module2state_level_islands <- hierarchical_to_dendogram %>% select(module, state_node) %>%
unique %>% rename(from = module, to = state_node) #create edge list from sub module to state node
#---- bottom level option 2 (m to state)
edges_module2state_level_islands <- hierarchical_to_dendogram %>% select(module, state_node) %>%
unique %>% rename(from = module, to = state_node) #create edge list from sub module to state node
edges_module2state_level_islands <- edges_module2state_level_islands[!(edges_module2state_level_islands$to %in%
edges_sub_module2state_level$to),] ## if there is a sub module
#need to delete the corresponding edge in the module to state node
edges_module2state_level_islands$from <- paste(edges_module2state_level_islands$from, "_", "m") #add m to describe module
edges_module2state_level_islands
## create edge list combined for dendrogram
edge_list_for_dendrogram_islands <- rbind(edges_network2module_level_islands, edges_module2sub_module, edges_sub_module2state_level,
edges_module2state_level_islands)
no_state_nodes_islands <- rbind(edges_network2module_level_islands, edges_module2sub_module) #version with no state nodes
edge_list_for_dendrogram_islands
library(ggtree)
## graphs
pre_graph_islands <- graph_from_data_frame(edge_list_for_dendrogram_islands)
pre_graph_no_state_nodes_islands <- graph_from_data_frame(no_state_nodes_islands)
ggtree(pre_graph_no_state_nodes_islands, layout = "circular") + geom_tiplab()
ggtree(pre_graph_islands, layout = "circular")
ggtree(pre_graph_no_state_nodes_islands, layout = "circular") + geom_tiplab()
ggtree(pre_graph_islands, layout = "circular")
pivoted_by_module_empirical_hierarchical <- pivot_by_module(modules_dryad_multilayer_multi_level_islands) #pivot modules for map
modules_dryad_multilayer_multi_level_fixed_analysis_sub_module <-
read.csv("csvs/modules_dryad_multilayer_multi_level_fixed_analysis_sub_module.csv")
modules_dryad_multilayer_multi_level_fixed_analysis_sub_module
modules_dryad_multilayer_multi_level_islands
pivoted_by_module_empirical_multi_lvl <- pivot_by_module(modules_dryad_multilayer_multi_level_fixed_analysis_sub_module) #pivot modules for map
pivoted_by_module_empirical_multi_lvl
pivoted_by_module_empirical_hierarchical <- pivot_by_module(modules_dryad_multilayer_multi_level_islands) #pivot modules for map
pivot_by_module_islands <- function(data){ #creates a data frame with module on the side and layer_id on the top
s1 = melt(data, id = c("layer_id", "module"))
s2 = dcast(s1, layer_id ~ module, length)
s3 = t(s2)
s3 <- s3[-1,]
colnames(s3) <- c(3,4,5,6,7,8,9,10,11,12,13,14)
return(s3)
}
pivoted_by_module_empirical_hierarchical <- pivot_by_module_islands(modules_dryad_multilayer_multi_level_islands) #pivot modules for map
pivoted_by_module_empirical_hierarchical_islands <- pivot_by_module_islands(modules_dryad_multilayer_multi_level_islands) #pivot modules for map
pivoted_by_module_empirical_hierarchical_islands <- pivot_by_module_islands(modules_dryad_multilayer_multi_level_islands) #pivot modules for map
modules_edge_list_hierarchical_islands <- NULL
for (k in (1:nrow(pivoted_by_module_empirical_hierarchical_islands))){ #run the function for each row in the data frame
modules_edge_list_hierarchical_islands <- edge_list_per_module(pivoted_by_module_empirical_hierarchical_islands[k,],
modules_edge_list_hierarchical_islands)
current_module <- rownames(pivoted_by_module_empirical_hierarchical_islands)[k]
if (is.null(modules_edge_list_hierarchical_islands)) next
modules_edge_list_hierarchical_islands <- modules_edge_list_hierarchical_islands %>% mutate(module = replace_na(module, current_module)) #add module number
}
pivoted_by_module_empirical_hierarchical_islands
edge_list_per_module_islands <- function(data,edge_list){
#gets one row from a data frame and creates an edge list from it
for (i in (3:13)){
if (data[i]==0) next #only take layers where the module is present
else {
for (j in ((i+1):14)){
if (data[j]==0) next #only take layers where the module is present
else {
edge_list <- rbind(edge_list, tibble(layer_from=i, layer_to=j, module=NA)) #create edge list of all the layer found in a module
}
}
}
}
return(edge_list)
}
pivoted_by_module_empirical_hierarchical_islands <- pivot_by_module_islands(modules_dryad_multilayer_multi_level_islands) #pivot modules for map
modules_edge_list_hierarchical_islands <- NULL
for (k in (1:nrow(pivoted_by_module_empirical_hierarchical_islands))){ #run the function for each row in the data frame
modules_edge_list_hierarchical_islands <- edge_list_per_module_islands(pivoted_by_module_empirical_hierarchical_islands[k,],
modules_edge_list_hierarchical_islands)
current_module <- rownames(pivoted_by_module_empirical_hierarchical_islands)[k]
if (is.null(modules_edge_list_hierarchical_islands)) next
modules_edge_list_hierarchical_islands <- modules_edge_list_hierarchical_islands %>% mutate(module = replace_na(module, current_module)) #add module number
}
edge_list_per_module_islands <- function(data,edge_list){
#gets one row from a data frame and creates an edge list from it
for (i in (3:13)){
if (data[i]==0) next #only take layers where the module is present
else {
for (j in ((i+1):14)){
if (data[j]==0) next #only take layers where the module is present
else {
edge_list <- rbind(edge_list, tibble(layer_from=i, layer_to=j, module=NA)) #create edge list of all the layer found in a module
}
}
}
}
return(edge_list)
}
edge_list_per_module_islands <- function(data,edge_list){
#gets one row from a data frame and creates an edge list from it
for (i in (3:13)){
if (data[i]==0) next #only take layers where the module is present
else {
for (j in ((i+1):14)){
if (data[j]==0) next #only take layers where the module is present
else {
print(data[j])
edge_list <- rbind(edge_list, tibble(layer_from=i, layer_to=j, module=NA)) #create edge list of all the layer found in a module
}
}
}
}
return(edge_list)
}
pivoted_by_module_empirical_hierarchical_islands <- pivot_by_module_islands(modules_dryad_multilayer_multi_level_islands) #pivot modules for map
modules_edge_list_hierarchical_islands <- NULL
for (k in (1:nrow(pivoted_by_module_empirical_hierarchical_islands))){ #run the function for each row in the data frame
modules_edge_list_hierarchical_islands <- edge_list_per_module_islands(pivoted_by_module_empirical_hierarchical_islands[k,],
modules_edge_list_hierarchical_islands)
current_module <- rownames(pivoted_by_module_empirical_hierarchical_islands)[k]
if (is.null(modules_edge_list_hierarchical_islands)) next
modules_edge_list_hierarchical_islands <- modules_edge_list_hierarchical_islands %>% mutate(module = replace_na(module, current_module)) #add module number
}
view(pivoted_by_module_empirical_hierarchical_islands)
edge_list_per_module_islands <- function(data,edge_list){
#gets one row from a data frame and creates an edge list from it
for (i in (3:13)){
if (data[i]==0) next #only take layers where the module is present
else {
for (j in ((i+1):14)){
if (data[j]==0) next #only take layers where the module is present
else {
print(data[j,])
edge_list <- rbind(edge_list, tibble(layer_from=i, layer_to=j, module=NA)) #create edge list of all the layer found in a module
}
}
}
}
return(edge_list)
}
modules_edge_list_hierarchical_islands <- NULL
for (k in (1:nrow(pivoted_by_module_empirical_hierarchical_islands))){ #run the function for each row in the data frame
modules_edge_list_hierarchical_islands <- edge_list_per_module_islands(pivoted_by_module_empirical_hierarchical_islands[k,],
modules_edge_list_hierarchical_islands)
current_module <- rownames(pivoted_by_module_empirical_hierarchical_islands)[k]
if (is.null(modules_edge_list_hierarchical_islands)) next
modules_edge_list_hierarchical_islands <- modules_edge_list_hierarchical_islands %>% mutate(module = replace_na(module, current_module)) #add module number
}
edge_list_per_module_islands <- function(data,edge_list){
#gets one row from a data frame and creates an edge list from it
for (i in (3:13)){
if (data[i]==0) next #only take layers where the module is present
else {
for (j in ((i+1):14)){
if (data[j]==0) next #only take layers where the module is present
else {
print(data)
edge_list <- rbind(edge_list, tibble(layer_from=i, layer_to=j, module=NA)) #create edge list of all the layer found in a module
}
}
}
}
return(edge_list)
}
modules_edge_list_hierarchical_islands <- NULL
for (k in (1:nrow(pivoted_by_module_empirical_hierarchical_islands))){ #run the function for each row in the data frame
modules_edge_list_hierarchical_islands <- edge_list_per_module_islands(pivoted_by_module_empirical_hierarchical_islands[k,],
modules_edge_list_hierarchical_islands)
current_module <- rownames(pivoted_by_module_empirical_hierarchical_islands)[k]
if (is.null(modules_edge_list_hierarchical_islands)) next
modules_edge_list_hierarchical_islands <- modules_edge_list_hierarchical_islands %>% mutate(module = replace_na(module, current_module)) #add module number
}
view(pivoted_by_module_empirical_hierarchical_islands)
edge_list_per_module_islands <- function(data,edge_list){
#gets one row from a data frame and creates an edge list from it
for (i in (3:13)){
if (data[i]==0) next #only take layers where the module is present
else {
for (j in ((i+1):14)){
if (data[j]==0) next #only take layers where the module is present
else {
print(data[i])
print("j")
print(data[j])
edge_list <- rbind(edge_list, tibble(layer_from=i, layer_to=j, module=NA)) #create edge list of all the layer found in a module
}
}
}
}
return(edge_list)
}
#---- create edge lis
modules_edge_list_hierarchical_islands <- NULL
for (k in (1:nrow(pivoted_by_module_empirical_hierarchical_islands))){ #run the function for each row in the data frame
modules_edge_list_hierarchical_islands <- edge_list_per_module_islands(pivoted_by_module_empirical_hierarchical_islands[k,],
modules_edge_list_hierarchical_islands)
current_module <- rownames(pivoted_by_module_empirical_hierarchical_islands)[k]
if (is.null(modules_edge_list_hierarchical_islands)) next
modules_edge_list_hierarchical_islands <- modules_edge_list_hierarchical_islands %>% mutate(module = replace_na(module, current_module)) #add module number
}
edge_list_per_module_islands <- function(data,edge_list){
#gets one row from a data frame and creates an edge list from it
for (i in (3:13)){
if (data[i]==0) next #only take layers where the module is present
else {
for (j in ((i+1):14)){
if (data[j]==0) next #only take layers where the module is present
else {
print("i")
print(data[i])
print("j")
print(data[j])
edge_list <- rbind(edge_list, tibble(layer_from=i, layer_to=j, module=NA)) #create edge list of all the layer found in a module
}
}
}
}
return(edge_list)
}
modules_edge_list_hierarchical_islands <- NULL
for (k in (1:nrow(pivoted_by_module_empirical_hierarchical_islands))){ #run the function for each row in the data frame
modules_edge_list_hierarchical_islands <- edge_list_per_module_islands(pivoted_by_module_empirical_hierarchical_islands[k,],
modules_edge_list_hierarchical_islands)
current_module <- rownames(pivoted_by_module_empirical_hierarchical_islands)[k]
if (is.null(modules_edge_list_hierarchical_islands)) next
modules_edge_list_hierarchical_islands <- modules_edge_list_hierarchical_islands %>% mutate(module = replace_na(module, current_module)) #add module number
}
edge_list_per_module_islands <- function(data,edge_list){
#gets one row from a data frame and creates an edge list from it
for (i in (1:11)){
if (data[i]==0) next #only take layers where the module is present
else {
for (j in ((i+1):12)){
if (data[j]==0) next #only take layers where the module is present
else {
print("i")
print(data[i])
print("j")
print(data[j])
edge_list <- rbind(edge_list, tibble(layer_from=i, layer_to=j, module=NA)) #create edge list of all the layer found in a module
}
}
}
}
return(edge_list)
}
modules_edge_list_hierarchical_islands <- NULL
for (k in (1:nrow(pivoted_by_module_empirical_hierarchical_islands))){ #run the function for each row in the data frame
modules_edge_list_hierarchical_islands <- edge_list_per_module_islands(pivoted_by_module_empirical_hierarchical_islands[k,],
modules_edge_list_hierarchical_islands)
current_module <- rownames(pivoted_by_module_empirical_hierarchical_islands)[k]
if (is.null(modules_edge_list_hierarchical_islands)) next
modules_edge_list_hierarchical_islands <- modules_edge_list_hierarchical_islands %>% mutate(module = replace_na(module, current_module)) #add module number
}
edge_list_per_module_islands <- function(data,edge_list){
#gets one row from a data frame and creates an edge list from it
for (i in (1:11)){
if (data[i]==0) next #only take layers where the module is present
else {
for (j in ((i+1):12)){
if (data[j]==0) next #only take layers where the module is present
else {
edge_list <- rbind(edge_list, tibble(layer_from=i, layer_to=j, module=NA)) #create edge list of all the layer found in a module
}
}
}
}
return(edge_list)
}
modules_edge_list_hierarchical_islands
edge_list_per_module_islands <- function(data,edge_list){
#gets one row from a data frame and creates an edge list from it
for (i in (1:11)){
if (data[i]==0) next #only take layers where the module is present
else {
for (j in ((i+1):12)){
if (data[j]==0) next #only take layers where the module is present
else {
print(colnames(data[i]))
edge_list <- rbind(edge_list, tibble(layer_from=i, layer_to=j, module=NA)) #create edge list of all the layer found in a module
}
}
}
}
return(edge_list)
}
modules_edge_list_hierarchical_islands <- NULL
for (k in (1:nrow(pivoted_by_module_empirical_hierarchical_islands))){ #run the function for each row in the data frame
modules_edge_list_hierarchical_islands <- edge_list_per_module_islands(pivoted_by_module_empirical_hierarchical_islands[k,],
modules_edge_list_hierarchical_islands)
current_module <- rownames(pivoted_by_module_empirical_hierarchical_islands)[k]
if (is.null(modules_edge_list_hierarchical_islands)) next
modules_edge_list_hierarchical_islands <- modules_edge_list_hierarchical_islands %>% mutate(module = replace_na(module, current_module)) #add module number
}
edge_list_per_module_islands <- function(data,edge_list){
#gets one row from a data frame and creates an edge list from it
for (i in (1:11)){
if (data[i]==0) next #only take layers where the module is present
else {
for (j in ((i+1):12)){
if (data[j]==0) next #only take layers where the module is present
else {
edge_list <- rbind(edge_list, tibble(layer_from=i+2, layer_to=j+2, module=NA)) #create edge list of all the layer found in a module
}
}
}
}
return(edge_list)
}
edge_list_per_module_islands <- function(data,edge_list){
#gets one row from a data frame and creates an edge list from it
for (i in (1:11)){
if (data[i]==0) next #only take layers where the module is present
else {
for (j in ((i+1):12)){
if (data[j]==0) next #only take layers where the module is present
else {
edge_list <- rbind(edge_list, tibble(layer_from=i+2, layer_to=j+2, module=NA)) #create edge list of all the layer found in a module
} # +2 is to make sure we get the layer id (id in the column) and not the number of the column
}
}
}
return(edge_list)
}
modules_edge_list_hierarchical_islands <- NULL
for (k in (1:nrow(pivoted_by_module_empirical_hierarchical_islands))){ #run the function for each row in the data frame
modules_edge_list_hierarchical_islands <- edge_list_per_module_islands(pivoted_by_module_empirical_hierarchical_islands[k,],
modules_edge_list_hierarchical_islands)
current_module <- rownames(pivoted_by_module_empirical_hierarchical_islands)[k]
if (is.null(modules_edge_list_hierarchical_islands)) next
modules_edge_list_hierarchical_islands <- modules_edge_list_hierarchical_islands %>% mutate(module = replace_na(module, current_module)) #add module number
}
modules_edge_list_hierarchical_islands
hierarchical_edge_list_with_distances_islands <- right_join(modules_edge_list_hierarchical_islands, distances_with_ids,
by= c("layer_from", "layer_to")) #combine the edge list with the distances between each two layers
hierarchical_edge_list_with_distances_islands <- na.omit(hierarchical_edge_list_with_distances_islands) #remove NA and delete layer name
module_from_hierarcihcal_islands <- hierarchical_edge_list_with_distances_islands %>% select(layer_from, module) %>% unique()
module_from_hierarcihcal_islands
module_from_hierarchical_islands <- hierarchical_edge_list_with_distances_islands %>% select(layer_from, module) %>% unique()
module_from_hierarchical_islands <- hierarchical_edge_list_with_distances_islands %>% select(layer_from, module) %>% unique()
colnames(module_from_hierarchical_islands)[1] <- "layer_id" #rename column
module_to_hierarchical_islands <- hierarchical_edge_list_with_distances_islands %>% select(layer_to, module) %>% unique()
colnames(module_to_hierarchical_islands)[1] <- "layer_id" #rename column
module_hierarchical_islands <- rbind(module_from_hierarchical_islands, module_to_hierarchical_islands) %>% unique()
module_hierarchical_with_loc_islands <- merge(module_hierarchical_islands, lon_lat_data, by= c("layer_id","layer_id"))
write.csv(lon_lat_data, "csvs/lon_lat_data.csv", row.names = FALSE)
getwd()
module_hierarchical_islands <- rbind(module_from_hierarchical_islands, module_to_hierarchical_islands) %>% unique()
module_hierarchical_with_loc_islands <- merge(module_hierarchical_islands, lon_lat_data, by= c("layer_id","layer_id")) %>%
group_by(module) %>% filter(n()>5)
dryad_map_hierarchical_islands <- get_map(location=dryad_location, zoom=10, maptype="terrain") %>% ggmap()+
geom_polygon(data = module_hierarchical_with_loc_islands, aes(x = Lon, y = lat, color = module, fill = module),
alpha = 0.1)+
theme(axis.title=element_text(size=14))+theme(axis.text.x=element_text(size=12))+
theme(axis.text.y=element_text(size=12))+
labs(x = "Longitude", y = "Latitude")
dryad_map_hierarchical_islands
detach("package:ggtree", unload = TRUE)
module_from_hierarchical_islands <- hierarchical_edge_list_with_distances_islands %>% select(layer_from, module) %>% unique()
colnames(module_from_hierarchical_islands)[1] <- "layer_id" #rename column
module_to_hierarchical_islands <- hierarchical_edge_list_with_distances_islands %>% select(layer_to, module) %>% unique()
colnames(module_to_hierarchical_islands)[1] <- "layer_id" #rename column
module_hierarchical_islands <- rbind(module_from_hierarchical_islands, module_to_hierarchical_islands) %>% unique()
module_hierarchical_with_loc_islands <- merge(module_hierarchical_islands, lon_lat_data, by= c("layer_id","layer_id")) %>%
group_by(module) %>% filter(n()>5)
dryad_map_hierarchical_islands <- get_map(location=dryad_location, zoom=10, maptype="terrain") %>% ggmap()+
geom_polygon(data = module_hierarchical_with_loc_islands, aes(x = Lon, y = lat, color = module, fill = module),
alpha = 0.1)+
theme(axis.title=element_text(size=14))+theme(axis.text.x=element_text(size=12))+
theme(axis.text.y=element_text(size=12))+
labs(x = "Longitude", y = "Latitude")
worldmap <- map_data("world")
dryad_location <- make_bbox(lon= c(-18.542076, -12.58351), lat= c(26, 30.323990))
dryad_map_hierarchical_islands <- get_map(location=dryad_location, zoom=10, maptype="terrain") %>% ggmap()
dryad_map_hierarchical_islands <- get_map(location=dryad_location, zoom=10, maptype="terrain")
worldmap <- map_data("world")
dryad_location <- make_bbox(lon= c(-18.542076, -12.58351), lat= c(26, 30.323990))
get_map(location=dryad_location, zoom=10, maptype="terrain")
write.csv(module_hierarchical_with_loc_islands, "csvs/module_hierarchical_with_loc_islands.csv", row.names = FALSE)
