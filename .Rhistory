all_edge_list_sites_combine_no_module_shuf_classic <- read.csv("all_edge_list_sites_combine_no_module_shuf_classic.csv")
ave_module_sites_turnover_shuf_classic <- all_edge_list_sites_combine_no_module_shuf_classic %>%
group_by(layer_from, layer_to) %>%
summarise(ave=mean(turnover), sd=sd(turnover), ave_dist=mean(ave_distance)) %>% mutate(type="null_model_within") #create mean and sd for each point
#add the empirical empirical
sites_turnover_with_distnace_empirical <- read.csv("sites_turnover_with_distnace_empirical.csv")
empirical_turnover_for_module_site_shuf <- sites_turnover_with_distnace_empirical %>% group_by(layer_from, layer_to) %>%
summarise(ave=mean(turnover), sd=sd(turnover), ave_dist=mean(distance_in_km)) %>% mutate(ave_dist= ave_dist*1000,
type="empirical") #make sure sd is 0 cause its the empirical and not null
empirical_turnover_for_module_site_shuf_no_self_loop_classic <- empirical_turnover_for_module_site_shuf %>%
subset(layer_from != layer_to) #distance decay graph for empirical
empirical_turnover_for_module_site_shuf_no_self_loop_km_classic <- empirical_turnover_for_module_site_shuf_no_self_loop_classic %>%
mutate(ave_dist_in_m = ave_dist*1000) #From km to m
##---- combine empirical and shuffle
jaccard_similarity_empirical_and_null_model <- rbind(empirical_turnover_for_module_site_shuf, ave_module_sites_turnover_shuf_classic)
jaccard_similarity_empirical_and_null_no_self_loop_classic <- jaccard_similarity_empirical_and_null_model %>% subset(layer_from != layer_to)
jaccard_similarity_empirical_and_null_no_self_loop_km_classic <- jaccard_similarity_empirical_and_null_no_self_loop_classic %>%
mutate(ave_dist_in_km = ave_dist/1000) #all data set from m to km
just_empirical_within <- jaccard_similarity_empirical_and_null_no_self_loop_km_classic %>% filter(type == "empirical")
jaccard_similarity_empirical_and_null_no_self_loop_km_classic %>% ggplot(aes(x= ave_dist_in_km, y= ave, group= type, color= type))+
geom_point()+ geom_errorbar(aes(ymin= ave-sd, ymax= ave+sd))+ theme_classic()+ geom_smooth(method= "lm", se=F)+
theme(axis.title=element_text(size=22))+theme(axis.text.x=element_text(size=15))+
theme(axis.text.y=element_text(size=15))+ theme(legend.title = element_text(size = 13), legend.text = element_text(size = 13))+
labs(x="Distance in Km", y="Jaccard Similarity")+ stat_cor(aes(label = ..p.label..), label.x = 400)+
stat_cor(aes(label = ..rr.label..), label.x = 400, label.y = c(0.57, 0.54))+ scale_color_manual(values = c("#F47069", "#c4067c"))
correlation_empirical_classic <- read.csv("correlation_empirical_pols.csv")
iteration_correlation_classic <- read.csv("iteration_correlation_classic.csv")
#Distribution of rsquared and add empirical
iteration_correlation_classic %>% ggplot(aes(x = rsquared))+
geom_density(fill = "#c4067c", color = "#c4067c", alpha = 0.4)+
theme_classic()+ labs(x = "R squared")+
geom_vline(xintercept = correlation_empirical_classic$rsquared, linetype = "dashed", color = "#F47069")
jaccard_similarity_empirical_and_null_interactions_no_self_loop_km <- read.csv("jaccard_similarity_empirical_and_null_interactions_no_self_loop_km.csv")
jaccard_similarity_empirical_and_null_interactions_no_self_loop_km %>% ggplot(aes(x= ave_dist_in_km, y= ave, group= type, color= type))+
geom_point()+ geom_errorbar(aes(ymin= ave-sd, ymax= ave+sd))+ theme_classic()+ geom_smooth(method= "lm", se=F)+
theme(axis.title=element_text(size=22))+theme(axis.text.x=element_text(size=15))+
theme(axis.text.y=element_text(size=15))+ theme(legend.title = element_text(size = 13), legend.text = element_text(size = 13))+
labs(x="Distance in Km", y="Jaccard Similarity")+ stat_cor(aes(label = ..p.label..), label.x = 400)+
stat_cor(aes(label = ..rr.label..), label.x = 400, label.y = c(0.63, 0.60, 0.57, 0.54))+
scale_color_manual(values = c("#F47069", "#0033cc"))
correlation_empirical_interactions <- read.csv("correlation_empirical_pols.csv")
iteration_correlation_interactions  <- read.csv("iteration_correlation_interactions.csv")
#Distribution of rsquared and add empirical
iteration_correlation_interactions %>% ggplot(aes(x = rsquared))+
geom_density(fill = "#0033cc", color = "#0033cc", alpha = 0.4)+
theme_classic()+ labs(x = "R squared")+
geom_vline(xintercept = correlation_empirical_interactions$rsquared, linetype = "dashed", color = "#F47069")
iteration_correlation_pols <- read.csv("iteration_correlation_pols.csv")
iteration_correlation_interactions<- read.csv("iteration_correlation_interactions.csv")
correlation_empirical_interactions <- read.csv("correlation_empirical_pols.csv")
interactions_for_beta_diversity <- iteration_correlation_interactions
interactions_for_beta_diversity$type <- "shuffling_interactions"
species_for_beta_diversity <- iteration_correlation_pols
species_for_beta_diversity$type <- "shuffling_species"
correlation_beta_diversity <- rbind(interactions_for_beta_diversity, species_for_beta_diversity)
correlation_beta_diversity %>% ggplot(aes(x = rsquared, color = type, fill = type))+ #overlay shuffling of interactions and species
geom_density(alpha = 0.4)+ scale_color_manual(values = c("#0033cc", "#BE75FA"))+
scale_fill_manual(values = c("#0033cc", "#BE75FA"))+
theme_classic()+ labs(x = "R squared")+
geom_vline(xintercept = correlation_empirical_interactions$rsquared, linetype = "dashed", color = "#F47069")
jaccard_similarity_empirical_and_fixed_no_self_loop_km<- read.csv("jaccard_similarity_empirical_and_fixed_no_self_loop_km.csv")
jaccard_similarity_empirical_and_fixed_no_self_loop_km %>% ggplot(aes(x= ave_dist_in_km, y= ave, group= type, color= type))+
geom_point()+ geom_errorbar(aes(ymin= ave-sd, ymax= ave+sd))+ theme_classic()+ geom_smooth(method= "lm", se=F)+
theme(axis.title=element_text(size=22))+theme(axis.text.x=element_text(size=15))+
theme(axis.text.y=element_text(size=15))+ theme(legend.title = element_text(size = 13), legend.text = element_text(size = 13))+
labs(x="Distance in Km", y="Jaccard Similarity")+ scale_color_manual(values = c("#F47069", "#c4ad06"))+
theme(panel.grid = element_blank(),
panel.border = element_rect(color = "black",fill = NA,size = 1),
panel.spacing = unit(0.5, "cm", data = NULL),
axis.text = element_text(size=14, color='black'),
axis.title = element_text(size=14, color='black'),
axis.line = element_blank())+ stat_cor(aes(label = ..p.label..), label.x = 400)+stat_cor(aes(label = ..rr.label..), label.x = 400, label.y = c(0.65, 0.62))
classic_layers_turnover_with_distances_island <- read.csv("classic_layers_turnover_with_distances_islands_as_layers.csv")
classic_layers_turnover_with_distances <- classic_layers_turnover_with_distances_island %>%
mutate(distance_in_km=mean_distance/1000) #turn to km
classic_layers_turnover_with_distances %>%
ggplot(aes(x=distance_in_km, y=turnover))+ geom_point(color = "indianred2")+ theme_classic()+
stat_smooth(method= "lm", se=F, color = "indianred2")+
theme(axis.title=element_text(size=22))+theme(axis.text.x=element_text(size=15))+
theme(axis.text.y=element_text(size=15))+
labs(x="Distance in Km", y="Jaccard Similarity")+
stat_cor(aes(label = after_stat(rr.label)), label.x = 400, label.y = c(0.36, 0.34, 0.32, 0.30))+
theme(panel.grid = element_blank(),
panel.border = element_rect(color = "black",fill = NA,size = 1),
panel.spacing = unit(0.5, "cm", data = NULL),
axis.text = element_text(size=14, color='black'),
axis.title = element_text(size=14, color='black'),
axis.line = element_blank())
turnover_shuf_and_empirical <- read.csv("turnover_shuf_and_empirical_islands_as_layers.csv")
turnover_shuf_and_empirical %>% ggplot(aes(x= distance_in_km, y= ave, group= type, color= type))+
geom_point()+ geom_errorbar(aes(ymin= ave-sd, ymax= ave+sd))+ theme_classic()+ geom_smooth(method= "lm", se=F)+
labs(x="Distance in Km", y="Jaccard Similarity")+
theme(panel.grid = element_blank(),
panel.border = element_rect(color = "black",fill = NA,size = 1),
panel.spacing = unit(0.5, "cm", data = NULL),
axis.text = element_text(size=14, color='black'),
axis.title = element_text(size=14, color='black'),
axis.line = element_blank()) + stat_cor(aes(label = ..p.label..), label.x = 400)+
stat_cor(aes(label = ..rr.label..), label.x = 400, label.y = c(0.36, 0.34, 0.32, 0.30))
islands_turnover_with_distnace_empirical <- read.csv("islands_turnover_with_distnace_empirical.csv")
islands_turnover_with_distnace_empirical %>%
ggplot(aes(x=distance_in_km, y=turnover))+
geom_point(color = "indianred2")+
scale_x_continuous()+ stat_smooth(method= "lm", se=F, color = "indianred2")+
theme(axis.title=element_text(size=22))+theme(axis.text.x=element_text(size=15))+
theme(axis.text.y=element_text(size=15))+
labs(x="Distance in Km", y="Jaccard Similarity")+ theme_bw()+
stat_cor(aes(label = after_stat(rr.label)), label.x = 400, label.y = c(0.36, 0.34, 0.32, 0.30))+
theme(panel.grid = element_blank(),
panel.border = element_rect(color = "black",fill = NA,size = 1),
panel.spacing = unit(0.5, "cm", data = NULL),
axis.text = element_text(size=14, color='black'),
axis.title = element_text(size=14, color='black'),
axis.line = element_blank())
jaccard_similarity_layer_empirical_and_null_km <- read.csv("jaccard_similarity_layer_empirical_and_null_km_islands.csv")
jaccard_similarity_layer_empirical_and_null_km %>%
ggplot(aes(x= mean_dist_in_km, y= ave, group= type, color= type))+
geom_point()+ geom_errorbar(aes(ymin= ave-sd, ymax= ave+sd))+ theme_classic()+ geom_smooth(method= "lm", se=F)+
theme(axis.title=element_text(size=22))+theme(axis.text.x=element_text(size=15))+
theme(axis.text.y=element_text(size=15))+ theme(legend.title = element_text(size = 13), legend.text = element_text(size = 13))+
labs(x="Distance in Km", y="Jaccard Similarity")+
stat_cor(aes(label = after_stat(rr.label)), label.x = 400, label.y = c(0.60, 0.56, 0.52, 0.48))+
theme(panel.grid = element_blank(),
panel.border = element_rect(color = "black",fill = NA,size = 1),
panel.spacing = unit(0.5, "cm", data = NULL),
axis.text = element_text(size=14, color='black'),
axis.title = element_text(size=14, color='black'),
axis.line = element_blank()) # stat_cor(aes(label = ..p.label..), label.x = 400)+
correlation_empirical_pols <- read.csv("correlation_empirical_pols_islands.csv")
rqsuares_M1_all <- read.csv("rqsuares_M1_all_islands.csv")
group_color <- c(shuf_pollinators = "#BE75FA",
shuf_plants = "#15B7BC",
shuf_both = "#72A323")
rqsuares_M1_all %>%
ggplot(aes(x = rsquared, fill = type))+
geom_density(alpha = 0.4)+
theme_classic()+ labs(x = "R squared")+
geom_vline(xintercept = correlation_empirical_pols$rsquared, linetype = "dashed", color = "#F47069")+
theme(axis.title=element_text(size=22))+
theme(panel.grid = element_blank(),
panel.border = element_rect(color = "black",fill = NA,size = 1),
panel.spacing = unit(0.5, "cm", data = NULL),
axis.text = element_text(size=14, color='black'),
axis.title = element_text(size=14, color='black'),
axis.line = element_blank())+
scale_fill_manual(values = group_color)
jaccard_similarity_layer_empirical_and_null_km  <- read.csv("jaccard_similarity_layer_empirical_and_null_km_islands.csv")
jaccard_similarity_layer_empirical_and_null_km %>%
ggplot(aes(x= mean_dist_in_km, y= ave, group= type, color= type))+
geom_point()+ geom_errorbar(aes(ymin= ave-sd, ymax= ave+sd))+ theme_classic()+ geom_smooth(method= "lm", se=F)+
theme(axis.title=element_text(size=22))+theme(axis.text.x=element_text(size=15))+
theme(axis.text.y=element_text(size=15))+ theme(legend.title = element_text(size = 13), legend.text = element_text(size = 13))+
labs(x="Distance in Km", y="Jaccard Similarity")+
stat_cor(aes(label = after_stat(rr.label)), label.x = 400, label.y = c(0.60, 0.56, 0.52, 0.48))+
theme(panel.grid = element_blank(),
panel.border = element_rect(color = "black",fill = NA,size = 1),
panel.spacing = unit(0.5, "cm", data = NULL),
axis.text = element_text(size=14, color='black'),
axis.title = element_text(size=14, color='black'),
axis.line = element_blank()) + stat_cor(aes(label = ..p.label..), label.x = 400)
#distribution of rsquared and add empirical
correlation_empirical_interactions <- read.csv("correlation_empirical_interactions_islands.csv")
iteration_correlation_interactions <- read.csv("iteration_correlation_interactions_islands.csv")
iteration_correlation_interactions %>% ggplot(aes(x = rsquared))+
geom_density(fill = "#0033cc", color = "#0033cc", alpha = 0.4)+
theme_classic()+ labs(x = "R squared")+
geom_vline(xintercept = correlation_empirical_interactions$rsquared, linetype = "dashed", color = "#F47069")
##compare both parts of beta diversity (shuffling pollinator species )
iteration_correlation_pols <- read.csv("iteration_correlation_pols_islands.csv")
iteration_correlation_interactions <- read.csv("iteration_correlation_interactions_islands.csv")
correlation_empirical_interactions <- read.csv("correlation_empirical_interactions_islands.csv")
interactions_for_beta_diversity <- iteration_correlation_interactions
interactions_for_beta_diversity$type <- "shuffling_interactions"
species_for_beta_diversity <- iteration_correlation_pols
species_for_beta_diversity$type <- "shuffling_species"
correlation_beta_diversity <- rbind(interactions_for_beta_diversity, species_for_beta_diversity)
correlation_beta_diversity %>% ggplot(aes(x = rsquared, color = type, fill = type))+ #overlay shuffling of interactions and species
geom_density(alpha = 0.4)+ scale_color_manual(values = c("#0033cc", "#BE75FA"))+
scale_fill_manual(values = c("#0033cc", "#BE75FA"))+
theme_classic()+ labs(x = "R squared")+
geom_vline(xintercept = correlation_empirical_interactions$rsquared, linetype = "dashed", color = "#F47069")
jaccard_similarity_empirical_and_fixed_no_self_loop_km<- read.csv("jaccard_similarity_empirical_and_fixed_no_self_loop_km_islands.csv")
jaccard_similarity_empirical_and_fixed_no_self_loop_km %>% ggplot(aes(x= ave_dist_in_km, y= ave, group= type, color= type))+
geom_point()+ geom_errorbar(aes(ymin= ave-sd, ymax= ave+sd))+ theme_classic()+ geom_smooth(method= "lm", se=F)+
theme(axis.title=element_text(size=22))+theme(axis.text.x=element_text(size=15))+
theme(axis.text.y=element_text(size=15))+ theme(legend.title = element_text(size = 13), legend.text = element_text(size = 13))+
labs(x="Distance in Km", y="Jaccard Similarity")+ scale_color_manual(values = c("#F47069", "#c4ad06"))+
theme(panel.grid = element_blank(),
panel.border = element_rect(color = "black",fill = NA,size = 1),
panel.spacing = unit(0.5, "cm", data = NULL),
axis.text = element_text(size=14, color='black'),
axis.title = element_text(size=14, color='black'),
axis.line = element_blank()) + stat_cor(aes(label = ..p.label..), label.x = 400)+
stat_cor(aes(label = ..rr.label..), label.x = 400, label.y = c(0.65, 0.62))
##---load_libraries-------------------------------------------------------------------------------------------------
options(rgl.useNULL = TRUE)
library(infomapecology)
library(igraph)
library(bipartite)
library(tidyverse)
library(magrittr)
library(betalink)
library(readxl)
library(ggalluvial)
library(scatterpie)
library(reshape2)
library(ggforce)
library(ggmap)
library(ggraph)
library(ggpubr)
library(sf)
library(remotes)
library(tmap)
##----get_data--------------------------------------------------------------------------------------------------------
setwd("/Users/agustin/Desktop/Papers/Canary_Island_Project/spatial_modularity_in_the_canary_islands")
source("/Users/agustin/Desktop/Papers/Canary_Island_Project/spatial_modularity_in_the_canary_islands/R/functions.R")
#We call the matrix
co_occurrence<- read_excel("./R/Extra_analysis_results/Local_description.xlsx", sheet = 3)
#We call the matrix
co_occurrence<- read_excel("./Extra_analysis_results/Local_description.xlsx", sheet = 3)
#We call the matrix
co_occurrence<- read_excel("./R/Extra_analysis_results/Local_description.xlsx", sheet = 3)
#We call the matrix
co_occurrence<- read_excel("./R/Extra_analysis_results/Local_description.xlsx", sheet = Co_occurrence between layers)
#We call the matrix
co_occurrence<- read_excel("./R/Extra_analysis_results/Local_description.xlsx", sheet = "Co_occurrence between layers")
##----get_data--------------------------------------------------------------------------------------------------------
setwd("/Users/agustin/Desktop/Papers/Canary_Island_Project/spatial_modularity_in_the_canary_islands")
#We call the matrix
co_occurrence<- read_excel("./R/Extra_analysis_results/Local_description.xlsx", sheet = "Co_occurrence between layers")
#We call the matrix
co_occurrence<- read_excel("/R/Extra_analysis_results/Local_description.xlsx", sheet = "Co_occurrence between layers")
#We call the matrix
co_occurrence<- read_excel("./R/Extra_analysis_results/Local_description.xlsx", sheet = "Co_occurrence between layers")
#We call the matrix
co_occurrence<- read_excel("./R/Extra_analysis_results/Location_description.xlsx", sheet = "Co_occurrence between layers")
View(co_occurrence)
#We call the matrix
co_occurrence<- read_excel("./R/Extra_analysis_results/Location_description.xlsx", sheet = "Co_occurrence between layers")
View(co_occurrence)
View(co_occurrence)
#We call the matrix
co_occurrence<- read_excel("./R/Extra_analysis_results/Location_description.xlsx", sheet = "Co_occurrence between layers", col_names = F)
View(co_occurrence)
#We call the matrix
co_occurrence<- read_excel("./R/Extra_analysis_results/Location_description.xlsx", sheet = "Co_occurrence between layers", col_names = F, row.names=1)
#We call the matrix
co_occurrence<- read_excel("./R/Extra_analysis_results/Location_description.xlsx", sheet = "Co_occurrence between layers", col_names = F, rows=1)
#We call the matrix
co_occurrence<- read_xlsx2("./R/Extra_analysis_results/Location_description.xlsx", sheet = "Co_occurrence between layers",
col_names = F, row.names=1)
install.packages("xlsx")
#We call the matrix
library(xlsx)
co_occurrence<- read_xlsx2("./R/Extra_analysis_results/Location_description.xlsx", sheet = "Co_occurrence between layers",
col_names = F, row.names=1)
co_occurrence<- read.xlsx2("./R/Extra_analysis_results/Location_description.xlsx", sheet = "Co_occurrence between layers",
col_names = F, row.names=1)
co_occurrence<- read.xlsx2("./R/Extra_analysis_results/Location_description.xlsx", sheet = "Co_occurrence between layers",
col_names = F)
co_occurrence<- read.xlsx2("./R/Extra_analysis_results/Location_description.xlsx", sheetIndex = "Co_occurrence between layers",
col_names = F, row.names=1)
View(co_occurrence)
#We call the matrix
co_occurrence<- read_excel("./R/Extra_analysis_results/Location_description.xlsx", sheet = "Co_occurrence between layers",
col_names = F, rows.names =)
#We call the matrix
co_occurrence<- read_excel("./R/Extra_analysis_results/Location_description.xlsx", sheet = "Co_occurrence between layers",
col_names = F, rows.names = 0)
#We call the matrix
co_occurrence<- read_excel("./R/Extra_analysis_results/Location_description.xlsx", sheet = "Co_occurrence between layers",
col_names = F)
View(co_occurrence)
#We call the matrix
co_occurrence<- read_excel("./R/Extra_analysis_results/Location_description.xlsx", sheet = "Co_occurrence between layers",
col_names = F)
View(co_occurrence)
#We call the matrix
co_occurrence<- read_excel("./R/Extra_analysis_results/Location_description.xlsx", sheet = "Co_occurrence between layers",
col_names = T)
View(co_occurrence)
#We call the matrix
co_occurrence<- read_excel("./R/Extra_analysis_results/Location_description.xlsx", sheet = "Co_occurrence between layers",
col_names = T, rownames=T)
#We call the matrix
co_occurrence<- read_excel("./R/Extra_analysis_results/Location_description.xlsx", sheet = "Co_occurrence between layers",
col_names = T, rownames=1)
#We call the matrix
co_occurrence<- read_excel("./R/Extra_analysis_results/Location_description.xlsx", sheet = "Co_occurrence between layers",
col_names = T, row.names=1)
#We call the matrix
co_occurrence<- read_excel("./R/Extra_analysis_results/Location_description.xlsx", sheet = "Co_occurrence between layers",
col_names = T)
#We call the matrix
co_occurrence<- read_excel("./R/Extra_analysis_results/Location_description.xlsx", sheet = "Co_occurrence between layers",
col_names = TRUE)
View(co_occurrence)
#We call the matrix
co_occurrence<- read_excel("./R/Extra_analysis_results/Location_description.xlsx", sheet = "Co_occurrence between layers",
col_names = TRUE,rowNAMES=T)
##----upload data frame islands -------
modules_dryad_multilayer <- read.csv("./csvs/Islands/modules_in_network_islands_as_layers.csv")
#We call the matrix
co_occurrence<- read_excel("./R/Extra_analysis_results/Location_description.xlsx", sheet = "Co_occurrence between layers",
col_names = TRUE,rowNames=T)
View(co_occurrence)
#We call the matrix
co_occurrence<- read.xlsx("./R/Extra_analysis_results/Location_description.xlsx", sheet = "Co_occurrence between layers",
col_names = TRUE,rowNames=T)
#We call the matrix
co_occurrence<- read.xlsx("./R/Extra_analysis_results/Location_description.xlsx", sheet = "Co_occurrence between layers",
colNames = TRUE,rowNames=T)
#We call the matrix
co_occurrence<- read.xlsx("./R/Extra_analysis_results/Location_description.xlsx", sheet = 3,
colNames = TRUE,rowNames=T)
#We call the matrix
co_occurrence<- read.xlsx("./R/Extra_analysis_results/Location_description.xlsx","Co_occurrence between layers",
colNames = TRUE,rowNames=T)
View(co_occurrence)
#We call the matrix
co_occurrence<- read_excel("./R/Extra_analysis_results/Location_description.xlsx", sheet = "Co_occurrence between layers",
col_names = TRUE)
View(co_occurrence)
co_occurrence<- co_occurrence[-1,]
View(co_occurrence)
#We call the matrix
co_occurrence<- read_excel("./R/Extra_analysis_results/Location_description.xlsx", sheet = "Co_occurrence between layers",
col_names = TRUE)
#We call the matrix
co_occurrence<- read_excel("./R/Extra_analysis_results/Location_description.xlsx", sheet = "Co_occurrence between layers",
col_names = TRUE)
co_occurrence<- co_occurrence[,-1]
View(co_occurrence)
#We call the matrix
library(ggcorrplot)
install.packages("ggcorrplot")
#We call the matrix
library(ggcorrplot)
ggcorrplot(co_occurrence,
hc.order = TRUE,
type = "lower",
lab = TRUE)
ggcorrplot(co_occurrence)
heatmap(co_occurrence)
co_occurence<-as.numeric(co_occurrence)
str(co_occurrence)
View(co_occurrence)
co_occurrence<-lapply(co_occurrence,as.numeric)
View(co_occurrence)
str(co_occurrence)
heatmap(co_occurrence)
co_occurrence<- read_excel("./R/Extra_analysis_results/Location_description.xlsx", sheet = "Co_occurrence between layers",
col_names = TRUE)
co_occurrence<- co_occurrence[,-1]
co_occurrence2 <- co_occurrence %>% mutate_all(as.numeric)
View(co_occurrence)
View(co_occurrence2)
View(co_occurrence2)
heatmap(co_occurrence)
co_occurrence<- read_excel("./R/Extra_analysis_results/Location_description.xlsx", sheet = "Co_occurrence between layers",
col_names = TRUE)
co_occurrence<- co_occurrence[,-1]
co_occurrence2 <- co_occurrence %>% mutate_all(as.numeric)
co_occurrence<- read_excel("./R/Extra_analysis_results/Location_description.xlsx", sheet = "Co_occurrence between layers",
col_names = TRUE)
co_occurrence<- co_occurrence[,-1]
co_occurrence2 <- co_occurrence %>% mutate_all(as.numeric)
str(co_occurrence2)
image(co_occurrence2)
plotmatrix(co_occurrence2)
plot.matrix(co_occurrence2)
View(co_occurrence2)
knitr::opts_chunk$set(echo = FALSE, results = "asis", message=FALSE, warning=FALSE, cache=TRUE, eval = TRUE, dev = c('png'), out.width = '100%', out.height='40%')
library(knitr)
|          |    |    |    |    |    |    |    |
library(knitr)
knitr::table(
|          |    |    |    |    |    |    |    |
##---load_libraries-------------------------------------------------------------------------------------------------
options(rgl.useNULL = TRUE)
library(infomapecology)
library(igraph)
library(bipartite)
library(tidyverse)
library(magrittr)
library(betalink)
library(readxl)
library(ggalluvial)
library(scatterpie)
library(reshape2)
library(ggforce)
library(ggmap)
library(ggraph)
library(ggpubr)
setwd("/Users/agustin/Desktop/Papers/Canary_Island_Project/spatial_modularity_in_the_canary_islands")
source("/Users/agustin/Desktop/Papers/Canary_Island_Project/spatial_modularity_in_the_canary_islands/R/functions.R")
##----  New dataframe ---------------------------------------------------------------------------
physical_nodes <- read.csv("./R/Extra_analysis_results/physical_nodes.csv",row.names = 1)
layer_metadata <- read.csv("./R/Extra_analysis_results/layers.csv",row.names = 1)
inter_extended <- read.csv("./R/Extra_analysis_results/inter_edges.csv", row.names = 1)
intra_nonextended <- read.csv("./R/Extra_analysis_results/intra_edges.csv", row.names = 1)
## - Set fixed interlayer value to median of interlayer distribution
interlayer_edges_change <- select(inter_extended, -weight) #create data frame where weight doesn't exist
##Create scenarios where we change the interedges weight from 0 to 1
k<-seq(0.1,1,by=0.1)
Sen_list_classic = NULL
for(t in k){
output<- interlayer_edges_change %>%
mutate(weight = t)#set fixed interlayer value to t
Sen_list_classic<- rbind(Sen_list_classic,output)
}
# Input: An extended edge list.
dryad_edgelist_complete_fixed <- Sen_list_classic
dryad_multilayer_complete_fixed <- NULL
#Function to calculate modularity according to each interedge weight
modularity_for_fixed <- function(edge_list, output){
for(trial_num in k){
current_trial_edgelist <- edge_list%>% filter(weight == trial_num) #take 1 trial at a time to create multilayer
dryad_multilayer_shuf_trial <- create_multilayer_object(intra = intra_nonextended,
inter = current_trial_edgelist,
nodes = physical_nodes, #nodes are always the same. we're not deleting nodes.
layers = layer_metadata, #layers are always the same. we're not deleting layers.
intra_output_extended = T)
#create modules for empirical network
modules_dryad_multilayer_shuf_1000 <- run_infomap_multilayer(dryad_multilayer_shuf_trial,
infomap_executable = "Infomap",
flow_model = 'directed',
relax = F,
silent = T,
trials = 100,
seed = 497294, #always the same seed
temporal_network = T)
output <- rbind(output, tibble(modules_dryad_multilayer_shuf_1000$modules, trial_num)) #
}
return(output)
}
#calculate modularity according to each interedges weight
dryad_multilayer_complete_fixed_output <- modularity_for_fixed(dryad_edgelist_complete_fixed,
dryad_multilayer_complete_fixed)
#calculate modularity according to each interedges weight
dryad_multilayer_complete_fixed_output <- modularity_for_fixed(dryad_edgelist_complete_fixed,
dryad_multilayer_complete_fixed)
dryad_multilayer_complete_fixed_output <- dryad_multilayer_complete_fixed_output %>% drop_na()
#Plot number of modules according to interedges values
N_modules_inter <- dryad_multilayer_complete_fixed_output %>%
group_by(trial_num) %>% summarise(Num_modules = max(module)) %>% rename(inter_edges = 1)
N_modules_inter_Klil<- ggplot(N_modules_inter, aes(x = inter_edges, y = Num_modules)) +  geom_bar(stat= "identity")+
theme_classic() +  scale_x_continuous(breaks=seq(0.1,1,0.1))+ scale_y_continuous(breaks=seq(0,35,5))+
labs(x='Interedges', y="Number of modules")+ theme(axis.text.x = element_text(size=13),
axis.text.y=element_text(size=13), axis.title = element_text(size=15))
write.csv(dryad_multilayer_complete_fixed_output, "./R/Extra_analysis_results/inter_klil.csv", row.names = FALSE)
#Create multilayer object changing the relax rates to simulate the sensitivity analysis
dryad_multilayer_relax <- create_multilayer_object(intra = intra_nonextended,
inter = inter_extended,
nodes = physical_nodes, #nodes are always the same. we're not deleting nodes.
layers = layer_metadata, #layers are always the same. we're not deleting layers.
intra_output_extended = F)
# Ignore interlayer edges
dryad_multilayer_relax$inter <- NULL
#Run Infomap and return the network's modular structure at increasing relax-rates.
relaxrate_modules <- NULL
for (r in seq(0.1,1, by = 0.1)){
print(r)
modules_relax_rate <- run_infomap_multilayer(dryad_multilayer_relax, relax = T, silent = T, trials = 100, seed = 497294, multilayer_relax_rate = r, multilayer_relax_limit_up = 1, multilayer_relax_limit_down = 0, temporal_network = T)
modules_relax_rate$modules$relax_rate <- r
relaxrate_modules <- rbind(relaxrate_modules, modules_relax_rate$modules)
}
write.csv(relaxrate_modules, "./R/Extra_analysis_results/relax_klil.csv", row.names = FALSE)
##----  New dataframe ---------------------------------------------------------------------------
physical_nodes <- read.csv("./R/Extra_analysis_results/physical_nodes.csv",row.names = 1)
layer_metadata <- read.csv("./R/Extra_analysis_results/layers.csv",row.names = 1)
inter_extended <- read.csv("./R/Extra_analysis_results/inter_edges.csv", row.names = 1)
intra_nonextended <- read.csv("./R/Extra_analysis_results/intra_edges.csv", row.names = 1)
#interlayer distribution
inter_weight_distribution <- inter_extended %>% arrange(weight) %>% select(weight)
#intralayer distribution
intra_weight_distribution <- intra_nonextended %>% arrange(weight) %>% select(weight)
#inter and intra non directed together
inter_intra_non_directed <- data.frame(values= c(intra_nonextended$weight, inter_extended$weight),
group= c(rep("intra", nrow(intra_nonextended)), rep("inter", nrow(inter_extended))))
inter_intra_non_directed %>%
ggplot(aes(x=values, fill=group))+ geom_histogram(position= "identity", alpha= 0.6, color= "black")+ theme_bw()+
theme(panel.grid = element_blank(),
panel.border = element_rect(color = "black",fill = NA,size = 1),
panel.spacing = unit(0.5, "cm", data = NULL),
axis.text = element_text(size=14, color='black'),
axis.title = element_text(size=14, color='black'),
axis.line = element_blank())
#directed intralayer weights distribution
directed_weight_distribution_plants <- intralayer_weighted %>% arrange(weight) %>% select(weight)
intra_inter_data_for_distibution <- data.frame(values= c(
intra_weight_distribution$weight,
inter_weight_distribution$weight))
View(intra_inter_data_for_distibution)
intra_inter_data_for_distibution <- data.frame(values= c(
intra_weight_distribution$weight,
inter_weight_distribution$weight),
group= c(rep("Intra", nrow(intra_weight_distribution)),
rep("Inter", nrow(inter_weight_distribution))))
intra_inter_data_for_distibution %>%
ggplot(aes(x=values, fill=group))+ geom_histogram(position= "identity", alpha= 0.6, color= "black")+ theme_bw()+
theme(panel.grid = element_blank(),
panel.border = element_rect(color = "black",fill = NA,size = 1),
panel.spacing = unit(0.5, "cm", data = NULL),
axis.text = element_text(size=14, color='black'),
axis.title = element_text(size=14, color='black'),
axis.line = element_blank())
View(intra_inter_data_for_distibution)
View(intra_inter_data_for_distibution)
max(intra_inter_data_for_distibution$values)
View(intra_inter_data_for_distibution)
max(inter_extended$weight)
