modules_for_similarity_shuf <- multilayer_1000 %>% filter(trial_num == trial) #take only 1 trial
#pivot modules
module_pivoted_shuf <- pivot_by_module(modules_for_similarity_shuf) #pivot will be done on 1 trial each time
#create edge list with distances
modules_edge_list_shuf <- NULL
for (k in (1:nrow(module_pivoted_shuf))){ #run the function for each row in the data frame
modules_edge_list_shuf <- edge_list_per_module(module_pivoted_shuf[k,], modules_edge_list_shuf)
print(modules_edge_list_shuf)
current_module <- rownames(module_pivoted_shuf)[k]
if (is.null(modules_edge_list_shuf)) next
modules_edge_list_shuf <- modules_edge_list_shuf %>% mutate(module = replace_na(module, current_module)) #add module number
}
edge_list_with_distances_shuf <- right_join(modules_edge_list_shuf, distances_with_ids, by= c("layer_from", "layer_to")) #combine the edge list with the distances between each two layers
edge_list_with_distances_shuf <- na.omit(edge_list_with_distances_shuf) #remove NA
#version with # of modules in layers
edge_list_by_layers_modules_shuf <- edge_list_with_distances_shuf %>% group_by(layer_from, layer_to, module) %>%
summarise(ave_distance= mean(distance_in_meters))
edge_list_by_layers_modules_shuf$count <- c(1)
edge_list_by_layers_modules_shuf <- edge_list_by_layers_modules_shuf %>% mutate(number_of_modules= sum(count)) %>%
select(layer_from, layer_to, module, number_of_modules)
for (i in 1:14){
for (j in (1+i):13){
modules_in_layer_from_shuf <- filter(modules_for_similarity_shuf, layer_id == i) %>% select(module) %>% unique() %>% unlist()
modules_in_layer_to_shuf <- filter(modules_for_similarity_shuf, layer_id == j) %>% select(module) %>% unique() %>% unlist()
#take all nodes in layer_from and all nodes in layer_to to check turnover
int_both <- intersect(modules_in_layer_from_shuf, modules_in_layer_to_shuf) #how many nodes are found in both layers
uni_both <- union(modules_in_layer_from_shuf, modules_in_layer_to_shuf)
turnover <- length(int_both)/length(uni_both)
module_layer_turnover_shuf <- rbind(module_layer_turnover_shuf,
tibble(layer_from = i, layer_to = j, turnover = turnover, trial = trial))
}
}
edge_list_by_layers_ave_shuf <- edge_list_with_distances_shuf %>% group_by(layer_from, layer_to) %>%
summarise(ave_distance= mean(distance_in_meters)) %>% unique()
layers_turnover_with_distnace <- edge_list_by_layers_ave_shuf %>%
merge(module_layer_turnover_shuf, by= c("layer_from", "layer_to")) #merge both versions
}
return(layers_turnover_with_distnace)
}
all_edge_list_layer_combine_no_module_shuf_pols_output <- module_distance_decay_layer_func(dryad_multilayer_shuf_1000_pols_output,
layers_turnover_with_distnace_pols)
layers_turnover_with_distnace_pols <- NULL
layers_turnover_with_distnace_plants <- NULL
layers_turnover_with_distnace_both <- NULL
module_layer_turnover_shuf <- NULL
pivot_by_module <- function(data){ #creates a data frame with module on the side and layer_id on the top
s1 = melt(data, id = c("layer_id", "module"))
s2 = dcast(s1, layer_id ~ module, length)
s3 = t(s2)
s3 <- s3[-1,]
colnames(s3) <- c(1,2,3,4,5,6,7,8,9,10,11,12,13,14)
return(s3)
}
edge_list_per_module <- function(data,edge_list){
#gets one row from a data frame and creates an edge list from it
for (i in (1:13)){
if (data[i]==0) next #only take layers where the module is present
else {
for (j in ((i+1):14)){
if (data[j]==0) next #only take layers where the module is present
else {
edge_list <- rbind(edge_list, tibble(layer_from=i, layer_to=j, module=as.character(NA))) #create edge list of all the layer found in a module
}
}
}
}
return(edge_list)
}
module_distance_decay_layer_func <- function(multilayer_1000,
layers_turnover_with_distnace){
for (trial in 1:1000){
print(trial) #to keep tab on how far along we are
modules_for_similarity_shuf <- multilayer_1000 %>% filter(trial_num == trial) #take only 1 trial
#pivot modules
module_pivoted_shuf <- pivot_by_module(modules_for_similarity_shuf) #pivot will be done on 1 trial each time
#create edge list with distances
modules_edge_list_shuf <- NULL
for (k in (1:nrow(module_pivoted_shuf))){ #run the function for each row in the data frame
modules_edge_list_shuf <- edge_list_per_module(module_pivoted_shuf[k,], modules_edge_list_shuf)
print(modules_edge_list_shuf)
current_module <- rownames(module_pivoted_shuf)[k]
if (is.null(modules_edge_list_shuf)) next
modules_edge_list_shuf <- modules_edge_list_shuf %>% mutate(module = replace_na(module, current_module)) #add module number
}
edge_list_with_distances_shuf <- right_join(modules_edge_list_shuf, distances_with_ids, by= c("layer_from", "layer_to")) #combine the edge list with the distances between each two layers
edge_list_with_distances_shuf <- na.omit(edge_list_with_distances_shuf) #remove NA
#version with # of modules in layers
edge_list_by_layers_modules_shuf <- edge_list_with_distances_shuf %>% group_by(layer_from, layer_to, module) %>%
summarise(ave_distance= mean(distance_in_meters))
edge_list_by_layers_modules_shuf$count <- c(1)
edge_list_by_layers_modules_shuf <- edge_list_by_layers_modules_shuf %>% mutate(number_of_modules= sum(count)) %>%
select(layer_from, layer_to, module, number_of_modules)
for (i in 1:14){
for (j in (1+i):13){
modules_in_layer_from_shuf <- filter(modules_for_similarity_shuf, layer_id == i) %>% select(module) %>% unique() %>% unlist()
modules_in_layer_to_shuf <- filter(modules_for_similarity_shuf, layer_id == j) %>% select(module) %>% unique() %>% unlist()
#take all nodes in layer_from and all nodes in layer_to to check turnover
int_both <- intersect(modules_in_layer_from_shuf, modules_in_layer_to_shuf) #how many nodes are found in both layers
uni_both <- union(modules_in_layer_from_shuf, modules_in_layer_to_shuf)
turnover <- length(int_both)/length(uni_both)
module_layer_turnover_shuf <- rbind(module_layer_turnover_shuf,
tibble(layer_from = i, layer_to = j, turnover = turnover, trial = trial))
}
}
edge_list_by_layers_ave_shuf <- edge_list_with_distances_shuf %>% group_by(layer_from, layer_to) %>%
summarise(ave_distance= mean(distance_in_meters)) %>% unique()
layers_turnover_with_distnace <- edge_list_by_layers_ave_shuf %>%
merge(module_layer_turnover_shuf, by= c("layer_from", "layer_to")) #merge both versions
}
return(layers_turnover_with_distnace)
}
layers_turnover_with_distnace_pols <- NULL
layers_turnover_with_distnace_plants <- NULL
layers_turnover_with_distnace_both <- NULL
module_layer_turnover_shuf <- NULL
#---- outputs layers--------------------------------------------------------------------------------------
all_edge_list_layer_combine_no_module_shuf_pols_output <- module_distance_decay_layer_func(dryad_multilayer_shuf_1000_pols_output,
layers_turnover_with_distnace_pols)
view(all_edge_list_layer_combine_no_module_shuf_pols_output)
write.csv(all_edge_list_layer_combine_no_module_shuf_pols_output,
"./csvs/all_edge_list_layer_combine_no_module_shuf_pols_output.csv",
row.names = FALSE)
all_edge_list_layer_combine_no_module_shuf_pols_output <- read.csv("./csvs/all_edge_list_layer_combine_no_module_shuf_pols_output.csv")
all_edge_list_layer_combine_no_module_shuf_plants_output <- module_distance_decay_layer_func(dryad_multilayer_shuf_1000_plants_output,
layers_turnover_with_distnace_plants)
write.csv(all_edge_list_layer_combine_no_module_shuf_plants_output,
"./csvs/all_edge_list_layer_combine_no_module_shuf_plants_output.csv",
row.names = FALSE)
all_edge_list_layer_combine_no_module_shuf_plants_output <- read.csv("./csvs/all_edge_list_layer_combine_no_module_shuf_plants_output.csv")
#both
all_edge_list_layer_combine_no_module_shuf_both_output <- module_distance_decay_layer_func(dryad_multilayer_shuf_1000_both_output,
layers_turnover_with_distnace_both)
write.csv(all_edge_list_layer_combine_no_module_shuf_both_output,
"./csvs/all_edge_list_layer_combine_no_module_shuf_both_output.csv",
row.names = FALSE)
all_edge_list_layer_combine_no_module_shuf_both_output <- read.csv("./csvs/all_edge_list_layer_combine_no_module_shuf_both_output.csv")
ave_module_layer_turnover_shuf_pols <- all_edge_list_layer_combine_no_module_shuf_pols_output %>%
group_by(layer_from, layer_to) %>%
summarise(ave=mean(turnover), sd=sd(turnover), ave_dist=mean(ave_distance)) %>% mutate(type="null_pollinators") #create mean and sd for each point
#plants
ave_module_layer_turnover_shuf_plants <- all_edge_list_layer_combine_no_module_shuf_plants_output %>%
group_by(layer_from, layer_to) %>%
summarise(ave=mean(turnover), sd=sd(turnover), ave_dist=mean(ave_distance)) %>% mutate(type="null_plants") #create mean and sd for each point
#both
ave_module_layer_turnover_shuf_both <- all_edge_list_layer_combine_no_module_shuf_both_output %>%
group_by(layer_from, layer_to) %>%
summarise(ave=mean(turnover), sd=sd(turnover), ave_dist=mean(ave_distance)) %>% mutate(type="null_both") #create mean and sd for each point
#add the empirical empirical
#layers_turnover_with_distnace_empirical <- read.csv("csvs/layers_turnover_with_distnace_empirical.csv")
empirical_turnover_for_module_layer_shuf <- layers_turnover_with_distnace_empirical %>% group_by(layer_from, layer_to) %>%
summarise(ave=mean(turnover), sd=sd(turnover), ave_dist=mean(distance_in_km)) %>% mutate(type="empirical") #make sure sd is 0 cause its the empirical and not null
empirical_turnover_for_module_layer_shuf_no_self_loop <- empirical_turnover_for_module_layer_shuf %>% subset(layer_from != layer_to) #for empirical only distance decay graph
empirical_turnover_for_module_layer_shuf_no_self_loop_km <- empirical_turnover_for_module_layer_shuf_no_self_loop %>%
mutate(distance_in_km = ave_dist)
jaccard_similarity_layer_null <- rbind(ave_module_layer_turnover_shuf_pols,
ave_module_layer_turnover_shuf_plants, ave_module_layer_turnover_shuf_both)
jaccard_similarity_layer_null_no_self_loop <- jaccard_similarity_layer_null %>% subset(layer_from != layer_to)
jaccard_similarity_layer_null_no_self_loop_km <- jaccard_similarity_layer_null_no_self_loop %>%
mutate(distance_in_kn = ave_dist/1000)
jaccard_similarity_layer_empirical_and_null_no_self_loop_km <- rbind(empirical_turnover_for_module_layer_shuf_no_self_loop,
jaccard_similarity_layer_null_no_self_loop_km)
jaccard_similarity_layer_empirical_and_null_no_self_loop_km %>%
ggplot(aes(x= ave_dist, y= ave, group= type, color= type))+
geom_point()+ geom_errorbar(aes(ymin= ave-sd, ymax= ave+sd))+ theme_classic()+ geom_smooth(method= "lm", se=F)+
theme(axis.title=element_text(size=22))+theme(axis.text.x=element_text(size=15))+
theme(axis.text.y=element_text(size=15))+ theme(legend.title = element_text(size = 13), legend.text = element_text(size = 13))+
labs(x="Distance in Km", y="Jaccard Similarity")+
theme(panel.grid = element_blank(),
panel.border = element_rect(color = "black",fill = NA,size = 1),
panel.spacing = unit(0.5, "cm", data = NULL),
axis.text = element_text(size=14, color='black'),
axis.title = element_text(size=14, color='black'),
axis.line = element_blank())
empirical_turnover_for_module_layer_shuf_no_self_loop
jaccard_similarity_layer_null_no_self_loop_km
#combine all layers
jaccard_similarity_layer_null <- rbind(ave_module_layer_turnover_shuf_pols,
ave_module_layer_turnover_shuf_plants, ave_module_layer_turnover_shuf_both)
jaccard_similarity_layer_null_no_self_loop <- jaccard_similarity_layer_null %>% subset(layer_from != layer_to)
jaccard_similarity_layer_null_no_self_loop_km <- jaccard_similarity_layer_null_no_self_loop %>%
mutate(distance_in_km = ave_dist/1000)
jaccard_similarity_layer_empirical_and_null_no_self_loop_km <- rbind(empirical_turnover_for_module_layer_shuf_no_self_loop,
jaccard_similarity_layer_null_no_self_loop_km)
#empirical and null
jaccard_similarity_layer_empirical_and_null_no_self_loop_km %>%
ggplot(aes(x= ave_dist, y= ave, group= type, color= type))+
geom_point()+ geom_errorbar(aes(ymin= ave-sd, ymax= ave+sd))+ theme_classic()+ geom_smooth(method= "lm", se=F)+
theme(axis.title=element_text(size=22))+theme(axis.text.x=element_text(size=15))+
theme(axis.text.y=element_text(size=15))+ theme(legend.title = element_text(size = 13), legend.text = element_text(size = 13))+
labs(x="Distance in Km", y="Jaccard Similarity")+
theme(panel.grid = element_blank(),
panel.border = element_rect(color = "black",fill = NA,size = 1),
panel.spacing = unit(0.5, "cm", data = NULL),
axis.text = element_text(size=14, color='black'),
axis.title = element_text(size=14, color='black'),
axis.line = element_blank())
jaccard_similarity_layer_null_no_self_loop
jaccard_similarity_layer_null_no_self_loop_km
#jaccard_similarity_empirical_and_null_no_self_loop <- jaccard_similarity_empirical_and_null %>% subset(layer_from != layer_to)
#jaccard_similarity_empirical_and_null_no_self_loop_km <- jaccard_similarity_empirical_and_null_no_self_loop %>%
#  mutate(ave_dist_in_km = ave_dist/1000)
#combine all layers
jaccard_similarity_layer_null <- rbind(ave_module_layer_turnover_shuf_pols,
ave_module_layer_turnover_shuf_plants, ave_module_layer_turnover_shuf_both)
jaccard_similarity_layer_null_no_self_loop <- jaccard_similarity_layer_null %>% subset(layer_from != layer_to)
jaccard_similarity_layer_null_no_self_loop_km <- jaccard_similarity_layer_null_no_self_loop %>%
mutate(ave_dist = ave_dist/1000)
jaccard_similarity_layer_empirical_and_null_no_self_loop_km <- rbind(empirical_turnover_for_module_layer_shuf_no_self_loop,
jaccard_similarity_layer_null_no_self_loop_km)
jaccard_similarity_layer_empirical_and_null_no_self_loop_km %>%
ggplot(aes(x= ave_dist, y= ave, group= type, color= type))+
geom_point()+ geom_errorbar(aes(ymin= ave-sd, ymax= ave+sd))+ theme_classic()+ geom_smooth(method= "lm", se=F)+
theme(axis.title=element_text(size=22))+theme(axis.text.x=element_text(size=15))+
theme(axis.text.y=element_text(size=15))+ theme(legend.title = element_text(size = 13), legend.text = element_text(size = 13))+
labs(x="Distance in Km", y="Jaccard Similarity")+
theme(panel.grid = element_blank(),
panel.border = element_rect(color = "black",fill = NA,size = 1),
panel.spacing = unit(0.5, "cm", data = NULL),
axis.text = element_text(size=14, color='black'),
axis.title = element_text(size=14, color='black'),
axis.line = element_blank())
pdf('./graphs/shuffle_between_layers/M1_module_distance_decay.pdf', 10, 6)
jaccard_similarity_layer_empirical_and_null_no_self_loop_km %>%
ggplot(aes(x= ave_dist, y= ave, group= type, color= type))+
geom_point()+ geom_errorbar(aes(ymin= ave-sd, ymax= ave+sd))+ theme_classic()+ geom_smooth(method= "lm", se=F)+
theme(axis.title=element_text(size=22))+theme(axis.text.x=element_text(size=15))+
theme(axis.text.y=element_text(size=15))+ theme(legend.title = element_text(size = 13), legend.text = element_text(size = 13))+
labs(x="Distance in Km", y="Jaccard Similarity")+
theme(panel.grid = element_blank(),
panel.border = element_rect(color = "black",fill = NA,size = 1),
panel.spacing = unit(0.5, "cm", data = NULL),
axis.text = element_text(size=14, color='black'),
axis.title = element_text(size=14, color='black'),
axis.line = element_blank())
dev.off()
write.csv(jaccard_similarity_layer_empirical_and_null_no_self_loop_km,
"./csvs/jaccard_similarity_layer_empirical_and_null_no_self_loop_km.csv",
row.names = FALSE)
lm1_module = lm(ave ~ ave_dist ,data=subset(jaccard_similarity_empirical_and_null_no_self_loop,
jaccard_similarity_empirical_and_null_no_self_loop$type=="empirical")) #in empirical
lm1_module = lm(ave ~ ave_dist ,data=subset(jaccard_similarity_layer_empirical_and_null_no_self_loop_km,
jaccard_similarity_layer_empirical_and_null_no_self_loop_km$type=="empirical")) #in empirical
lm2_module = lm(ave ~ ave_dist ,data=subset(jaccard_similarity_layer_empirical_and_null_no_self_loop_km,
jaccard_similarity_layer_empirical_and_null_no_self_loop_km$type=="null_pollinators")) #in null pols
lm3_module = lm(ave ~ ave_dist ,data=subset(jaccard_similarity_layer_empirical_and_null_no_self_loop_km,
jaccard_similarity_layer_empirical_and_null_no_self_loop_km$type=="null_plants")) #in null plants
lm4_module = lm(ave ~ ave_dist ,data=subset(jaccard_similarity_layer_empirical_and_null_no_self_loop_km,
jaccard_similarity_layer_empirical_and_null_no_self_loop_km$type=="null_both")) #in null both
lm1_module_equation <- paste("y=", coef(lm1_module)[[1]], "+", coef(lm1_module)[[2]], "*x")
lm2_module_equation <- paste("y=", coef(lm2_module)[[1]], "+", coef(lm2_module)[[2]], "*x")
lm3_module_equation <- paste("y=", coef(lm3_module)[[1]], "+", coef(lm3_module)[[2]], "*x")
lm4_module_equation <- paste("y=", coef(lm4_module)[[1]], "+", coef(lm4_module)[[2]], "*x")
#get equations
lm1_module_equation <- paste("y=", coef(lm1_module)[[1]], "+", coef(lm1_module)[[2]], "*x")
lm2_module_equation <- paste("y=", coef(lm2_module)[[1]], "+", coef(lm2_module)[[2]], "*x")
lm3_module_equation <- paste("y=", coef(lm3_module)[[1]], "+", coef(lm3_module)[[2]], "*x")
lm4_module_equation <- paste("y=", coef(lm4_module)[[1]], "+", coef(lm4_module)[[2]], "*x")
b1_module <- summary(lm1_module)$coefficients[2,1]
se1_module <- summary(lm1_module)$coefficients[2,2]
b2_module <- summary(lm2_module)$coefficients[2,1]
se2_module <- summary(lm2_module)$coefficients[2,2]
b3_module <- summary(lm3_module)$coefficients[2,1]
se3_module <- summary(lm3_module)$coefficients[2,2]
b4_module <- summary(lm4_module)$coefficients[2,1]
se4_module <- summary(lm4_module)$coefficients[2,2]
p_value_module_pols = 2*pnorm(-abs(compare.coeff(b1_module,se1_module,b2_module,se2_module)))
p_value_module_pols
p_value_module_plants = 2*pnorm(-abs(compare.coeff(b1_module,se1_module,b3_module,se3_module)))
p_value_module_plants
p_value_module_both = 2*pnorm(-abs(compare.coeff(b1_module,se1_module,b4_module,se4_module)))
p_value_module_both
num_of_modules_pols <- NULL
num_of_modules_plants <- NULL
num_of_modules_both <- NULL
Num_of_modules <- NULL
num_of_modules_empirical <- modules_dryad_multilayer$modules %>% slice(which.max(module)) %>% select(module) #number of modules in the empirical network
num_of_modules_empirical <- modules %>% slice(which.max(module)) %>% select(module) #number of modules in the empirical network
Num_of_modules <- rbind(Num_of_modules, tibble(trial_num = NA ,module = num_of_modules_empirical, type = "empirical")) #add the number of modules for empirical
threshold <- unlist(Num_of_modules$module) #number of modules in empirical network
num_of_modules_pols <- dryad_multilayer_shuf_1000_pols_output %>% group_by(trial_num) %>% slice(which.max(module)) %>% select(module) #num of modules in each iteration of pols
num_of_modules_pols$type <- "null_pollinators"
#plants
num_of_modules_plants <- dryad_multilayer_shuf_1000_plants_output %>% group_by(trial_num) %>% slice(which.max(module)) %>% select(module) #num of modules in each iteration of plants
num_of_modules_plants$type <- "null_plants"
num_of_modules_both <- dryad_multilayer_shuf_1000_both_output %>% group_by(trial_num) %>% slice(which.max(module)) %>% select(module) #num of modules in each iteration of both
num_of_modules_both$type <- "null_both"
Num_of_modules <- rbind(Num_of_modules, num_of_modules_pols, num_of_modules_plants, num_of_modules_both)
Num_of_modules$module <- unlist(Num_of_modules$module) #make sure that module column is not a list
Num_of_modules %>%
ggplot(aes(x = module, fill = type))+
geom_histogram(color = "black", alpha = 0.6, position = "identity")+
geom_vline(aes(xintercept=threshold), color="red")+
theme_classic()+
theme(axis.title=element_text(size=22))+theme(axis.text.x=element_text(size=15))+
theme(axis.text.y=element_text(size=15))+
geom_text(y=400, x=56, label="empirical network", color= "red", size=5, family= "Tahoma")+
labs(x="Number of Modules", y="Number of Iterations")+
theme(panel.grid = element_blank(),
panel.border = element_rect(color = "black",fill = NA,size = 1),
panel.spacing = unit(0.5, "cm", data = NULL),
axis.text = element_text(size=14, color='black'),
axis.title = element_text(size=14, color='black'),
axis.line = element_blank())
Num_of_modules %>%
ggplot(aes(x = module, fill = type))+
geom_histogram(color = "black", alpha = 0.6, position = "identity")+
geom_vline(aes(xintercept=threshold), color="red")+
theme_classic()+
theme(axis.title=element_text(size=22))+theme(axis.text.x=element_text(size=15))+
theme(axis.text.y=element_text(size=15))+
geom_text(y=400, x=56, label="empirical network", color= "red", size=5, family= "Tahoma")+
labs(x="Number of Modules", y="Number of Iterations")+
scale_x_continuous(breaks=seq(0,90,10))+
theme(panel.grid = element_blank(),
panel.border = element_rect(color = "black",fill = NA,size = 1),
panel.spacing = unit(0.5, "cm", data = NULL),
axis.text = element_text(size=14, color='black'),
axis.title = element_text(size=14, color='black'),
axis.line = element_blank())
#create graph for number of modules
Num_of_modules %>%
ggplot(aes(x = module, fill = type))+
geom_histogram(color = "black", alpha = 0.6, position = "identity")+
geom_vline(aes(xintercept=threshold), color="red")+
theme_classic()+
theme(axis.title=element_text(size=22))+theme(axis.text.x=element_text(size=15))+
theme(axis.text.y=element_text(size=15))+
geom_text(y=400, x=56, label="empirical network", color= "red", size=5, family= "Tahoma")+
labs(x="Number of Modules", y="Number of Iterations")+
scale_x_continuous(breaks=seq(1,90,10))+
theme(panel.grid = element_blank(),
panel.border = element_rect(color = "black",fill = NA,size = 1),
panel.spacing = unit(0.5, "cm", data = NULL),
axis.text = element_text(size=14, color='black'),
axis.title = element_text(size=14, color='black'),
axis.line = element_blank())
Num_of_modules %>%
ggplot(aes(x = module, fill = type))+
geom_histogram(color = "black", alpha = 0.6, position = "identity")+
geom_vline(aes(xintercept=threshold), color="red")+
theme_classic()+
theme(axis.title=element_text(size=22))+theme(axis.text.x=element_text(size=15))+
theme(axis.text.y=element_text(size=15))+
geom_text(y=400, x=56, label="empirical network", color= "red", size=5, family= "Tahoma")+
labs(x="Number of Modules", y="Number of Iterations")+
scale_x_continuous(breaks=seq(1,90,5))+
theme(panel.grid = element_blank(),
panel.border = element_rect(color = "black",fill = NA,size = 1),
panel.spacing = unit(0.5, "cm", data = NULL),
axis.text = element_text(size=14, color='black'),
axis.title = element_text(size=14, color='black'),
axis.line = element_blank())
#create graph for number of modules
pdf('./graphs/shuffle_between_layers/number_of_modules_M1.pdf', 10, 6)
Num_of_modules %>%
ggplot(aes(x = module, fill = type))+
geom_histogram(color = "black", alpha = 0.6, position = "identity")+
geom_vline(aes(xintercept=threshold), color="red")+
theme_classic()+
theme(axis.title=element_text(size=22))+theme(axis.text.x=element_text(size=15))+
theme(axis.text.y=element_text(size=15))+
geom_text(y=400, x=56, label="empirical network", color= "red", size=5, family= "Tahoma")+
labs(x="Number of Modules", y="Number of Iterations")+
scale_x_continuous(breaks=seq(1,90,5))+
theme(panel.grid = element_blank(),
panel.border = element_rect(color = "black",fill = NA,size = 1),
panel.spacing = unit(0.5, "cm", data = NULL),
axis.text = element_text(size=14, color='black'),
axis.title = element_text(size=14, color='black'),
axis.line = element_blank())
iteration_correlation_pols <- NULL
iteration_correlation_data_pols <- all_edge_list_island_combine_no_module_shuf_pols_output %>% subset(layer_from != layer_to)
iteration_correlation_pols <- NULL
iteration_correlation_data_pols <- all_edge_list_layer_combine_no_module_shuf_pols_output %>% subset(layer_from != layer_to)
for (i in 1:1000){
trial_pols = iteration_correlation_data_pols %>% filter(trial == i)
iteration_correlation_new_pols <- cor.test(trial_pols$turnover, trial_pols$ave_distance, method = "pearson")
lm_val_pols <- lm(turnover ~ ave_distance, data = trial_pols)
iteration_correlation_pols <- rbind(iteration_correlation_pols, tibble(estimate = iteration_correlation_new_pols$estimate,
p_val = iteration_correlation_new_pols$p.value,
statistic = iteration_correlation_new_pols$statistic,
confidence_int_low = iteration_correlation_new_pols$conf.int[1],
confidence_int_high = iteration_correlation_new_pols$conf.int[2],
slope = lm_val_pols$coefficients[2],
intercept = lm_val_pols$coefficients[1],
rsquared = summary(lm_val_pols)$adj.r.squared,
trial_num = i))
}
write.csv(iteration_correlation_pols, "./csvs/iteration_correlation_pols.csv", row.names = FALSE)
#correlation empirical
layer_turnover_with_distnace_empirical_no_loop <- layers_turnover_with_distnace_empirical %>% subset(layer_from != layer_to)
correlation_empirical_data_pols <- cor.test(layer_turnover_with_distnace_empirical_no_loop$turnover, #ave is just the value of the turnover
layer_turnover_with_distnace_empirical_no_loop$ave_distance, method = "pearson")
layer_turnover_with_distnace_empirical_no_loop
#correlation empirical
layer_turnover_with_distnace_empirical_no_loop <- layers_turnover_with_distnace_empirical %>% subset(layer_from != layer_to)
correlation_empirical_data_pols <- cor.test(layer_turnover_with_distnace_empirical_no_loop$turnover, #ave is just the value of the turnover
layer_turnover_with_distnace_empirical_no_loop$distance_in_km, method = "pearson")
lm_val_empirical_pols <- lm(turnover ~ distance_in_km, data = layer_turnover_with_distnace_empirical_no_loop)
correlation_empirical_pols <- tibble(estimate = correlation_empirical_data_pols$estimate,
p_val = correlation_empirical_data_pols$p.value,
statistic = correlation_empirical_data_pols$statistic,
confidence_int_low = correlation_empirical_data_pols$conf.int[1],
confidence_int_high = correlation_empirical_data_pols$conf.int[2],
slope = lm_val_empirical_pols$coefficients[2],
intercept = lm_val_empirical_pols$coefficients[1],
rsquared = summary(lm_val_empirical_pols)$adj.r.squared)
write.csv(correlation_empirical_pols, "./csvs/correlation_empirical_pols.csv", row.names = FALSE) #so it can be used for classical shuffling
iteration_correlation_pols %>% ggplot(aes(x = estimate))+ geom_density(fill = "#BE75FA", color = "#BE75FA", alpha = 0.4)+
theme_classic()+ labs(x = "r")+
geom_vline(xintercept = correlation_empirical_pols$estimate, linetype = "dashed", color = "#F47069")
p_r_pols <- sum(iteration_correlation_pols$estimate < correlation_empirical_pols$estimate)/1000
p_r_pols
iteration_correlation_pols %>% ggplot(aes(x = estimate))+ geom_density(fill = "#BE75FA", color = "#BE75FA", alpha = 0.4)+
theme_classic()+ labs(x = "r")+
geom_vline(xint
iteration_correlation_pols %>% ggplot(aes(x = estimate))+ geom_density(fill = "#BE75FA", color = "#BE75FA", alpha = 0.4)+
iteration_correlation_pols %>% ggplot(aes(x = estimate))+ geom_density(fill = "#BE75FA", color = "#BE75FA", alpha = 0.4)+
theme_classic()+ labs(x = "r")#+
iteration_correlation_pols
iteration_correlation_pols %>%
ggplot(aes(x = estimate))+ geom_density(fill = "#BE75FA", color = "#BE75FA", alpha = 0.4)+
theme_classic()+ labs(x = "r")#+
iteration_correlation_pols %>%
ggplot(aes(x = estimate))+ geom_density(fill = "#BE75FA", color = "#BE75FA", alpha = 0.4)+
theme_classic()+ labs(x = "r")+
geom_vline(xintercept = correlation_empirical_pols$estimate, linetype = "dashed", color = "#F47069")
iteration_correlation_pols %>% ggplot(aes(x = rsquared))+
geom_density(fill = "#BE75FA", color = "#BE75FA", alpha = 0.4)+
theme_classic()+ labs(x = "R squared")+
geom_vline(xintercept = correlation_empirical_pols$rsquared, linetype = "dashed", color = "#F47069")+
theme(axis.title=element_text(size=22))
print(1)
iteration_correlation_pols %>% ggplot(aes(x = rsquared))+
geom_density(fill = "#BE75FA", color = "#BE75FA", alpha = 0.4)+
theme_classic()+ labs(x = "R squared")+
geom_vline(xintercept = correlation_empirical_pols$rsquared, linetype = "dashed", color = "#F47069")+
theme(axis.title=element_text(size=22))
iteration_correlation_pols
view(iteration_correlation_pols)
iteration_correlation_pols %>%
ggplot(aes(x = rsquared))+
geom_density(fill = "#BE75FA", color = "#BE75FA", alpha = 0.4)+
theme_classic()+ labs(x = "R squared")
iteration_correlation_pols %>%
ggplot(aes(x = rsquared))
iteration_correlation_pols <- NULL
iteration_correlation_data_pols <- all_edge_list_layer_combine_no_module_shuf_pols_output %>% subset(layer_from != layer_to)
for (i in 1:1000){
print(i)
trial_pols = iteration_correlation_data_pols %>% filter(trial == i)
iteration_correlation_new_pols <- cor.test(trial_pols$turnover, trial_pols$ave_distance, method = "pearson")
lm_val_pols <- lm(turnover ~ ave_distance, data = trial_pols)
iteration_correlation_pols <- rbind(iteration_correlation_pols, tibble(estimate = iteration_correlation_new_pols$estimate,
p_val = iteration_correlation_new_pols$p.value,
statistic = iteration_correlation_new_pols$statistic,
confidence_int_low = iteration_correlation_new_pols$conf.int[1],
confidence_int_high = iteration_correlation_new_pols$conf.int[2],
slope = lm_val_pols$coefficients[2],
intercept = lm_val_pols$coefficients[1],
rsquared = summary(lm_val_pols)$adj.r.squared,
trial_num = i))
}
write.csv(iteration_correlation_pols, "./csvs/iteration_correlation_pols.csv", row.names = FALSE)
layer_turnover_with_distnace_empirical_no_loop <- layers_turnover_with_distnace_empirical %>% subset(layer_from != layer_to)
correlation_empirical_data_pols <- cor.test(layer_turnover_with_distnace_empirical_no_loop$turnover, #ave is just the value of the turnover
layer_turnover_with_distnace_empirical_no_loop$distance_in_km, method = "pearson")
lm_val_empirical_pols <- lm(turnover ~ distance_in_km, data = layer_turnover_with_distnace_empirical_no_loop)
lm_val_empirical_pols
correlation_empirical_pols <- tibble(estimate = correlation_empirical_data_pols$estimate,
p_val = correlation_empirical_data_pols$p.value,
statistic = correlation_empirical_data_pols$statistic,
confidence_int_low = correlation_empirical_data_pols$conf.int[1],
confidence_int_high = correlation_empirical_data_pols$conf.int[2],
slope = lm_val_empirical_pols$coefficients[2],
intercept = lm_val_empirical_pols$coefficients[1],
rsquared = summary(lm_val_empirical_pols)$adj.r.squared)
write.csv(correlation_empirical_pols, "./csvs/correlation_empirical_pols.csv", row.names = FALSE) #so it can be used for classical shuffling
correlation_empirical_pols <- read.csv("./csvs/correlation_empirical_pols.csv")
iteration_correlation_pols %>%
ggplot(aes(x = estimate))+ geom_density(fill = "#BE75FA", color = "#BE75FA", alpha = 0.4)+
theme_classic()+ labs(x = "r")+
geom_vline(xintercept = correlation_empirical_pols$estimate, linetype = "dashed", color = "#F47069")
iteration_correlation_pols %>%
ggplot(aes(x = rsquared))+
geom_density(alpha = 0.4)
p_rsquared_pols <- sum(iteration_correlation_pols$rsquared > correlation_empirical_pols$rsquared)/1000
p_rsquared_pols
iteration_correlation_pols %>%
ggplot(aes(x = rsquared))+
geom_density(fill = "#BE75FA", color = "#BE75FA", alpha = 0.4)+
theme_classic()+ labs(x = "R squared")+
geom_vline(xintercept = correlation_empirical_pols$rsquared, linetype = "dashed", color = "#F47069")+
theme(axis.title=element_text(size=22))
iteration_correlation_pols %>%
ggplot(aes(x = rsquared))+
geom_density(fill = "#BE75FA", color = "#BE75FA", alpha = 0.4)+
theme_classic()+ labs(x = "R squared")+
geom_vline(xintercept = correlation_empirical_pols$rsquared, linetype = "dashed", color = "#F47069")+
theme(axis.title=element_text(size=22))
jaccard_similarity_layer_empirical_and_null_no_self_loop_km %>%
ggplot(aes(x= ave_dist, y= ave, group= type, color= type))+
geom_point()+ geom_errorbar(aes(ymin= ave-sd, ymax= ave+sd))+ theme_classic()+ geom_smooth(method= "lm", se=F)+
theme(axis.title=element_text(size=22))+theme(axis.text.x=element_text(size=15))+
theme(axis.text.y=element_text(size=15))+ theme(legend.title = element_text(size = 13), legend.text = element_text(size = 13))+
labs(x="Distance in Km", y="Jaccard Similarity")+
theme(panel.grid = element_blank(),
panel.border = element_rect(color = "black",fill = NA,size = 1),
panel.spacing = unit(0.5, "cm", data = NULL),
axis.text = element_text(size=14, color='black'),
axis.title = element_text(size=14, color='black'),
axis.line = element_blank())
