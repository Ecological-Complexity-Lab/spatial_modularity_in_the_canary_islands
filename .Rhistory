random_num_list <- 1:nrow(trial) #list of all row numbers
for (j in 1:3000){
random_num_1 <- sample(random_num_list, 1, replace = FALSE) #pick 1st random number from list
random_num_2 <- sample(random_num_list, 1, replace = FALSE) #pick 2nd random number from list
random_species_1 <- str_split(rownames(trial)[random_num_1], " _ ")[[1]][2] #split the from to layer and node and only take node
random_species_2 <- str_split(rownames(trial)[random_num_2], " _ ")[[1]][2] #split the to to layer and node and only take node
random_layer_1 <- str_split(rownames(trial)[random_num_1], " _ ")[[1]][1] #split the from to layer and node and only take layer
random_layer_2 <- str_split(rownames(trial)[random_num_2], " _ ")[[1]][1]#split the to to layer and node and only take layer
wanted_value_layer_1 <- paste(random_layer_1 , "_" , random_species_2) #combination of layer 1 and node 2
wanted_value_layer_2 <- paste(random_layer_2 , "_" , random_species_1) #combination of layer 2 and node 1
if (random_species_1 == random_species_2) next #make sure we're not just switching the same species with itself
if (wanted_value_layer_1 %in% rownames(trial)) next #make sure we don't already have the wanted combination in the layer
if (wanted_value_layer_2 %in% rownames(trial)) next
else{
#if we dont have the combination:
rownames(trial)[random_num_1] <- wanted_value_layer_1 #change the species to its new layer
rownames(trial)[random_num_2] <- wanted_value_layer_2
}
}
trial_with_shuf <- cbind(trial, i) #add trial number
shuf_trial_matrix <- rbind(shuf_trial_matrix, trial_with_shuf) #create big matrix of all matrices
edge_list_version <- melt(as.matrix(trial)) %>% filter(value > 0) %>%
select(from=Var1, to=Var2, weight=value) #turn the matrix back into a data frame of edge lists
edge_list_version$trial_number <- i #add trial number to the edge list
shuf_null_edge_list <- rbind(shuf_null_edge_list, edge_list_version) #create mega edge list with all repetitions
}
shuf_null_edge_list$layer_from <- substr(shuf_null_edge_list$from, 1,2) #choose the layer portion of the mixed layer_node name
shuf_null_edge_list$node_from <- substr(shuf_null_edge_list$from, 5,8) #choose the node portion of the mixed layer_node name
shuf_null_edge_list$layer_to <- substr(shuf_null_edge_list$to, 1,2) #choose the layer portion of the mixed layer_node name
shuf_null_edge_list$node_to <- substr(shuf_null_edge_list$to, 5,8) #choose the node portion of the mixed layer_node name
shuf_null_edge_list <- shuf_null_edge_list %>%
select(layer_from, node_from, layer_to, node_to, weight, trial_number)
View(shuf_null_edge_list)
##---- create interedges  --------------------------------------------------------
# keep only species that occur in 2 or more layers
co_occurrence<- shuf_null_edge_list %>%
group_by(trial_number,node_from) %>%
mutate(num_layers_from=n_distinct(layer_from)) %>%
filter(num_layers_from>="2")
View(co_occurrence)
##---- create interedges  --------------------------------------------------------
# keep only species that occur in 2 or more layers
co_occurrence_from_shuf<- shuf_null_edge_list %>%
group_by(trial_number,node_from) %>%
mutate(num_layers_from=n_distinct(layer_from)) %>%
filter(num_layers_from>="2")
prueba2<-co_occurrence_from_shuf %>% filter(trial_number==1 & trial_number==2)
View(prueba2)
prueba2<-co_occurrence_from_shuf %>% filter(trial_number==1, trial_number==2)
prueba2<-co_occurrence_from_shuf %>% filter(trial_number==c(1,2)
prueba2<-co_occurrence_from_shuf %>% filter(trial_number==1|trial_number==2 )
prueba2<-co_occurrence_from_shuf %>% filter(trial_number==1|trial_number==2 )
View(prueba2)
# a for loop that calculates all the interlayer edges based on jaccard index
interlayers_with_weights_islands <- NULL
prueba2<-co_occurrence_from_shuf %>% filter(trial_number==1|trial_number==2 )
for (trial in 1:1000){
print(trial) #to keep tab on how far along we are
co_occurrence_from_shuf2 <- prueba2 %>% filter(trial_num == trial) #take only 1 trial
for (i in unique(co_occurrence_from_shuf2$node_from)) {
print(i)
partners_sp <-
co_occurrence %>%
filter(node_from== i) %>%
group_by(node_to) %>%
select(c(node_to,layer_from)) %>%
distinct() %>%
mutate(present=1) %>%
spread(node_to, present, fill = 0) %>%
column_to_rownames("layer_from")
beta_layers_sp <- 1-as.matrix(vegdist(partners_sp, "jaccard"))
beta_layers_sp_m <- melt(as.matrix(extRC::tril(beta_layers_sp)))
inter_fid <- beta_layers_sp_m  %>%
tibble() %>%
filter(value!=0) %>%
subset(Var1 != Var2) %>%
mutate(node_from=i, node_to =i) %>%
select(c(node_from,layer_from=Var1, layer_to=Var2,node_to, weight=value))
interlayers_with_weights_islands <- rbind(interlayers_with_weights_islands,inter_fid)
}
}
View(co_occurrence_from_shuf)
# a for loop that calculates all the interlayer edges based on jaccard index
interlayers_with_weights_islands <- NULL
prueba2<-co_occurrence_from_shuf %>% filter(trial_number==1|trial_number==2 )
for (trial in 1:1000){
print(trial) #to keep tab on how far along we are
co_occurrence_from_shuf2 <- prueba2 %>% filter(trial_number == trial) #take only 1 trial
for (i in unique(co_occurrence_from_shuf2$node_from)) {
print(i)
partners_sp <-
co_occurrence %>%
filter(node_from== i) %>%
group_by(node_to) %>%
select(c(node_to,layer_from)) %>%
distinct() %>%
mutate(present=1) %>%
spread(node_to, present, fill = 0) %>%
column_to_rownames("layer_from")
beta_layers_sp <- 1-as.matrix(vegdist(partners_sp, "jaccard"))
beta_layers_sp_m <- melt(as.matrix(extRC::tril(beta_layers_sp)))
inter_fid <- beta_layers_sp_m  %>%
tibble() %>%
filter(value!=0) %>%
subset(Var1 != Var2) %>%
mutate(node_from=i, node_to =i) %>%
select(c(node_from,layer_from=Var1, layer_to=Var2,node_to, weight=value))
interlayers_with_weights_islands <- rbind(interlayers_with_weights_islands,inter_fid)
}
}
View(interlayers_with_weights_islands)
for (trial in 1:2){
print(trial) #to keep tab on how far along we are
co_occurrence_from_shuf2 <- prueba2 %>% filter(trial_number == trial) #take only 1 trial
for (i in unique(co_occurrence_from_shuf2$node_from)) {
print(i)
partners_sp <-
co_occurrence %>%
filter(node_from== i) %>%
group_by(node_to) %>%
select(c(node_to,layer_from)) %>%
distinct() %>%
mutate(present=1) %>%
spread(node_to, present, fill = 0) %>%
column_to_rownames("layer_from")
beta_layers_sp <- 1-as.matrix(vegdist(partners_sp, "jaccard"))
beta_layers_sp_m <- melt(as.matrix(extRC::tril(beta_layers_sp)))
inter_fid <- beta_layers_sp_m  %>%
tibble() %>%
filter(value!=0) %>%
subset(Var1 != Var2) %>%
mutate(node_from=i, node_to =i, trial_num=trial) %>%
select(c(node_from,layer_from=Var1, layer_to=Var2,node_to, weight=value,trial_num))
interlayers_with_weights_islands <- rbind(interlayers_with_weights_islands,inter_fid)
}
}
# a for loop that calculates all the interlayer edges based on jaccard index
interlayers_with_weights_islands <- NULL
prueba2<-co_occurrence_from_shuf %>% filter(trial_number==1|trial_number==2 )
for (trial in 1:2){
print(trial) #to keep tab on how far along we are
co_occurrence_from_shuf2 <- prueba2 %>% filter(trial_number == trial) #take only 1 trial
for (i in unique(co_occurrence_from_shuf2$node_from)) {
print(i)
partners_sp <-
co_occurrence %>%
filter(node_from== i) %>%
group_by(node_to) %>%
select(c(node_to,layer_from)) %>%
distinct() %>%
mutate(present=1) %>%
spread(node_to, present, fill = 0) %>%
column_to_rownames("layer_from")
beta_layers_sp <- 1-as.matrix(vegdist(partners_sp, "jaccard"))
beta_layers_sp_m <- melt(as.matrix(extRC::tril(beta_layers_sp)))
inter_fid <- beta_layers_sp_m  %>%
tibble() %>%
filter(value!=0) %>%
subset(Var1 != Var2) %>%
mutate(node_from=i, node_to =i, trial_num=trial) %>%
select(c(node_from,layer_from=Var1, layer_to=Var2,node_to, weight=value,trial_num))
interlayers_with_weights_islands <- rbind(interlayers_with_weights_islands,inter_fid)
}
}
View(interlayers_with_weights_islands)
# a for loop that calculates all the interlayer edges based on jaccard index
interlayers_with_weights_islands <- NULL
prueba2<-co_occurrence_from_shuf %>% filter(trial_number==1|trial_number==4 )
for (trial in 1:4){
print(trial) #to keep tab on how far along we are
co_occurrence_from_shuf2 <- prueba2 %>% filter(trial_number == trial) #take only 1 trial
for (i in unique(co_occurrence_from_shuf2$node_from)) {
print(i)
partners_sp <-
co_occurrence %>%
filter(node_from== i) %>%
group_by(node_to) %>%
select(c(node_to,layer_from)) %>%
distinct() %>%
mutate(present=1) %>%
spread(node_to, present, fill = 0) %>%
column_to_rownames("layer_from")
beta_layers_sp <- 1-as.matrix(vegdist(partners_sp, "jaccard"))
beta_layers_sp_m <- melt(as.matrix(extRC::tril(beta_layers_sp)))
inter_fid <- beta_layers_sp_m  %>%
tibble() %>%
filter(value!=0) %>%
subset(Var1 != Var2) %>%
mutate(node_from=i, node_to =i, trial_num=trial) %>%
select(c(node_from,layer_from=Var1, layer_to=Var2,node_to, weight=value,trial_num))
interlayers_with_weights_islands <- rbind(interlayers_with_weights_islands,inter_fid)
}
}
View(interlayers_with_weights_islands)
View(co_occurrence_from_shuf)
##---load_libraries-------------------------------------------------------------------------------------------------
options(rgl.useNULL = TRUE)
library(infomapecology)
library(igraph)
library(bipartite)
library(tidyverse)
library(magrittr)
library(betalink)
library(readxl)
library(ggalluvial)
library(scatterpie)
library(reshape2)
library(ggforce)
library(ggmap)
library(ggraph)
library(ggpubr)
library(reshape2)
library(extRC)
##----get_data--------------------------------------------------------------------------------------------------------
setwd("/Users/agustin/Desktop/Papers/Canary_Island_Project/spatial_modularity_in_the_canary_islands")
source("/Users/agustin/Desktop/Papers/Canary_Island_Project/spatial_modularity_in_the_canary_islands/R/functions.R")
dryad_intralayer <- read.csv("./csvs/intralayer_file.csv")
dryad_interlayer <- read.csv("./csvs/interlayer_file.csv") #already has inverted within
##---- layers as islands -------------------------------------------------------------------------------
dryad_intralayer_islands <- dryad_intralayer
old_names <- c("WesternSahara1", "WesternSahara2",
"Fuerteventura1", "Fuerteventura2",
"GranCanaria1", "GranCanaria2",
"TenerifeSouth1", "TenerifeSouth2",
"TenerifeTeno1", "TenerifeTeno2",
"Gomera1", "Gomera2",
"Hierro1", "Hierro2")
new_names <- c("WesternSahara", "WesternSahara",
"Fuerteventura", "Fuerteventura",
"GranCanaria", "GranCanaria",
"TenerifeSouth", "TenerifeSouth",
"TenerifeTeno", "TenerifeTeno",
"Gomera", "Gomera",
"Hierro", "Hierro")
dryad_intralayer_islands$layer_from[dryad_intralayer_islands$layer_from %in% old_names] <-
new_names[match(dryad_intralayer_islands$layer_from, old_names)] #change to reflect layer = island
dryad_intralayer_islands$layer_to[dryad_intralayer_islands$layer_to %in% old_names] <-
new_names[match(dryad_intralayer_islands$layer_to, old_names)] #change to reflect layer = island
#if node_from, node_to, layer_from, layer_to are all the same need to sum the weight
dryad_intralayer_islands_grouped <- dryad_intralayer_islands %>%
group_by(layer_from, node_from, layer_to, node_to) %>%
summarise(sum_weight = sum(weight)) #turn sums of sites to sum of island
## ----dryad intralayer interlayer both ways-------------------------------------------------------------------------------------
intralayer_inverted <- tibble(values= dryad_intralayer_islands$layer_to, dryad_intralayer_islands$node_to, dryad_intralayer_islands$layer_from,
dryad_intralayer_islands$node_from, dryad_intralayer_islands$weight) #create an inverted copy for directed intralayers
colnames(intralayer_inverted) <- c("layer_from", "node_from", "layer_to", "node_to", "weight")
## ---- normalize intralayer weights--------------------------------------------------------------------------
#plants in from
tot_plant <- dryad_intralayer_islands %>%
group_by(layer_from,node_from) %>%
dplyr::summarise(tot=sum(weight))
intralayer_weighted <- dryad_intralayer_islands %>% left_join(tot_plant) %>% mutate(rel_weight=weight/tot) %>%
select(-weight,-tot) %>% dplyr::rename(weight=rel_weight)
#pols in from
tot_pol <- intralayer_inverted %>%
group_by(layer_from,node_from) %>%
dplyr::summarise(tot=sum(weight))
intralayer_weighted_inverted <- intralayer_inverted %>% left_join(tot_pol) %>% mutate(rel_weight=weight/tot) %>%
select(-weight,-tot) %>% dplyr::rename(weight=rel_weight)
#Create intraedgelist
edgelist_intralayers_both <- bind_rows(intralayer_weighted, intralayer_weighted_inverted) #combine inverted and non inverted versions of intra
##---- create interedges according to jaccard similarity between partners --------------------------------------------------------
# keep only species that occur in 2 or more layers
co_occurrence<- edgelist_intralayers_both%>%
group_by(node_from) %>%
mutate(num_layers_from=n_distinct(layer_from)) %>%
filter(num_layers_from>="2")
# a for loop that calculates all the interlayer edges based on jaccard index
interlayers_with_weights_islands <- NULL
for (i in unique(co_occurrence$node_from)) {
print(i)
partners_sp <-
co_occurrence %>%
filter(node_from== i) %>%
group_by(node_to) %>%
select(c(node_to,layer_from)) %>%
distinct() %>%
mutate(present=1) %>%
spread(node_to, present, fill = 0) %>%
column_to_rownames("layer_from")
beta_layers_sp <- 1-as.matrix(vegdist(partners_sp, "jaccard"))
beta_layers_sp_m <- melt(as.matrix(extRC::tril(beta_layers_sp)))
inter_fid <- beta_layers_sp_m  %>%
tibble() %>%
filter(value!=0) %>%
subset(Var1 != Var2) %>%
mutate(node_from=i, node_to =i) %>%
select(c(node_from,layer_from=Var1, layer_to=Var2,node_to, weight=value))
interlayers_with_weights_islands <- rbind(interlayers_with_weights_islands,inter_fid)
}
## ----multilayer_extended_final--------------------------------------------------------------------------------------
dryad_edgelist_complete <- bind_rows(edgelist_intralayers_both, interlayers_with_weights_islands) #combine weighted version of intra with inter
## ----node_metadata--------------------------------------------------------------------------------------------------
pollinators <- sort(unique(intralayer_weighted$node_to)) #adding up only pol who haven't been added yet
plants <- sort(unique(intralayer_weighted$node_from)) #adding up only plants who haven't been added yet
intersect(pollinators, plants) #making sure I don't have plants in pol or other way around
A <- length(pollinators) # Number of pollinators
P <- length(plants) # Number of plants
S <- A+P
island_names <- c("WesternSahara", #islands as layers
"Fuerteventura",
"GranCanaria",
"TenerifeSouth",
"TenerifeTeno",
"Gomera",
"Hierro")
# Create a table with node metadata
physical_nodes <- tibble(node_id=1:S, #1 till the last species
type=c(rep('plant',P),rep('pollinator',A)), #replicate the words P and A times
species=c(plants,pollinators)) #add species from plants and pollinators in accordance
layer_metadata <- tibble(layer_id=c(1:7), layer_name=island_names)  #give num to each layer
# Replace the node names with node_ids
dryad_edgelist_complete_ids <-
dryad_edgelist_complete %>%
left_join(physical_nodes, by=c('node_from' = 'species')) %>%  # Join for pollinators
left_join(physical_nodes, by=c('node_to' = 'species')) %>%  # Join for plants
dplyr::select(-node_from, -node_to) %>% #choose said columns
dplyr::select(layer_from, node_from=node_id.x, layer_to, node_to=node_id.y, weight) %>%
left_join(layer_metadata, by=c('layer_from' = 'layer_name')) %>%  # Join for plants
left_join(layer_metadata, by=c('layer_to' = 'layer_name')) %>%  # Join for plants
dplyr::select(-layer_from, -layer_to) %>%
dplyr::select(layer_from=layer_id.x, node_from, layer_to=layer_id.y, node_to, weight)
#Plot links distribution (directed)
inter_extended<- dryad_edgelist_complete_ids %>% filter(layer_from!=layer_to)
intra_inter_data_for_distibution <- data.frame(values= c(intralayer_weighted$weight,
intralayer_weighted_inverted$weight,
inter_extended$weight),
group= c(rep("intra plants", nrow(intralayer_weighted)),
rep("intra pollinators", nrow(intralayer_weighted_inverted)),
rep("inter", nrow(inter_extended))))
intra_inter_data_for_distibution %>%
ggplot(aes(x=values, fill=group))+ geom_histogram(position= "identity", alpha= 0.6, color= "black")+ theme_bw()+
theme(panel.grid = element_blank(),
panel.border = element_rect(color = "black",fill = NA,size = 1),
panel.spacing = unit(0.5, "cm", data = NULL),
axis.text = element_text(size=14, color='black'),
axis.title = element_text(size=14, color='black'),
axis.line = element_blank())
#Realized interedges links
real_interedge<- dryad_edgelist_complete_ids %>% filter(layer_from!=layer_to) %>%
summarize(Real_interedges = n())
interedges_comp<-cbind(pot_interedge,real_interedge, col=1)
#Maximum potential interlayer links according to species co-occurrence
co_occurrence_tot<-co_occurrence_species %>%  group_by(node_id) %>%
mutate(tot_island = sum (n)) %>%
summarize(Num_pot_interedge= case_when(tot_island == '1' ~ '0',
tot_island == '2' ~ '1',
tot_island == '3' ~ '3',
tot_island == '4' ~ '6',
tot_island == '5' ~ '10',
tot_island == '6' ~ '15',
tot_island == '7' ~ '21'))%>% unique()  #Potential links according to species co-occurence
co_occurrence_tot$Num_pot_interedge<-as.numeric(co_occurrence_tot$Num_pot_interedge)
##-- Distribution of species in islands
co_occurrence_species<- dryad_edgelist_complete_ids %>% filter(layer_from == layer_to) %>%
mutate(layer_id = layer_from, node_id = node_from) %>% select(layer_id, node_id) %>%
mutate(layer_name= case_when(layer_id == '1' ~ 'WesternSahara',
layer_id == '2' ~ 'Fuerteventura',
layer_id == '3' ~ 'GranCanaria',
layer_id == '4' ~ 'TenerifeSouth',
layer_id == '5' ~ 'TenerifeTeno',
layer_id == '6' ~ 'Gomera',
layer_id == '7' ~ 'Hierro'))
co_occurrence_species<- left_join(co_occurrence_species,physical_nodes, by="node_id") %>% select(-species) %>%
group_by(layer_id,node_id,type,layer_name) %>% unique() %>% count()
#Maximum potential interlayer links according to species co-occurrence
co_occurrence_tot<-co_occurrence_species %>%  group_by(node_id) %>%
mutate(tot_island = sum (n)) %>%
summarize(Num_pot_interedge= case_when(tot_island == '1' ~ '0',
tot_island == '2' ~ '1',
tot_island == '3' ~ '3',
tot_island == '4' ~ '6',
tot_island == '5' ~ '10',
tot_island == '6' ~ '15',
tot_island == '7' ~ '21'))%>% unique()  #Potential links according to species co-occurence
co_occurrence_tot$Num_pot_interedge<-as.numeric(co_occurrence_tot$Num_pot_interedge)
pot_interedge<-co_occurrence_tot %>% ungroup() %>% summarize(Pot_interedge = sum(Num_pot_interedge))
#Realized interedges links
real_interedge<- dryad_edgelist_complete_ids %>% filter(layer_from!=layer_to) %>%
summarize(Real_interedges = n())
interedges_comp<-cbind(pot_interedge,real_interedge, col=1)
interedges_comp2<- pivot_longer(interedges_comp, names_to = "group", values_to = "Count", cols = -col)
Pot_inter_edges<- interedges_comp2%>%
ggplot(aes(x=group, y= Count, fill=group))+ geom_bar(stat='identity', alpha= 0.6, color= "black")+ theme_bw()+
scale_y_continuous(limits = c(0, 500), breaks=seq(0,500,50)) +
theme(panel.grid = element_blank(),
panel.border = element_rect(color = "black",fill = NA,size = 1),
panel.spacing = unit(0.5, "cm", data = NULL),
axis.text = element_text(size=14, color='black'),
axis.title = element_text(size=14, color='black'))
Pot_inter_edges
View(paper_figs_theme_no_legend)
##---load_libraries-------------------------------------------------------------------------------------------------
options(rgl.useNULL = TRUE)
library(infomapecology)
library(igraph)
library(bipartite)
library(tidyverse)
library(magrittr)
library(betalink)
library(readxl)
library(ggalluvial)
library(scatterpie)
library(reshape2)
library(ggforce)
library(ggmap)
library(ggraph)
library(ggpubr)
##----get_data--------------------------------------------------------------------------------------------------------
setwd("/Users/agustin/Desktop/Papers/Canary_Island_Project/spatial_modularity_in_the_canary_islands")
source("/Users/agustin/Desktop/Papers/Canary_Island_Project/spatial_modularity_in_the_canary_islands/R/functions.R")
dryad_intralayer <- read.csv("./csvs/intralayer_file.csv")
dryad_interlayer <- read.csv("./csvs/interlayer_file.csv") #already has inverted within
##---- layers as islands -------------------------------------------------------------------------------
dryad_intralayer_islands <- dryad_intralayer
old_names <- c("WesternSahara1", "WesternSahara2",
"Fuerteventura1", "Fuerteventura2",
"GranCanaria1", "GranCanaria2",
"TenerifeSouth1", "TenerifeSouth2",
"TenerifeTeno1", "TenerifeTeno2",
"Gomera1", "Gomera2",
"Hierro1", "Hierro2")
new_names <- c("WesternSahara", "WesternSahara",
"Fuerteventura", "Fuerteventura",
"GranCanaria", "GranCanaria",
"TenerifeSouth", "TenerifeSouth",
"TenerifeTeno", "TenerifeTeno",
"Gomera", "Gomera",
"Hierro", "Hierro")
dryad_intralayer_islands$layer_from[dryad_intralayer_islands$layer_from %in% old_names] <-
new_names[match(dryad_intralayer_islands$layer_from, old_names)] #change to reflect layer = island
dryad_intralayer_islands$layer_to[dryad_intralayer_islands$layer_to %in% old_names] <-
new_names[match(dryad_intralayer_islands$layer_to, old_names)] #change to reflect layer = island
#if node_from, node_to, layer_from, layer_to are all the same need to sum the weight
dryad_intralayer_islands_grouped <- dryad_intralayer_islands %>%
group_by(layer_from, node_from, layer_to, node_to) %>%
summarise(sum_weight = sum(weight)) #turn sums of sites to sum of island
#---- shuffle pollinators ---------------------------------------------------------------------------------------------
physical_nodes <- read.csv("./csvs/Islands/Jac/physical_nodes_islands.csv")
layer_metadata <- read.csv("./csvs/Islands/Jac/layer_metadata_islands.csv")
intralayers_with_ids <-
dryad_intralayer_islands_grouped %>%
left_join(physical_nodes, by=c('node_from' = 'species')) %>%  # Join for pollinators
left_join(physical_nodes, by=c('node_to' = 'species')) %>%  # Join for plants
dplyr::select(-node_from, -node_to) %>% #choose said columns
dplyr::select(layer_from, node_from=node_id.x, layer_to, node_to=node_id.y, sum_weight) %>%
left_join(layer_metadata, by=c('layer_from' = 'layer_name')) %>%  # Join for plants
left_join(layer_metadata, by=c('layer_to' = 'layer_name')) %>%  # Join for plants
dplyr::select(-layer_from, -layer_to) %>%
dplyr::select(layer_from=layer_id.x, node_from, layer_to=layer_id.y, node_to, sum_weight)
intralayers_with_ids$from <- paste(intralayers_with_ids$layer_from, "_", intralayers_with_ids$node_from) #combine layer and node from
intralayers_with_ids$to <- paste(intralayers_with_ids$layer_to, "_", intralayers_with_ids$node_to) #combine layer and node to
intralayers_with_ids <- intralayers_with_ids %>% select(from, to, sum_weight) #select only new columns and weight
intralayer_matrix <- intralayers_with_ids %>%  #turn edge list to matrix
select(from, to, sum_weight) %>%
dcast(from ~ to, value.var = "sum_weight", fill = 0) %>%
column_to_rownames(var="from")
intralayer_matrix <- t(intralayer_matrix) #change plants and pol- shuffling pols
shuf_trial_matrix <- NULL
shuf_null_edge_list <- NULL
write.csv(shuf_null_edge_list, "./csvs/Islands/Jac/shuf_null_edge_list_islands_as_layers.csv", row.names = FALSE)
write.csv(shuf_trial_matrix, "./csvs/Islands/Jac/shuf_trial_matrix_islands_as_layers.csv", row.names = TRUE)
#write.csv(shuf_null_edge_list, "./csvs/Islands/Jac/shuf_null_edge_list_islands_as_layers.csv", row.names = FALSE)
#write.csv(shuf_trial_matrix, "./csvs/Islands/Jac/shuf_trial_matrix_islands_as_layers.csv", row.names = TRUE)
shuf_null_edge_list <- read.csv("./csvs/Islands/Jac/shuf_null_edge_list_islands_as_layers.csv")
pdf('./graphs/Islands/Jac/realized_interedges.pdf', 10, 6)
Pot_inter_edges<- interedges_comp2%>%
ggplot(aes(x=group, y= Count, fill=group))+ geom_bar(stat='identity', alpha= 0.6, color= "black")+ theme_bw()+
scale_y_continuous(limits = c(0, 500), breaks=seq(0,500,50)) +
theme(panel.grid = element_blank(),
panel.border = element_rect(color = "black",fill = NA,size = 1),
panel.spacing = unit(0.5, "cm", data = NULL),
axis.text = element_text(size=14, color='black'),
axis.title = element_text(size=14, color='black'))
dev.off()
pdf('./graphs/Islands/Jac/realized_interedges.pdf', 10, 6)
Pot_inter_edges<- interedges_comp2%>%
ggplot(aes(x=group, y= Count, fill=group))+ geom_bar(stat='identity', alpha= 0.6, color= "black")+ theme_bw()+
scale_y_continuous(limits = c(0, 500), breaks=seq(0,500,50)) +
theme(panel.grid = element_blank(),
panel.border = element_rect(color = "black",fill = NA,size = 1),
panel.spacing = unit(0.5, "cm", data = NULL),
axis.text = element_text(size=14, color='black'),
axis.title = element_text(size=14, color='black'))
dev.off()
interedges_comp2%>%
ggplot(aes(x=group, y= Count, fill=group))+ geom_bar(stat='identity', alpha= 0.6, color= "black")+ theme_bw()+
scale_y_continuous(limits = c(0, 500), breaks=seq(0,500,50)) +
theme(panel.grid = element_blank(),
panel.border = element_rect(color = "black",fill = NA,size = 1),
panel.spacing = unit(0.5, "cm", data = NULL),
axis.text = element_text(size=14, color='black'),
axis.title = element_text(size=14, color='black'))
pdf('./graphs/Islands/Jac/realized_interedges.pdf', 10, 6)
interedges_comp2%>%
ggplot(aes(x=group, y= Count, fill=group))+ geom_bar(stat='identity', alpha= 0.6, color= "black")+ theme_bw()+
scale_y_continuous(limits = c(0, 500), breaks=seq(0,500,50)) +
theme(panel.grid = element_blank(),
panel.border = element_rect(color = "black",fill = NA,size = 1),
panel.spacing = unit(0.5, "cm", data = NULL),
axis.text = element_text(size=14, color='black'),
axis.title = element_text(size=14, color='black'))
dev.off()
##---- create interedges  --------------------------------------------------------
# keep only species that occur in 2 or more layers
co_occurrence_from_shuf<- shuf_null_edge_list %>%
group_by(trial_number,node_from) %>%
mutate(num_layers_from=n_distinct(layer_from)) %>%
filter(num_layers_from>="2")
#write.csv(shuf_null_edge_list, "./csvs/Islands/Jac/shuf_null_edge_list_islands_as_layers.csv", row.names = FALSE)
#write.csv(shuf_trial_matrix, "./csvs/Islands/Jac/shuf_trial_matrix_islands_as_layers.csv", row.names = TRUE)
shuf_null_edge_list <- read.csv("./csvs/Islands/Jac/shuf_null_edge_list_islands_as_layers.csv")
