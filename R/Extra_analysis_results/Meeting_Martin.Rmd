---
title: "Meeting Martin"
output:
  html_document:
    toc: yes
    toc_float: yes
    collapse: no
    number_sections: yes
    code_folding: hide
    theme: united
    highlight: tango
  pdf_document:
    toc: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, results = "asis", message=FALSE, warning=FALSE, cache=TRUE, eval = TRUE, dev = c('png'), out.width = '100%', out.height='40%')
```


```{r load libraries, echo=FALSE, message=FALSE, warning=FALSE}
library(infomapecology)
library(igraph)
library(bipartite)
library(tidyverse)
library(magrittr)
library(betalink)
library(readxl)
library(ggalluvial)
library(scatterpie)
library(reshape2)
library(ggforce)
library(ggmap)
library(ggraph)
library(ggpubr)
rm(list=ls())
```


# Data: Plant-pollinator multilayer network {.tabset}
\
Contained four components:

1. Seven layers (six islands and the mainland).

2. Two sets of nodes representing pollinator and plant species.

3. Intralayer directed weighted links representing pollinator-plant interactions within layers.

4. Interlayer weighted links connecting any species i to itself between two layers. Closer two layers are, the stronger is the interlayer link. Ecologically, closer distance increases the likelihood that spatial processes such as dispersal occur between two sites
\
\
\

## Information of layers
\
\
```{r}
library(knitr)
Description <- read_excel("Location_description.xlsx", sheet = 2)
kable(Description, align=c(rep('c',times=7)))

```
\
\
\
\
\

## Number of interlayer edges across layers
\
\

```{r, message=FALSE}
message("

|------------|----------|----------|-----------|-----------|-----------|------------|------------|
|   **1**    |     -    |          |           |           |           |            |            |
|   **2**    |    15    |    -     |           |           |           |            |            |
|   **3**    |    9     |    17    |    -      |           |           |            |            |
|   **4**    |    12    |    19    |    30     |    -      |           |            |            |
|   **5**    |    10    |    14    |    27     |    36     |    -      |            |            |
|   **6**    |    10    |    20    |    27     |    33     |    27     |     -      |            |
|   **7**    |    4     |    11    |    19     |    22     |    26     |     27     |     -      |
| **Layers** |  **1**   |  **2**   |  **3**    |  **4**    |  **5**    |  ** 6**    |   **7**    |
")

```


## Distribution of intra and interlayer links
\
\
```{r}

intra_inter_data_for_distibution <- read.csv("intra_inter_data_for_distibution_islands_as_layers.csv")

intra_inter_data_for_distibution %>%
  ggplot(aes(x=values, fill=group))+ geom_histogram(position= "identity", alpha= 0.6, color= "black")+ theme_bw()+
  theme(panel.grid = element_blank(),
        panel.border = element_rect(color = "black",fill = NA,size = 1),
        panel.spacing = unit(0.5, "cm", data = NULL),
        axis.text = element_text(size=14, color='black'),
        axis.title = element_text(size=14, color='black'),
        axis.line = element_blank())

```
\
\
\
\
\

# Sensitivity analysis: Change interedges manually vs. using relax rate  {.tabset}
\
\

## Empirical data
```{r}

#Inter
dryad_multilayer_complete_fixed_output <- read.csv("inter_empirical.csv")

#Plot number of modules according to interedges values
N_modules_inter <- dryad_multilayer_complete_fixed_output %>% 
  group_by(trial_num) %>% summarise(Num_modules = max(module)) %>% rename(inter_edges = 1)

N_modules_inter_empirical<- ggplot(N_modules_inter, aes(x = inter_edges, y = Num_modules)) +  geom_bar(stat= "identity")+
  theme_classic() +  scale_x_continuous(breaks=seq(0.1,1,0.1))+ scale_y_continuous(breaks=seq(0,90,10))+
  labs(x='Interedges', y="Number of modules")+ theme(axis.text.x = element_text(size=13),
                                                     axis.text.y=element_text(size=13), axis.title = element_text(size=15))

#Relax rate
relaxrate_modules <- read.csv("relax_empirical.csv")

#Plot number of modules according to relax rate
N_modules_relax <- relaxrate_modules %>% 
  group_by(relax_rate) %>% summarise(Num_modules = max(module)) 

N_modules_relax_empirical<- ggplot(N_modules_relax, aes(x = relax_rate, y = Num_modules)) +  geom_bar(stat= "identity")+
  theme_classic() +  scale_x_continuous(breaks=seq(0.1,1,0.1))+scale_y_continuous(limits= c(0,90),breaks=seq(0,90,10))+
  labs(x='Relax rate', y="Number of modules")+ theme(axis.text.x = element_text(size=13),
                                                     axis.text.y=element_text(size=13), axis.title = element_text(size=15))

#Plot together  (ver si hacer grafico de distribucion)
plot_grid(N_modules_inter_empirical,
          N_modules_relax_empirical, 
          nrow = 2)

```

## Example Klil's code
\
\

```{r}

#Inter
dryad_multilayer_complete_fixed_output <- read.csv("inter_klil.csv")

#Plot number of modules according to interedges values
N_modules_inter <- dryad_multilayer_complete_fixed_output %>% 
  group_by(trial_num) %>% summarise(Num_modules = max(module)) %>% rename(inter_edges = 1)

N_modules_inter_Klil<- ggplot(N_modules_inter, aes(x = inter_edges, y = Num_modules)) +  geom_bar(stat= "identity")+
  theme_classic() +  scale_x_continuous(breaks=seq(0.1,1,0.1))+ scale_y_continuous(breaks=seq(0,35,5))+
  labs(x='Interedges', y="Number of modules")+ theme(axis.text.x = element_text(size=13),
                                                     axis.text.y=element_text(size=13), axis.title = element_text(size=15))

#Relax rate
relaxrate_modules <- read.csv("relax_klil.csv")

#Plot number of modules according to relax rate
N_modules_relax <- relaxrate_modules %>% 
  group_by(relax_rate) %>% summarise(Num_modules = max(module)) 

N_modules_relax_Klil<- ggplot(N_modules_relax, aes(x = relax_rate, y = Num_modules)) +  geom_bar(stat= "identity")+
  theme_classic() +  scale_x_continuous(breaks=seq(0.1,1,0.1))+scale_y_continuous(limits= c(0,35),breaks=seq(0,35,5))+
  labs(x='Relax rate', y="Number of modules")+ theme(axis.text.x = element_text(size=13),
                                                     axis.text.y=element_text(size=13), axis.title = element_text(size=15))


#Plot together  (ver si hacer grafico de distribucion)
plot_grid(N_modules_inter_Klil,
          N_modules_relax_Klil, 
          nrow = 2)

```